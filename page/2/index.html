<!DOCTYPE html><html class="theme-next gemini use-motion" lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#222"><script src="/lib/pace/pace.min.js?v=1.0.2"></script><link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|Input Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css"><link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"><link href="/css/main.css?v=6.0.3" rel="stylesheet" type="text/css"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.3"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.3"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.3"><link rel="mask-icon" href="/images/logo.svg?v=6.0.3" color="#222"><script type="text/javascript" id="hexo.configurations">var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };</script><meta name="keywords" content="Hexo,xuanye,blog"><meta name="description" content="xgcalendar xjplugin dotbpe å‡æ­£ç»å“¥å“¥ nodejs dotnet"><meta property="og:type" content="website"><meta property="og:title" content="å‡æ­£ç»å“¥å“¥"><meta property="og:url" content="https://xuanye.github.io/page/2/index.html"><meta property="og:site_name" content="å‡æ­£ç»å“¥å“¥"><meta property="og:description" content="xgcalendar xjplugin dotbpe å‡æ­£ç»å“¥å“¥ nodejs dotnet"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="å‡æ­£ç»å“¥å“¥"><meta name="twitter:description" content="xgcalendar xjplugin dotbpe å‡æ­£ç»å“¥å“¥ nodejs dotnet"><link rel="alternate" href="/atom.xml" title="å‡æ­£ç»å“¥å“¥" type="application/atom+xml"><link rel="canonical" href="https://xuanye.github.io/page/2/"><script type="text/javascript" id="page.configurations">CONFIG.page = {
    sidebar: "",
  };</script><title>å‡æ­£ç»å“¥å“¥ - æœ‰å¿ƒæ€æ—¶å¹²æœ‰æ„ä¹‰çš„æ´»ï¼Œæ²¡å¿ƒæƒ…æ—¶åšæœ‰æ„æ€çš„äº‹</title><script type="text/javascript">var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?ca7707d791c93c26f752f47474db5e66";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();</script><noscript><style type="text/css">.use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="en"><div class="container sidebar-position-left page-home"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-wrapper"><div class="site-meta"><div class="custom-logo-site-title"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">å‡æ­£ç»å“¥å“¥</span> <span class="logo-line-after"><i></i></span></a></div><h1 class="site-subtitle" itemprop="description">æœ‰å¿ƒæ€æ—¶å¹²æœ‰æ„ä¹‰çš„æ´»ï¼Œæ²¡å¿ƒæƒ…æ—¶åšæœ‰æ„æ€çš„äº‹</h1></div><div class="site-nav-toggle"><button><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i><br>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul><div class="site-search"><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class="search-icon"><i class="fa fa-search"></i> </span><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span><div class="local-search-input-wrapper"><input autocomplete="off" placeholder="Searching..." spellcheck="false" type="text" id="local-search-input"></div></div><div id="local-search-result"></div></div></div></nav></div></header><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><section id="posts" class="posts-expand"><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/debug-net-core-projects-with-vscode/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/debug-net-core-projects-with-vscode/" itemprop="url">ä½¿ç”¨VsCodeç¼–å†™å’Œè°ƒè¯•.NET Coreé¡¹ç›®</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-04-16T15:01:07+08:00">2017-04-16</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/åŸåˆ›/" itemprop="url" rel="index"><span itemprop="name">åŸåˆ›</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>â€‹ æœ¬æ¥æˆ‘è¿˜æƒ³ä»‹ç»ä»¥ä¸‹VSCodeæˆ–è€…donet coreï¼Œä½†æ˜¯å‘ç°éƒ½æ˜¯åºŸè¯ï¼Œæ²¡æœ‰å¿…è¦ï¼Œå¤§å®¶å¦‚æœå¯¹è¿™ä¸ªä¸äº†è§£å¯ä»¥ç›´æ¥googleè¿™ä¸¤ä¸ªå…³é”®å­—ï¼Œæˆ–è€…ä¹Ÿæ ¹æœ¬ä¸ä¼šçœ‹æˆ‘è¿™è¾¹æ–‡ç« ã€‚</p><p>â€‹ å¥½ç›´æ¥è¿›å…¥ä¸»é¢˜äº†ï¼Œæœ¬æ–‡çš„å‰ææ¡ä»¶ï¼š</p><ol><li>å·²ç»å®‰è£…å¥½äº†.NET Core SDK</li><li>å·²ç»å®‰è£…äº†VSCode</li></ol><h2>0x00. ç£¨åˆ€ä¸è¯¯ç æŸ´å·¥</h2><p>ä½¿ç”¨VSCodeç¼–å†™dotnet coreé¡¹ç›®é™¤äº†å…¶ é»˜è®¤çš„åŠŸèƒ½å¤–ï¼Œæˆ‘æ¨èè¿˜è¦å®‰è£…ä¸€äº›éå¸¸æœ‰ç‰¹è‰²ï¼Œå¹¶ä¸”æœ‰ç”¨çš„æ‰©å±•ï¼Œæ­£æ˜¯å› ä¸ºVSCodeçš„æ’ä»¶æœºåˆ¶ï¼Œæ‰è®©å®ƒå˜å¾—æ›´åŠ å¼ºå¤§ï¼Œæ»¡è¶³æˆ‘ä»¬å„å¼å„æ ·çš„éœ€æ±‚</p><p>è¿™ä¸ªæ˜¯ä½¿ç”¨VSCodeç¼–å†™C#ä»£ç å¿…é¡»çš„ï¼Œå®‰è£…ä¹‹ååœ¨é»˜è®¤æ‰“å¼€.csæ–‡ä»¶æ—¶ è¿˜ä¼šè‡ªåŠ¨ä¸‹è½½è°ƒè¯•å™¨ç­‰ï¼ˆä¸è¿‡è¿‡ç¨‹å¯èƒ½æ¯”è¾ƒæ…¢ï¼Œåœ¨å¢™å¤–çš„åŸå› ï¼‰<br>[C# XMLæ³¨é‡Š]: https://marketplace.visualstudio.com/items?itemName=k--kato.docomment<br>è¿™ä¸ªå¯ä»¥æ’ä»¶å¯ä»¥å¿«é€Ÿçš„å¸®ä½ æ·»åŠ æ³¨é‡Šï¼Œé€‰æ‹©å®‰è£…å§<br>[C# Extensions]: https://marketplace.visualstudio.com/items?itemName=jchannon.csharpextensions<br>è¿™ä¸ªæ’ä»¶ï¼Œå¼ºçƒˆæ¨èï¼Œå¯ä»¥å¸®ä½ åœ¨å»ºç«‹æ–‡ä»¶çš„æ—¶å€™åˆå§‹åŒ–æ–‡ä»¶å†…å®¹åŒ…æ‹¬å¯¹åº”çš„å‘½åç©ºé—´ç­‰</p><p>è¿˜æœ‰ä¸€äº›å…¶ä»–è¾…åŠ©ç±»çš„ï¼Œæ¯”å¦‚EditorConfig,Guildes,One Dark Theme,Project Manager ,Setting Syncç­‰ã€‚</p><h2>0x01. æ–°å»ºå¤šé¡¹ç›®è§£å†³æ–¹æ¡ˆ</h2><p>æ‰“å¼€å‘½ä»¤è¡Œå·¥å…·ï¼Œåœ¨å‘½ä»¤è¡Œå·¥å…·ä¸­è¾“å…¥:</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>:&gt; dotnet new sln -o vscode_tutorial //åœ¨å½“å‰ç›®å½•ä¸‹ åˆ›å»ºåä¸ºvscode_tutorial</span><br></pre></td></tr></table></figure><p></p><p>ä»¥ä¸Šå‘½ä»¤ä½¿ç”¨dotnet sdkï¼Œæ–°å»ºä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ–‡ä»¶ï¼Œä½ å¯ä»¥ä¸ç”¨å‘½ä»¤è¡Œæ‰‹åŠ¨åˆ›å»ºï¼Œä½†æ˜¯ä½¿ç”¨<code>dotnet new</code> å¯ä»¥æ›´åŠ æ–¹ä¾¿çš„åˆ›å»ºdotnet coreç›¸å…³çš„é¡¹ç›®. é¡ºä¾¿æä¸€ä¸‹ä½¿ç”¨dotnet new å‘½ä»¤å¯ä»¥æ–°å»ºç±»åº“é¡¹ç›®ï¼Œæ§åˆ¶å°é¡¹ç›®ï¼Œç½‘ç«™é¡¹ç›®ç­‰ç­‰ï¼Œè¯¦ç»†ä½¿ç”¨å¯ä»¥ä½¿ç”¨<code>dotnet help new</code> å‘½ä»¤æ¥æŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feoku81gjlj20s20g9jsi.jpg" alt></p><p>å»ºå®Œè§£å†³æ–¹æ¡ˆæˆ‘ä»¬è¦æ¥å»ºç«‹é¡¹ç›®äº†ï¼ŒåŒ…æ‹¬ä¸€ä¸ªæ§åˆ¶å°é¡¹ç›®ï¼Œä¸€ä¸ªç±»åº“é¡¹ç›®å’Œä¸€ä¸ªå•å…ƒæµ‹è¯•é¡¹ç›®</p><p>é¦–å…ˆå»ºç«‹ä¸€ä¸ªå…¬å…±çš„ç±»åº“é¡¹ç›®ç”¨äºå­˜æ”¾æˆ‘ä»¬çš„ä¸šåŠ¡æ–¹æ³•ï¼ˆå‡è®¾æˆ‘ä»¬åœ¨åšä¸€ä¸ªçœŸå®çš„é¡¹ç›®ï¼‰</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>:&gt; dotnet new classlib -o VSCodeTutorial.Common //åœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºç±»åº“é¡¹ç›®VSCodeTutorial.Common</span><br><span class="line"><span class="meta">$</span>:&gt; dotnet sln add VSCodeTutorial.Common/VSCodeTutorial.Common.csproj //å°†é¡¹ç›®æ·»åŠ åˆ°è§£å†³æ–¹æ¡ˆä¸­</span><br></pre></td></tr></table></figure><p></p><p>é€šè¿‡åŒæ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬å»ºç«‹å¥½æ§åˆ¶å°é¡¹ç›®å’Œå•å…ƒæµ‹è¯•é¡¹ç›®</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>:&gt; dotnet new console -o VSCodeTutorial.ConsoleApp</span><br><span class="line"><span class="meta">$</span>:&gt; dotnet sln add VSCodeTutorial.ConsoleApp/VSCodeTutorial.ConsoleApp.csproj</span><br><span class="line"><span class="meta">$</span>:&gt; dotnet new xunit -o VSCodeTutorial.UnitTest</span><br><span class="line"><span class="meta">$</span>:&gt; dotnet sln add VSCodeTutorail.UnitTest/VSCodeTutorial.UnitTest.csproj</span><br></pre></td></tr></table></figure><p></p><p>è¿™é‡Œè¦æ³¨æ„æ§åˆ¶çš„æ¨¡æ¿åç§°å«<code>console</code>è€Œå•å…ƒæµ‹è¯•æˆ‘ä»¬ä½¿ç”¨<code>xunit</code></p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å·²ç»å»ºç«‹å®Œæˆäº†ï¼Œæˆ‘ä»¬ç”¨VsCodeæ¥æ‰“å¼€å½“å‰ç›®å½•æ¥çœ‹çœ‹å®Œæˆçš„é¡¹ç›®ç»“æ„å§ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feokuqo7bmj20da0jldgj.jpg" alt></p><p>&lt;!-- more --&gt;</p><h2>0x02. æ·»åŠ é¡¹ç›®é—´çš„ä¾èµ–å…³ç³»</h2><p>ä½¿ç”¨VsCodeæ‰“å¼€é¡¹ç›®æ–‡ä»¶VSCodeTutorial.ConsoleApp.csproj,åœ¨å…¶ä¸­æ·»åŠ å¯¹Commoné¡¹ç›®çš„å¼•ç”¨</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">OutputType</span>&gt;</span>Exe<span class="tag">&lt;/<span class="name">OutputType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netcoreapp1.1<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"> <span class="comment">&lt;!--æ·»åŠ é¡¹ç›®å¼•ç”¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProjectReference</span> <span class="attr">Include</span>=<span class="string">"..\VSCodeTutorial.Common\VSCodeTutorial.Common.csproj"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>åŒæ ·æ‰“å¼€VSCodeTutorial.UnitTest.csprojé¡¹ç›®æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æ·»åŠ å¯¹Commoné¡¹ç›®çš„å¼•ç”¨</p><p></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netcoreapp1.1<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--nuget ä¸Šçš„ç±»åº“å¼•ç”¨--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"Microsoft.NET.Test.Sdk"</span> <span class="attr">Version</span>=<span class="string">"15.0.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"xunit"</span> <span class="attr">Version</span>=<span class="string">"2.2.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">"xunit.runner.visualstudio"</span> <span class="attr">Version</span>=<span class="string">"2.2.0"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æœ¬åœ°é¡¹ç›®å¼•ç”¨--&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProjectReference</span> <span class="attr">Include</span>=<span class="string">"..\VSCodeTutorial.Common\VSCodeTutorial.Common.csproj"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å’Œä¸Šé¢çš„é‚£ä¸ªé¡¹ç›®ä¸åŒï¼Œè¿™é‡Œæœ‰ä¸€äº›é¢å¤–çš„ä¾èµ–ï¼Œè¿™é‡Œå¯ä»¥åˆšå¥½äº†è§£ä¸‹ï¼Œå¦‚æœæ·»åŠ nugetä¸­åŒ…çš„ä¾èµ–ï¼Œåªéœ€åƒä¸Šé¢ä¸€æ ·ä½¿ç”¨<code>PackageReference</code>å¹¶å¡«å…¥ç±»åº“åç§°å’Œç‰ˆæœ¬å·å³å¯</p><p>æ·»åŠ å®Œä¾èµ–åï¼Œæˆ‘ä»¬åœ¨æ ¹ç›®å½•ä¸‹ä½¿ç”¨<code>dotnet restore</code>æ¥åˆå§‹åŒ–ä»¥ä¸‹,ä¹Ÿå¯ä»¥å†ç”¨<code>dotnet build</code>å‘½ä»¤æ¥å°è¯•ç¼–è¯‘ä¸€ä¸‹å…ˆ</p><p>é¡¹ç›®ä¾èµ–å…³ç³»å¦‚å›¾2ï¼š</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feol1juewrj20kq07r3yp.jpg" alt></p><h2>0x03. å¼€å§‹ç¼–å†™ä»£ç </h2><p>â€‹ è¿™ä¸ªé¡¹ç›®çš„æ•´ä½“éœ€æ±‚ï¼šæˆ‘éœ€è¦æ‰“å¼€ä¸€ä¸ªæ§åˆ¶å°ç¨‹åºï¼Œè¿è¡Œæ—¶éœ€è¦ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå°äº50çš„æ•´æ•°ï¼Œæ§åˆ¶å°æ¥æ”¶åˆ°è¿™ä¸ªæ•°å­—åè®¡ç®—å‡ºè¿™ä¸ªæ•°å­—çš„é˜¶ä¹˜ï¼Œå¹¶æŠŠç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°ä¸Šã€‚</p><p>â€‹ ç»è¿‡ç®€å•çš„æ€è€ƒï¼Œæˆ‘å†³å®šæŠŠé˜¶ä¹˜çš„å®ç°æ”¾åˆ°Commoné¡¹ç›®ä¸­ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•çš„ä»£ç åˆ™æ”¾åˆ°UnitTesté¡¹ç›®ä¸­</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feol1juewrj20kq07r3yp.jpg" alt></p><p>é¦–å…ˆæˆ‘ä»¬æŠŠä¹‹å‰ç”Ÿæˆçš„é¡¹ç›®ä¸­ä¸éœ€è¦çš„æ–‡ä»¶ç»™åˆ é™¤æ‰VsCodeTutorial.Commonä¸­çš„Class1.cså’ŒVSCodeTutorial.UnitTestä¸­çš„UnitTest1.cs ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ç•™ç€ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬åœ¨<code>VsCodeTutorial.Common</code>é¡¹ç›®ä¸­æ–°å»ºæ–‡ä»¶<code>MathHelper.cs</code>å¹¶åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ,å®ç°æˆ‘ä»¬çš„é˜¶ä¹˜ï¼Œä»£ç æ¯”è¾ƒç®€å•å°±ä¸è¯¦è¿°äº†ã€‚</p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">VSCodeTutorial.Common</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MathHelper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> é˜¶ä¹˜ï¼Œæœ¬ä¾‹ä¸­æš‚ä¸è€ƒè™‘ æº¢å‡ºçš„é—®é¢˜å“¦ Factorial(n) = n*ï¼ˆn-1ï¼‰*(n-2)...*1;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name="n"&gt;</span>è¾“å…¥å‚æ•°n<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">Factorial</span>(<span class="params"><span class="keyword">int</span> n</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(n &lt;=<span class="number">0</span> )&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> System.ArgumentOutOfRangeException(<span class="string">"n"</span>,<span class="string">"å‚æ•°é”™è¯¯ï¼Œä¸èƒ½å°äºç­‰äºé›¶"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(n == <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> n*Factorial(n<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬è¦æ¥æµ‹è¯•è¿™ä¸ªä»£ç ï¼Œçœ‹çœ‹æ˜¯å¦è¾¾åˆ°äº†æˆ‘ä»¬çš„ç›®æ ‡ï¼Œåœ¨<code>VSCodeTutorial.UnitTest</code>é¡¹ç›®ä¸­æ–°å»ºæ–‡ä»¶<code>MathHelpTest.cs</code>å‘æ–‡ä»¶ä¸­æ·»åŠ æµ‹è¯•<code>Factorial</code>å‡½æ•°çš„æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> VSCodeTutorial.Common;</span><br><span class="line"><span class="keyword">using</span> Xunit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">VSCodeTutorial.UnitTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MathHelperTest</span></span><br><span class="line">    &#123;</span><br><span class="line">         [<span class="meta">Fact</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">TestFactorial</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="comment">//å…ˆæµ‹è¯•ä¸€ä¸‹è¾¹ç•Œçš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">int</span> zero = <span class="number">0</span> ;</span><br><span class="line">            <span class="keyword">var</span> exception = Assert.Throws&lt;ArgumentOutOfRangeException&gt;(() =&gt; MathHelper.Factorial(zero));</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> one = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">var</span> oneResult = MathHelper.Factorial(one);</span><br><span class="line">            Assert.Equal(<span class="number">1</span>, oneResult);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//å†æµ‹ä¸€ä¸‹æ­£å¸¸çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">int</span> five = <span class="number">5</span>;</span><br><span class="line">            <span class="keyword">var</span> fiveResult = MathHelper.Factorial(five);</span><br><span class="line">            Assert.Equal(<span class="number">5</span>*<span class="number">4</span>*<span class="number">3</span>*<span class="number">2</span>*<span class="number">1</span>, fiveResult);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> ten = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">var</span> tenResult = MathHelper.Factorial(ten);</span><br><span class="line">            Assert.Equal(<span class="number">10</span>*<span class="number">9</span>*<span class="number">8</span>*<span class="number">7</span>*<span class="number">6</span>*<span class="number">5</span>*<span class="number">4</span>*<span class="number">3</span>*<span class="number">2</span>*<span class="number">1</span>, tenResult);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2>0x04 ä½¿ç”¨å‘½ä»¤è¡Œè¿è¡Œå•å…ƒæµ‹è¯•</h2><p>â€‹ åœ¨ä½¿ç”¨é…ç½®VSCodeä¹‹å‰ æˆ‘è¿˜æ˜¯å»ºè®®å¤§å®¶å…ˆä½¿ç”¨å‘½ä»¤è¡Œæ¥è¿è¡Œä¸€ä¸‹å•å…ƒæµ‹è¯•ï¼Œè¿™æœ‰åˆ©äºæ›´å¥½çš„ç†è§£é…ç½®å†…å®¹ã€‚</p><p>åœ¨æ ¹ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤:<code>dotnet test ./VSCodeTutorial.UnitTest/VSCodeTutorial.UnitTest.csproj</code> æŸ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feomgnvhrjj20sb0ae3zf.jpg" alt></p><p>å¾ˆå·®åŠ²ä¼šå‡ºç°ç¼–ç é”™è¯¯ï¼Œè€Œä¸”è¿™ä¸ªé”™è¯¯æš‚æ—¶è¿˜æ²¡æœ‰åŠæ³•è§£å†³..ä½†æ˜¯æˆ‘çŒœå•å…ƒæµ‹è¯•é€šè¿‡äº†ï¼Œè¿™ä¸ªé—®é¢˜ç›¸ä¿¡åœ¨åç»­çš„ç‰ˆæœ¬ä¸­è‚¯å®šä¼šå¾—åˆ°è§£å†³ï¼Œäº‹å®ä¸Šåœ¨Consoleé¡¹ç›®ä¸­æ˜¯å¯ä»¥è§£å†³è¾“å‡ºä¹±ç é—®é¢˜çš„ã€‚ä¸è¿‡å¯å–œçš„æ˜¯åœ¨VSCodeä¸­è¿è¡Œå•å…ƒæµ‹è¯•æ˜¯æ²¡æœ‰ä¹±ç çš„é—®é¢˜çš„ğŸ˜ã€‚</p><h2>0x05 ä½¿ç”¨VSCode è¿è¡Œå•å…ƒæµ‹è¯•</h2><p>é¦–å…ˆå½“ä½ æ‰“å¼€é¡¹ç›®çš„æ—¶å€™ï¼ŒVSCode å¯èƒ½å·²ç»å»ºè®®ä½ é…ç½®ä¸€ä¸‹ç›¸å…³çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feomnmm2kwj21ah03bt96.jpg" alt></p><p>é€‰æ‹©Yes, ä¼šå¸®ä½ æ–°å»ºè¿™ä¸ªä¸€ä¸ªç›®å½•å’Œä¸¤ä¸ªæ–‡ä»¶ï¼Œluanch.jsonæ˜¯ç”¨æ¥æ‰§è¡Œè°ƒè¯•ç¨‹åºçš„é…ç½®ï¼Œè€Œtasks.jsonåˆ™æ˜¯é…ç½®å„ç§ä»»åŠ¡çš„ï¼Œå…¶ä¸­è¿è¡Œå•å…ƒæµ‹è¯•å°±æ˜¯ä¸€ç§ä»»åŠ¡ã€‚</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feomqq26tyj207u09m74l.jpg" alt></p><p>é¦–å…ˆæˆ‘ä»¬æ‰“å¼€<code>tasks.json</code> ï¼Œé»˜è®¤å·²ç»æ·»åŠ å¥½äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"dotnet"</span>, <span class="comment">//å…¨å±€å‘½ä»¤ï¼Œå³æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä½¿ç”¨è¿™ä¸ªå‘½ä»¤ï¼Œä¹Ÿå¯ä»¥åœ¨å„ä¸ªä»»åŠ¡ä¸­è®¾ç½®</span></span><br><span class="line">    <span class="attr">"isShellCommand"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [],</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"taskName"</span>: <span class="string">"build"</span>, <span class="comment">//ä»»åŠ¡åç§° å½“è®¾ç½®äº†ä¸»çš„command ä¹‹åè¿™ä¸ªtaskNameä¹Ÿä¼šä½œä¸ºä¸€ä¸ªå‘½ä»¤å‚æ•°</span></span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp\\VSCodeTutorial.ConsoleApp.csproj"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"isBuildCommand"</span>: <span class="literal">true</span>, <span class="comment">//ä¸€ä¸ªè§£å†³æ–¹æ¡ˆåªèƒ½è®¾ç½®ä¸€ä¸ªç¼–è¯‘ä»»åŠ¡ï¼Œå¤šè®¾ç½®äº†ä¹Ÿæ˜¯ç™½æ­ï¼Œå½“ç„¶ä¹Ÿèƒ½æ‰§è¡Œï¼Œåªæ˜¯ä¸èƒ½åˆ©ç”¨å¿«æ·æ–¹å¼è¿è¡Œäº†</span></span><br><span class="line">            <span class="attr">"problemMatcher"</span>: <span class="string">"$msCompile"</span><span class="comment">//C#é¡¹ç›®çš„problemMatcher</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>é»˜è®¤ä½¿ç”¨äº†å…¨å±€å‘½ä»¤è¡Œï¼Œè¿™æ ·å¯ä»¥åœ¨ä»»åŠ¡ä¸­çœå»é…ç½®dotnetå‘½ä»¤ï¼Œä½†æ˜¯å¦‚æœä½ çš„è§£å†³æ–¹æ¡ˆä¸­åŒ…æ‹¬å¤šä¸ªé¡¹ç›®éœ€è¦ä¸åŒçš„å‘½ä»¤è¡Œç¼–è¯‘æ–¹å¼ï¼Œå¦‚æœå‰ç«¯ç½‘ç«™ä½¿ç”¨gruntæ‰“åŒ…èµ„æºï¼Œé‚£ä¹ˆé¡¶éƒ¨åº”è¯¥ç•™ç©ºï¼Œè€Œåœ¨å„ä¸ªå­ä»»åŠ¡ä¸­é…ç½®commandã€‚è¿˜æœ‰å¦‚æœå­˜åœ¨å¤šä¸ªç¼–è¯‘é¡¹ç›®æ—¶ï¼ˆå¦‚å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ—¶ï¼‰ï¼Œä¹Ÿåº”è¯¥æŠŠcommandé…ç½®åœ¨å­ä»»åŠ¡ä¸­ï¼Œå¹¶è®¾ç½®ä¸ªæ€§åŒ–çš„taskNameä»¥ä¾¿åŒºåˆ«ï¼Œæ‰€ä»¥æˆ‘æ¨èæŠŠcommandè®¾ç½®åœ¨ä»»åŠ¡ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä»¥ä¸Šä»£ç ï¼Œå¹¶æ·»åŠ ä¸€ä¸ªè¿è¡Œå•å…ƒæµ‹è¯•çš„äººã€‚</p><p></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.1.0"</span>,</span><br><span class="line">    <span class="attr">"isShellCommand"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"args"</span>: [],</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"taskName"</span>: <span class="string">"build_console"</span>,</span><br><span class="line">            <span class="attr">"command"</span>:<span class="string">"dotnet"</span></span><br><span class="line">            <span class="string">"args"</span>: [</span><br><span class="line">                <span class="string">"build"</span>, <span class="comment">//ç»„æˆdotnet build</span></span><br><span class="line">                <span class="comment">//è®¾ç½®éœ€è¦ç¼–è¯‘çš„é¡¹ç›®ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªå¯åŠ¨é¡¹ç›®å¯ä»¥è®¾ç½®æˆè§£å†³æ–¹æ¡ˆæ–‡ä»¶ï¼ˆ.slnï¼‰,è¿™é‡Œåªæœ‰ä¸€ä¸ªé¡¹ç›®æ‰€ä»¥è®¾ç½®è¿è¡Œé¡¹ç›®ä¹Ÿå¯ä»¥</span></span><br><span class="line">                <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp\\VSCodeTutorial.ConsoleApp.csproj"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"isBuildCommand"</span>: <span class="literal">true</span>, <span class="comment">//è®¾ç½®æ˜¯å¦ç¼–è¯‘é¡¹ç›®</span></span><br><span class="line">            <span class="attr">"problemMatcher"</span>: <span class="string">"$msCompile"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"taskName"</span>: <span class="string">"UnitTest"</span>,</span><br><span class="line">            <span class="attr">"command"</span>:<span class="string">"dotnet"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"test"</span>,<span class="comment">//ç»„æˆdotnet test å‘½ä»¤</span></span><br><span class="line">                <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.UnitTest\\VSCodeTutorial.UnitTest.csproj"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"isTestCommand"</span>: <span class="literal">true</span>,<span class="comment">//è®¾ç½®ä¸ºå•å…ƒæµ‹è¯•é¡¹ç›®</span></span><br><span class="line">            <span class="attr">"problemMatcher"</span>: <span class="string">"$msCompile"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘å°†commandå‘½ä»¤ç§»åˆ°äº†ä»»åŠ¡ä¸­ï¼Œå¹¶ç»™æ¯ä¸ªä»»åŠ¡èµ·äº†ä¸€ä¸ªå¥½è¯†åˆ«çš„åå­—ï¼Œç°åœ¨è¿™é‡Œä¸€ä¸ªæœ‰2ä¸ªä»»åŠ¡äº†</p><p>ç¬¬ä¸€ä¸ªä»»åŠ¡<code>build_console</code> è¿è¡Œæ—¶ ä¼šç¼–è¯‘<code>VSCodeTutorial.ConsoleApp</code>é¡¹ç›®åŠå…¶ä¾èµ–çš„é¡¹ç›®</p><p>ç¬¬äºŒä¸ªä»»åŠ¡<code>UnitTest</code>åˆ™æ˜¯å•å…ƒæµ‹è¯•é¡¹ç›®ï¼Œè¿è¡Œ<code>dotnet test</code>å‘½ä»¤ï¼Œè¿™é‡Œæœ‰ä¸ªç‰¹æ®Šçš„è®¾ç½®å°±æ˜¯<code>&quot;isTestCommand&quot;: true</code> æ ‡è¯†ä¸ºæµ‹è¯•é¡¹ç›®åå¯ä»¥é€šè¿‡å¿«æ·æ–¹å¼è¿è¡Œè¯¥å‘½ä»¤</p><p>ä»»åŠ¡å»ºå¥½äº†ï¼Œæˆ‘ä»¬æ¥è¿è¡Œä»»åŠ¡æŠŠï¼ŒwindowsæŒ‰ä¸‹ ctrl+shift+p,åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­è¾“å…¥:task è¿‡æ»¤å‘½ä»¤å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„é€‰é¡¹</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feotyfpchzj20ig0aqmy1.jpg" alt></p><p>é€‰æ‹©<code>ä»»åŠ¡:è¿è¡Œæµ‹è¯•ä»»åŠ¡</code> è¿™æ¡æ¥è¿è¡Œæˆ‘ä»¬ä¹‹å‰ç¼–å†™å¥½çš„å•å…ƒæµ‹è¯•é¡¹ç›®ï¼Œå¯ä»¥çœ‹åˆ°è¿è¡ŒæˆåŠŸçš„æƒ…å†µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feou0lpbsej20y708fzlr.jpg" alt></p><p>è¿™é‡Œä¸­æ–‡æ˜¾ç¤ºæ­£å¸¸ï¼Œæ²¡æœ‰ä¹±ç å“¦ï¼Œä½†æ˜¯æˆ‘ä¸çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› ..å°±æ˜¯è¿™ä¹ˆç¥å¥‡</p><p>å¯¹äºç»å¸¸æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®é”®ç›˜å¿«æ·æ–¹å¼æ¥æ–¹ä¾¿è°ƒç”¨ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘åˆ†åˆ«è®¾ç½®äº†ctrl+shift+t è¿è¡Œæµ‹è¯•ä»»åŠ¡ctrl+shift+b è¿è¡Œç¼–è¯‘ä»»åŠ¡ï¼Œctrl+shift+r å¯åŠ¨é€‰æ‹©ä»»åŠ¡ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥è®¾ç½®ã€‚</p><h2>0x06 å¼€å§‹ç¼–å†™æ§åˆ¶å°ä»£ç </h2><p>æ‰“å¼€VSCodeTutorial.ConsoleAppé¡¹ç›®ä¸­çš„Program.csæ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­çš„ä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤º</p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> VSCodeTutorial.Common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">VSCodeTutorial.ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">"è¯·è¾“å…¥ä¸€ä¸ªå°äº10çš„æ•°å­—,å›è½¦ç»“æŸ:"</span>);</span><br><span class="line">                <span class="keyword">string</span> input_str = Console.ReadLine();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">int</span>.TryParse(input_str ,<span class="keyword">out</span> <span class="keyword">var</span> input_int))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(input_int&gt;<span class="number">0</span> &amp;&amp; input_int&lt;=<span class="number">10</span>)&#123;</span><br><span class="line">                       <span class="keyword">int</span> result =  MathHelper.Factorial(input_int);</span><br><span class="line">                       Console.WriteLine(<span class="string">"ä½ è¾“å…¥çš„æ•°å­—æ˜¯&#123;0&#125;,å®ƒçš„é˜¶ä¹˜ç»“æœæ˜¯&#123;1&#125;,é€€å‡ºè¯·æŒ‰ctrl+c,æŒ‰å…¶ä»–é”®å†è¯•ä¸€æ¬¡"</span>,input_int,result);</span><br><span class="line">                       Console.ReadKey();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">"è¾“å…¥çš„å­—ç¬¦ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä»£ç æ¯”è¾ƒ ç®€å•ï¼Œå°±ä¸åšè§£é‡Šäº†ï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹è¿è¡Œçš„ç»“æœï¼Œè¿™é‡Œé¡ºä¾¿æä¸€ä¸‹å•Šï¼Œåœ¨æˆ‘ä»¬ä¹‹å‰åšçš„ä¼—å¤šå·¥ä½œä¹‹åï¼Œæˆ‘ä»¬è¿™é‡Œç¼–å†™ä»£ç æœ‰ç¾ç¾å“’çš„æ™ºèƒ½æç¤ºå“¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feoudwzdenj20qe0gu40h.jpg" alt></p><p>å¥½ï¼Œå†æ ¹ç›®å½•ä¸‹è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿è¡ŒConsoleApp</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span>:&gt; dotnet run -p ./VSCodeTutorial.ConsoleApp/VSCodeTutorial.ConsoleApp.csproj</span><br></pre></td></tr></table></figure><p></p><p>ä¹Ÿå¯ä»¥åœ¨<code>VSCodeTutorial.ConsoleApp</code> ç›®å½•ä¸‹ç›´æ¥è¿è¡Œ<code>dotnet run</code> å‘½ä»¤å³å¯.</p><p>ç»“æœè¿è¡Œè¿˜æ˜¯ä¹±ç ä¸­ï¼Œä½†æ˜¯è¿™æ¬¡æˆ‘ä»¬æœ‰åŠæ³•è§£å†³ï¼Œæˆ‘ä»¬åœ¨æ§åˆ¶å°ä»£ç ä¸­æ·»åŠ ä¸€å¥ä»£ç å³å¯<code>onsole.OutputEncoding = Encoding.UTF8</code></p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> VSCodeTutorial.Common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">VSCodeTutorial.ConsoleApp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="keyword">string</span>[] args</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.OutputEncoding = Encoding.UTF8; <span class="comment">// è®¾ç½®æ§åˆ¶å°ç¼–ç </span></span><br><span class="line">            <span class="keyword">while</span>(<span class="literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="string">"è¯·è¾“å…¥ä¸€ä¸ªå°äº10çš„æ•°å­—,å›è½¦ç»“æŸ:"</span>);</span><br><span class="line">                <span class="keyword">string</span> input_str = Console.ReadLine();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">int</span>.TryParse(input_str ,<span class="keyword">out</span> <span class="keyword">var</span> input_int))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span>(input_int&gt;<span class="number">0</span> &amp;&amp; input_int&lt;=<span class="number">10</span>)&#123;</span><br><span class="line">                       <span class="keyword">int</span> result =  MathHelper.Factorial(input_int);</span><br><span class="line">                       Console.WriteLine(<span class="string">"ä½ è¾“å…¥çš„æ•°å­—æ˜¯&#123;0&#125;,å®ƒçš„é˜¶ä¹˜ç»“æœæ˜¯&#123;1&#125;,é€€å‡ºè¯·æŒ‰ctrl+c,æŒ‰å…¶ä»–é”®å†è¯•ä¸€æ¬¡"</span>,input_int,result);</span><br><span class="line">                       Console.ReadKey();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    Console.WriteLine(<span class="string">"è¾“å…¥çš„å­—ç¬¦ä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä½¿ç”¨dotnet buildç¼–è¯‘åï¼Œå†æ¬¡è¿è¡ŒConsoleé¡¹ç›®çœ‹åˆ°äº†æˆ‘ä»¬æœŸæœ›çš„ç•Œé¢</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feoupo8qinj20pv02rjre.jpg" alt></p><p>ç¨‹åºè¿è¡Œæ­£ç¡®ï¼Œå½“ç„¶äº†ï¼Œæˆ‘ä»¬éƒ½è·‘è¿‡å•å…ƒæµ‹è¯•äº†ä¸æ˜¯ã€‚ã€‚</p><h2>0x07 å¼€å§‹è°ƒè¯•ç¨‹åºäº†</h2><p>å¦‚ä¸‹å›¾æç¤ºæ“ä½œ</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feouu8xzrpj21720g5jts.jpg" alt></p><p>ç»ˆäºè½®åˆ°æˆ‘ä»¬ä¹‹å‰ç”Ÿæˆçš„launch.jsonæ–‡ä»¶å‡ºåœºäº†ï¼Œå…ˆæ¥çœ‹ä¸‹å®ƒçš„ä»£ç ï¼Œä»£ç ä¸­å·²ç»æ·»åŠ äº†é…ç½®çš„è¯´æ˜</p><p></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">".NET Core Launch (console)"</span>, <span class="comment">//é…ç½®åç§° å¯ä»¥æ”¹æˆæ›´å¥½è¯†åˆ«çš„åå­—</span></span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"coreclr"</span>, <span class="comment">// .net coreç±»å‹çš„è°ƒè¯•</span></span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>, <span class="comment">//è°ƒè¯•æ–¹å¼ ä¸ç”¨æ”¹</span></span><br><span class="line">            <span class="attr">"preLaunchTask"</span>: <span class="string">"build"</span>, <span class="comment">// å‰ç½®ä»»åŠ¡ï¼Œè¿™é‡Œæ˜¯ç¼–è¯‘ï¼Œä½†æ˜¯é»˜è®¤çš„ç¼–è¯‘ä»»åŠ¡ï¼Œå·²ç»è¢«æˆ‘æ”¹äº†åå­—äº†ï¼Œæ‰€ä»¥è¿™é‡Œè¦æ”¹ä¸€ä¸‹å“¦</span></span><br><span class="line">            <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp\\bin\\Debug\\netcoreapp1.1\\VSCodeTutorial.ConsoleApp.dll"</span>, <span class="comment">//éœ€è¦è°ƒè¯•çš„DLLçš„ä½ç½® </span></span><br><span class="line">            <span class="attr">"args"</span>: [], <span class="comment">//é¢å¤–çš„å‚æ•°</span></span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp"</span>, <span class="comment">//å·¥ä½œç›®å½•</span></span><br><span class="line">            <span class="attr">"console"</span>: <span class="string">"internalConsole"</span>, <span class="comment">//æ§åˆ¶å°æ¨¡å¼ï¼Œè¿™é‡Œæ˜¯å†…åµŒæ§åˆ¶å°ï¼Œä¸€ä¼šè¦æ”¹æˆå¤–ç½®çš„ï¼Œä¸ç„¶æ²¡æ³•äº¤äº’è¾“å…¥</span></span><br><span class="line">            <span class="attr">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"internalConsoleOptions"</span>: <span class="string">"openOnSessionStart"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">".NET Core Attach"</span>, <span class="comment">//åç§°</span></span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"coreclr"</span>, <span class="comment">//ç±»å‹</span></span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"attach"</span>, <span class="comment">//ä½¿ç”¨é™„åŠ çš„æ–¹å¼</span></span><br><span class="line">            <span class="attr">"processId"</span>: <span class="string">"$&#123;command:pickProcess&#125;"</span> <span class="comment">//é™„åŠ çš„è¿›ç¨‹ID</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ ¹æ®å®é™…æƒ…å†µï¼Œéœ€è¦å¯¹ä¸Šé¢çš„é…ç½®è¿›è¡Œä»¥ä¸‹å˜æ›´ï¼Œå˜æ›´çš„éƒ¨åˆ†å·²ç»æ·»åŠ äº†æ³¨é‡Šï¼Œé™„åŠ è°ƒè¯•ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå°±ä¸æ”¹äº†</p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="string">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"è°ƒè¯•ConsoleApp"</span>, <span class="comment">//ä¿®æ”¹ä¸‹å‘½ä»¤</span></span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"coreclr"</span>,</span><br><span class="line">            <span class="string">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="string">"preLaunchTask"</span>: <span class="string">"build_console"</span>, <span class="comment">//ä¿®æ”¹å‰ç½®ä»»åŠ¡åå’Œtask.jsonä¸­é…ç½®ä¸€è‡´</span></span><br><span class="line">            <span class="string">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp\\bin\\Debug\\netcoreapp1.1\\VSCodeTutorial.ConsoleApp.dll"</span>,</span><br><span class="line">            <span class="string">"args"</span>: [],</span><br><span class="line">            <span class="string">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\VSCodeTutorial.ConsoleApp"</span>,</span><br><span class="line">            <span class="string">"externalConsole"</span>:<span class="literal">true</span>, <span class="comment">//ä½¿ç”¨å¤–ç½®çš„æ§åˆ¶å°</span></span><br><span class="line">            <span class="string">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"internalConsoleOptions"</span>: <span class="string">"openOnSessionStart"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">".NET Core Attach"</span>,</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"coreclr"</span>,</span><br><span class="line">            <span class="string">"request"</span>: <span class="string">"attach"</span>,</span><br><span class="line">            <span class="string">"processId"</span>: <span class="string">"$&#123;command:pickProcess&#125;"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ä¿®æ”¹å®Œæˆåï¼Œæˆ‘ä»¬ç‚¹å‡»è¿è¡ŒæŒ‰é’®å¯ä»¥å¼€å§‹è°ƒè¯•äº†ï¼Œè°ƒè¯•çš„æ–¹å¼å’Œä½¿ç”¨VSæ˜¯ä¸€è‡´çš„ï¼Œå¿«æ·é”®ä¸ºF5 F10 F11</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feov8e1scqj20rm0gaq58.jpg" alt></p><p>ç®€ç›´å¤ªå¼ºå¤§äº†ï¼</p><h2>0x08 å¤šé¡¹ç›®å¯åŠ¨è°ƒè¯•</h2><p>æœ‰æ—¶å€™æˆ‘ä»¬ä¼šåŒæ—¶åœ¨ä¸€ä¸ªè§£å†³æ–¹æ¡ˆä¸­ åŒæ—¶å¯åŠ¨ä¸¤ä¸ªé¡¹ç›®æ¥è°ƒè¯•ï¼Œé‚£ä¹ˆæ€ä¹ˆé…ç½®å‘¢ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå¦å¤–ä¸€ä¸ªé¡¹ç›®å’Œä¹‹å‰çš„ä¸€æ ·å„è‡ªé…ç½®ä¸€ä¸ªç¼–è¯‘çš„Taskï¼ˆå½“ç„¶æœ€å¥½æ˜¯ä¸¤ä¸ªé¡¹ç›®ä½¿ç”¨.slnæ¥ç»Ÿä¸€ç¼–è¯‘ï¼‰ï¼Œç„¶åå„é…ç½®ä¸€ä¸ªlaunché…ç½®ï¼Œç„¶åä½¿ç”¨<code>compounds</code> é…ç½®æ¥åŒæ—¶å¯åŠ¨å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹</p><p></p><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="string">"configurations"</span>: [</span><br><span class="line">        <span class="string">"HelloRpcClientLaunch"</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"HelloRpcServer"</span>,</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"coreclr"</span>,</span><br><span class="line">            <span class="string">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="string">"preLaunchTask"</span>: <span class="string">"buildServer"</span>,</span><br><span class="line">            <span class="string">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\src\\sample\\HelloRpc\\HelloRpc.Server\\bin\\Debug\\netcoreapp1.1\\HelloRpc.Server.dll"</span>,</span><br><span class="line">            <span class="string">"args"</span>: [],</span><br><span class="line">            <span class="string">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\src\\sample\\HelloRpc\\HelloRpc.Server"</span>,</span><br><span class="line">            <span class="string">"externalConsole"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="string">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"internalConsoleOptions"</span>: <span class="string">"openOnSessionStart"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">"HelloRpcClientLaunch"</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"HelloRpcClient"</span>,</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"coreclr"</span>,</span><br><span class="line">            <span class="string">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="string">"preLaunchTask"</span>: <span class="string">"buildClient"</span>,</span><br><span class="line">            <span class="string">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\src\\sample\\HelloRpc\\HelloRpc.Client\\bin\\Debug\\netcoreapp1.1\\HelloRpc.Client.dll"</span>,</span><br><span class="line">            <span class="string">"args"</span>: [],</span><br><span class="line">            <span class="string">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;\\src\\sample\\HelloRpc\\HelloRpc.Client"</span>,</span><br><span class="line">            <span class="string">"externalConsole"</span>:<span class="literal">true</span>,</span><br><span class="line">            <span class="string">"stopAtEntry"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">"internalConsoleOptions"</span>: <span class="string">"openOnSessionStart"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">    <span class="string">"compounds"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"Server/Client"</span>,</span><br><span class="line">            <span class="string">"configurations"</span>: [<span class="string">"HelloRpcServer"</span>, <span class="string">"HelloRpcClient"</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™æ—¶å€™å°±ä¼šæœ‰ä¸ªSever/Clientçš„è°ƒè¯•é€‰é¡¹ä¾›é€‰æ‹©äº†ï¼Œå¦‚å›¾:</p><p><img src="http://ww1.sinaimg.cn/large/697065c1gy1feovdxuj89j207g04daa0.jpg" alt></p><p>å¥½äº†ï¼Œè®©æˆ‘ä»¬ä¸€èµ·ä½¿ç”¨VSCodeæ¥ç¼–å†™.NetCoreé¡¹ç›®å§</p><p>æœ¬æ–‡ç¤ºä¾‹ä»£ç  <a href="https://github.com/xuanye/VSCodeTutorial" target="_blank" rel="noopener">https://github.com/xuanye/VSCodeTutorial</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/typescript-react-tutorial/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/typescript-react-tutorial/" itemprop="url">Typescript React Sample</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-28T10:57:37+08:00">2016-03-28</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/åšå®¢/" itemprop="url" rel="index"><span itemprop="name">åšå®¢</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>æ³¨ï¼šæœ¬æ–‡çš„åŸå§‹èµ„æ–™å’Œç¤ºä¾‹æ¥è‡ª<a href="https://github.com/ServiceStackApps/typescript-redux" target="_blank" rel="noopener">ServiceStackApps/typescript-redux</a> ,æ ¹æ®æˆ‘çš„å®é™…æƒ…å†µï¼Œåšäº†ä¸€äº›è°ƒæ•´ï¼Œè¯¦è§æ–‡å†…è¯´æ˜ï¼Œæ„Ÿè°¢åŸä½œè€…çš„æ— ç§åˆ†äº«ã€‚</p><p>æœ¬æ–‡é€šè¿‡è®¾ç½®ï¼Œè¿è¡Œå’Œæ¢ç´¢Javascriptä¸€äº›é«˜çº§çš„æŠ€æœ¯æ ˆï¼š</p><ul><li><a href="http://www.typescriptlang.org/" target="_blank" rel="noopener">TypeScript</a> - å…·å¤‡ç±»å‹çš„Javascriptè¶…é›†, æä¾›ä¸€äº›é«˜çº§åˆ«çš„è¯­æ³•ç‰¹æ€§ï¼ˆæ³¨ï¼šçœŸæ­£çš„é¢å‘å¯¹è±¡ç­‰ï¼‰å’Œéƒ¨åˆ†ES5çš„æ”¯æŒ</li><li><a href="https://github.com/typings/typings" target="_blank" rel="noopener">typings</a> - ç”¨äºæœç´¢å’Œå®‰è£…TypeScriptè¯­æ³•å®šä¹‰çš„åŒ…ç®¡ç†å™¨</li><li><a href="https://facebook.github.io/react/" target="_blank" rel="noopener">React</a> - ç®€å•ï¼Œé«˜æ€§èƒ½çš„javascript UIå±‚æ¡†æ¶ï¼Œåˆ©ç”¨è™šæ‹ŸDOMå’Œåº”ç­”æ•°æ®æµ</li><li><a href="https://github.com/rackt/redux" target="_blank" rel="noopener">Redux</a> - javascript åº”ç”¨ç¨‹åºçš„çŠ¶æ€ç®¡ç†æ¡†æ¶ï¼Œéå¸¸é€‚åˆå’ŒReactæ­é…ä½¿ç”¨</li></ul><p>æä¾›å¼€å‘å¤§å‹javascriptåº”ç”¨ç¨‹åºå¼ºå¤§çš„åŸºç¡€ï¼Œå¹¶æ”¹è¿›åœ¨Visual Studioä¸­çš„å¼€å‘ä½“éªŒï¼ˆæ³¨ï¼šäº‹å®ä¸Šï¼Œå¹¶éä¸€å®šåœ¨Visual Studioä¸­ï¼Œå…¶ä»–çš„ç¼–è¾‘å™¨ä¹Ÿæ˜¯å¯ä»¥çš„ï¼‰</p><p>æœ¬æ–‡ä¸­æ¶‰åŠåˆ°çš„ä»£ç å¯åœ¨æ­¤å¤„æŸ¥çœ‹ï¼š<a href="https://github.com/xuanye/typescript-redux-sample" target="_blank" rel="noopener">https://github.com/xuanye/typescript-redux-sample</a></p><p>&lt;!-- more --&gt;</p><h2>å®‰è£… TypeScript</h2><p>å¦‚æœä½ è¿˜æ²¡æœ‰ä»<a href="http://www.typescriptlang.org/" target="_blank" rel="noopener">typescriptlang.org</a>ä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Typescriptã€‚Visual Studioçš„ç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„é“¾æ¥å¿«é€Ÿå®‰è£…ï¼š</p><ul><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=48593" target="_blank" rel="noopener">VS.NET 2015</a></li><li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=48739" target="_blank" rel="noopener">VS.NET 2013</a></li></ul><blockquote><p>æœ¬æ–‡å·²ç»é»˜è®¤ä½ å·²ç»å®‰è£…äº†TypeScript v1.8 æˆ–æ›´é«˜çš„ç‰ˆæœ¬</p></blockquote><p>ï¼ˆæ³¨ï¼šåŸæ–‡ä¸­ä½¿ç”¨JSPMä½œä¸ºnodejsçš„åŒ…ç®¡ç†å™¨ï¼Œæœ¬æ–‡ä¸­æˆ‘ä»ç„¶ä½¿ç”¨npmæ¥ä»£æ›¿ï¼ŒåŸæ–‡ä¸­ä½¿ç”¨systemä½œä¸ºæ¨¡å—åŠ è½½å™¨ï¼Œæœ¬æ–‡ä¸­ç”¨webpackä»£æ›¿ï¼‰</p><h2>åˆ›å»º ä¸€ä¸ª ASP.NET Web é¡¹ç›®ï¼ˆå¦‚æœä½ çš„ç¼–è¾‘å™¨ä¸æ˜¯VS.NETï¼Œé‚£å°±ç›´æ¥è·³è¿‡åˆ°é…ç½®TypeScriptï¼‰</h2><p>è™½ç„¶å®‰è£…äº† TypeScript VS.NET æ‰©å±•æä¾›äº†ï¼Œä¸€ä¸ªæ–°çš„ <strong>HTML Application with TypeScript</strong> é¡¹ç›®æ¨¡æ¿ï¼Œä½†æ˜¯ä½ æœ€å¥½è¿˜æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª <strong>Empty ASP.NET Web Application</strong> é¡¹ç›®å¹¶é…ç½®é¡¹ç›®æ”¯æŒTypescript -- è¿™æ¯”æŠŠå®ƒä»Typescriptè½¬æ¢æˆ ASP.NET Webé¡¹ç›®è¦æ–¹ä¾¿çš„å¤šã€‚.</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/01-empty-web-project.png" alt="æ–°å»ºé¡¹ç›®æ¨¡æ¿"></p><p>åœ¨æ¥ä¸‹æ¥çš„ç•Œé¢ é€‰æ‹© <strong>Empty</strong> æ¨¡æ¿æ¥åˆ›å»ºä¸€ä¸ªç©ºæ¨¡æ¿:</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/02-empty-web-template.png" alt="æ–°å»ºç©ºç½‘ç«™"></p><h3>å¯ç”¨ TypeScript</h3><p>åœ¨é¡¹ç›®çš„å³é”®èœå•<code>Add &gt; TypeScript File</code>ä¸­æ·»åŠ ä¸€ä¸ª <strong>TypeScript File</strong> æ–‡ä»¶å°±ä¼šè‡ªåŠ¨é…ç½®çš„ä½ Webé¡¹ç›® <code>.csproj</code> æ–‡ä»¶ï¼ŒåŠ ä¸Šä¸€äº›å¯ç”¨TypeScript æ”¯æŒå¿…é¡»çš„å¯¼å…¥é¡¹ï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/03-add-typescript-file.png" alt="æ–°å»ºTypescriptæ–‡ä»¶"></p><p>é…ç½®çš„æ—¶å€™ä¼šå¼¹å‡ºå¯¹è¯æ¡†:</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/04-typescript-confirmation-dialog.png" alt="å¯¹è¯æ¡†"></p><p>ç‚¹å‡» <strong>No</strong> æ¥è·³è¿‡ä½¿ç”¨Nugetå¯¹è¯æ¡†æ¥å®‰è£…Typing å®šä¹‰æ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬åé¢ä¼šä½¿ç”¨<a href="https://github.com/typings/typings" target="_blank" rel="noopener">typings Package Manager</a> æ¥ä»£æ›¿å®ƒå®‰è£…å®šä¹‰æ–‡ä»¶.</p><h3>é…ç½® TypeScript</h3><p>åœ¨é¡¹ç›®ä¸­ç¬¬ä¸€æ¿€æ´»TypeScriptéœ€è¦é…ç½®ä¸€äº›é€‰é¡¹ã€‚VS.NET 2015 å¯ä»¥é€šè¿‡é¡¹ç›®å±æ€§ä¸­çš„<code>Typescript Build</code>é…ç½®èŠ‚æ¥é…ç½®TypeScriptçš„ç¼–è¯‘é€‰é¡¹ï¼Œè¿™äº›ä¿¡æ¯å°†ç›´æ¥é…ç½®åˆ°VSçš„**.csproj**é¡¹ç›®æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/05-configure-typescript-vs.png" alt="TypeScript Properties Page"></p><p>ä¸è¿‡æˆ‘ä»¬æ›´å€¾å‘äºä½¿ç”¨<code>tsconfig.json</code>çš„ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶æ¥é…ç½®è¿™äº›é€‰é¡¹ï¼Œè€Œä¸”è¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥æ›´å¥½çš„é€‚é…åˆ°å…¶ä»–çš„ç¼–è¾‘å™¨/IDEä¸­ï¼Œæ›´åˆ©äºçŸ¥è¯†çš„åˆ†äº«ï¼Œå‡å°‘ä¸€äº›ä¸å¿…è¦çš„é—®é¢˜ã€‚</p><p>åœ¨é¡¹ç›®ä¸Šå³é”®<code>Add &gt; New Item</code> åœ¨æ‰“å¼€çš„å¯¹è¯æ¡†ä¸­æœç´¢ <strong>typescript</strong>ï¼Œå¹¶é€‰æ‹© <strong>TypeScript JSON Configuration File</strong> æ–‡ä»¶æ¨¡æ¿ æ¥æ·»åŠ <code>tsconfig.json</code> åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/05-add-tsconfig.png" alt="add-tsconfig"></p><p>è¿™ä¼šæ·»åŠ ä¸€ä¸ªåŸºç¡€çš„<code>tsconfig.json</code>é…ç½®æ–‡ä»¶åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œè¿™äº›é…ç½®ä¼šæ›¿æ¢æ‰ä½ ä¹‹å‰åœ¨<code>.csproj</code> é¡¹ç›®æ–‡ä»¶ä¸­é…ç½®çš„å˜é‡</p><h3>tsconfig for webpack, React and JSX</h3><p>ä¸ºäº†æ›´å¿«çš„è¿›å…¥çŠ¶æ€ï¼Œä½ å¯ä»¥å¤åˆ¶ä¸‹é¢çš„é…ç½®ä¿¡æ¯å¹¶æ›¿æ¢ä½ çš„<code>tsconfig.json</code> æ–‡ä»¶å†…å®¹ï¼š</p><p></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"noImplicitAny"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"noEmitOnError"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"removeComments"</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">"module"</span>: <span class="string">"commonjs"</span>,</span><br><span class="line">    <span class="attr">"sourceMap"</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">"target"</span>: <span class="string">"es5"</span>,</span><br><span class="line">    <span class="attr">"jsx"</span>: <span class="string">"react"</span>,</span><br><span class="line">    <span class="attr">"experimentalDecorators"</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"exclude"</span>: [</span><br><span class="line">    <span class="string">"typings"</span>,</span><br><span class="line">    <span class="string">"node_modules"</span>,</span><br><span class="line">    <span class="string">"wwwroot"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å’Œé»˜è®¤çš„ <code>tsconfig.json</code> æœ‰æ‰€ä¸åŒçš„æ˜¯ :</p><ul><li><code>target:es5</code> - å°†ç¼–è¯‘çš„javascriptè®¾ç½®æˆes5ç‰ˆæœ¬</li><li><code>module:commonjs</code> - ä½¿ç”¨commonjsä½œä¸ºæ¨¡å—åŠ è½½å™¨ï¼ˆäº‹å®ä¸Šæ— æ‰€è°“ï¼Œæˆ‘ä»¬æœ€ç»ˆä½¿ç”¨webpackæ‰“åŒ…ï¼‰</li><li><code>jsx:react</code> - å°† <code>.tsx</code> æ–‡ä»¶è½¬æ¢æˆ Reactçš„ JavaScript è¯­æ³•ï¼Œè€Œä¸æ˜¯jsxè¯­æ³•ã€‚</li><li><code>experimentalDecorators:true</code> -å¯ç”¨ES7è£…é¥°å™¨è¯­æ³•æ”¯æŒï¼Œäº‹å®ä¸Šè¿™ä¸ªè¯­æ³•è§„åˆ™è¿˜æ²¡æœ‰ç¡®å®šï¼Œæ‰€ä»¥æœ¬æ–‡ä¸­å¼ƒç”¨äº†</li><li><code>exclude:node_modules</code> - æ’é™¤ä¸€äº›æ–‡ä»¶å¤¹ï¼Œä¸è¦å»ç¼–è¯‘è¿™äº›æ–‡ä»¶å¤¹ä¸‹é¢çš„typescriptä»£ç ã€‚</li></ul><blockquote><p><a href="https://github.com/Microsoft/TypeScript/issues/6782#issuecomment-187820198" target="_blank" rel="noopener">VS 2013 ä¸æ”¯æŒ tsconfig.json</a> ä½†æ˜¯ä¸æ‰“ç´§ï¼Œæˆ‘ä»¬æœ€ç»ˆä½¿ç”¨webpackæ‰“åŒ…ä»£ç ï¼Œè€Œä¸æ˜¯vsæœ¬èº«ï¼Œæ‰€ä»¥ã€‚ã€‚ä½ æ‡‚çš„</p></blockquote><h2>å®‰è£… webpack</h2><p>Webpack æ˜¯å¾·å›½å¼€å‘è€… Tobias Koppers å¼€å‘çš„æ¨¡å—åŠ è½½å™¨ï¼Œå®ƒå’Œä¼ ç»Ÿçš„commonjså’Œrequirejsçš„ä¸åŒä¹‹å¤„ï¼Œåœ¨äºï¼Œå®ƒåœ¨è¿è¡Œæ—¶æ˜¯ä¸éœ€è¦å®ƒæœ¬èº«çš„ï¼Œjså’Œå…¶ä»–ä¸€äº›èµ„æºæ–‡ä»¶ï¼ˆcssï¼Œå›¾ç‰‡ç­‰ï¼‰åœ¨è¿è¡Œä¹‹å‰å°±å·²ç»å¹¶åˆå¹¶åˆ°äº†ä¸€èµ·ï¼Œå¹¶ä¸”å®ƒçš„å¾ˆå¤šæ’ä»¶è®©ä½ å¯ä»¥åœ¨åšå¾ˆå¤šé¢„ç¼–è¯‘çš„äº‹æƒ…ï¼ˆæ¯”å¦‚æœ¬æ–‡ä¸­çš„å°†typescriptç¼–è¯‘æˆes5ç‰ˆæœ¬çš„javascriptï¼‰ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘å¹¶éå¯¹å®ƒå¾ˆç†Ÿæ‚‰ï¼Œä¹Ÿåªæ˜¯å‚ä¸äº†å¾ˆå¤šçš„èµ„æ–™ï¼Œï¼šï¼‰ ä½ å¯ä»¥ä»ä¸‹é¢çš„è¿™äº›é“¾æ¥è·å–åˆ°ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼š</p><ul><li><a href="https://webpack.github.io" target="_blank" rel="noopener">å®˜ç½‘</a></li><li><a href="https://segmentfault.com/a/1190000002551952" target="_blank" rel="noopener">webpackå…¥é—¨æŒ‡å—</a></li><li><a href="https://zhongsp.gitbooks.io/typescript-handbook/content/doc/handbook/quick-start/react-webpack.html" target="_blank" rel="noopener">Typescript ä¸­æ–‡æ‰‹å†Œä¸­çš„ç›¸å…³ä»‹ç»</a></li></ul><p>å®‰è£… webpackæœ¬èº«éå¸¸æ–¹ä¾¿ï¼Œåªè¦ä½¿ç”¨npmå‘½ä»¤å…¨å±€å®‰è£…å°±å¯ä»¥äº†ï¼š</p><pre><code>C:\proj&gt; npm install webpack -g
</code></pre><p>ç­‰å¾…æ‰§è¡Œå®Œæˆå³å¯ã€‚</p><h3>åˆå§‹åŒ–é¡¹ç›®</h3><p>åœ¨é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ npm init ä¸ºé¡¹ç›®åˆ›å»ºä¸€ä¸ªpackage.jsonæ–‡ä»¶ï¼Œä»¥ä¾¿æˆ‘ä»¬åç»­å®‰è£…ä¸€äº›ç›¸å…³çš„åŒ…åˆ°æœ¬åœ°</p><pre><code>C:\proj&gt; npm init
</code></pre><h3>é…ç½®webpack</h3><p>ä½¿ç”¨webpack æ‰“åŒ…typescriptä»£ç ï¼Œå¹¶ç¼–è¯‘æˆjavascriptéœ€è¦å®‰è£…ä¸€äº›æ’ä»¶ï¼Œæ¥å®‰è£…ä¸€ä¸‹:</p><pre><code>C:\proj&gt; npm install ts-loader source-map-loader --save-dev
</code></pre><p>åˆå§‹åŒ–é¡¹ç›®çš„æ–‡ä»¶å¤¹ç»“æ„ï¼Œä¹‹æ‰€ä»¥åœ¨è¿™é‡Œè¯´ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¸‹é¢çš„é…ç½®æ–‡ä»¶ä¼šä½¿ç”¨åˆ°å¯¹åº”çš„ç›®å½•åœ°å€ï¼Œå»ºæˆåçš„ç›®å½•ç»“æ„å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/06-folder-list.png" alt="06-folder-list.png"></p><p>å…¶ä¸­ <code>source</code> ç›®å½•ç”¨äºå­˜æ”¾Typescriptæºä»£ç æ–‡ä»¶(<strong>æœ¬ä¾‹ä¸­ä¸ºäº†è·¯å¾„å¼•ç”¨æ–¹ä¾¿ï¼Œæˆ‘å°†HTMLæ–‡ä»¶ä¹Ÿæ”¾åˆ°é‡Œè¯¥ç›®å½•ä¸‹ï¼Œå®é™…é¡¹ç›®ä¸­ä¸ç”¨è¿™ä¹ˆåš</strong>) <code>wwwroot/js</code> ç”¨äºå­˜æ”¾ç”Ÿæˆjsæ–‡ä»¶å’Œå¼•ç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“ï¼ˆjquery,zeptoç­‰ç­‰ï¼‰ æœ¬ä¾‹ä¸­ï¼Œæˆ‘å°†reactjsçš„jsæ–‡ä»¶æ”¾åˆ°<code>wwwroot/js/lib</code>ç›®å½•ä¸­ï¼Œå¹¶åœ¨é¡µé¢ä¸Šå•ç‹¬å¼•ç”¨ã€‚</p><p>å®Œæˆåï¼Œåœ¨é¡¹ç›®ç›®å½•æ·»åŠ ä¸€ä¸ª<code>webpack.config.js</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æ˜¯webpakeçš„é…ç½®æ–‡ä»¶ï¼Œå°†ä»¥ä¸‹ä»£ç å¤åˆ¶åˆ°æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    entry: "./source/index.ts",</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: "./wwwroot/js/[name].js",</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Enable sourcemaps for debugging webpack's output.</span></span><br><span class="line">    devtool: "source-map",</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">// Add '.ts' and '.tsx' as resolvable extensions.</span></span><br><span class="line">        extensions: ["", ".webpack.js", ".web.js", ".ts", ".tsx", ".js"]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    module: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">            <span class="comment">// All files with a '.ts' or '.tsx' extension will be handled by 'ts-loader'.</span></span><br><span class="line">            &#123; test: /\.tsx?$/, loader: "ts-loader" &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        preLoaders: [</span><br><span class="line">            <span class="comment">// All output '.js' files will have any sourcemaps re-processed by 'source-map-loader'.</span></span><br><span class="line">            &#123; test: /\.js$/, loader: "source-map-loader" &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// When importing a module whose path matches one of the following, just</span></span><br><span class="line">    <span class="comment">// assume a corresponding global variable exists and use that instead.</span></span><br><span class="line">    <span class="comment">// This is important because it allows us to avoid bundling all of our</span></span><br><span class="line">    <span class="comment">// dependencies, which allows browsers to cache those libraries between builds.</span></span><br><span class="line">    externals: &#123;</span><br><span class="line">        "react": "React",</span><br><span class="line">        "react-dom": "ReactDOM"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>å…³äºwebpack.config.jsä¸­çš„è¯¦ç»†è¯´æ˜ï¼Œå¯å‚è€ƒ<a href="http://webpack.github.io/docs/configuration.html" target="_blank" rel="noopener">å®˜æ–¹çš„è¯´æ˜</a>ï¼Œå…¶ä¸­<code>externals</code>é…ç½®èŠ‚æ˜¯ç”¨äºæ’é™¤ï¼Œå•ç‹¬å¼•ç”¨çš„reactjsç±»åº“ï¼Œä¸æ‰“åŒ…è¿›ç”Ÿæˆçš„æ–‡ä»¶ï¼Œ<code>entry</code>å…¥å£è¿™é‡Œæ˜¯ç¤ºä¾‹ï¼Œåœ¨ä¸‹é¢çš„ç« èŠ‚ä¼šæ›¿æ¢æˆå®é™…çš„å†…å®¹ã€‚</p><h3>å®‰è£… React</h3><p>é€šè¿‡npm å®‰è£… reactåˆ°æœ¬åœ°ï¼Œä½ å¯ä»¥å¯ä»¥æ‰‹åŠ¨åˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„ç‰ˆæœ¬ï¼Œå¹¶å¤åˆ¶åˆ°<code>wwwroot/js/lib</code> ç›®å½•ä¸‹:</p><pre><code>C:\proj&gt; npm install react --save
</code></pre><p>ä» v0.14 å¼€å§‹ React å°†domæ“ä½œåˆ†ç¦»åˆ°ä¸€ä¸ªå•ç‹¬çš„åŒ…ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ¥å®‰è£…ä¸€ä¸‹:</p><pre><code>C:\proj&gt; npm install react-dom --save
</code></pre><p>æ‰‹åŠ¨å°†reactåº“ ä»<code>node_modules</code> å¤åˆ¶åˆ° <code>wwwroot/js/lib</code> ç›®å½•ä¸­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/06-folder-react.png" alt="06-folder-react"></p><p>æˆ‘ä»¬å®é™…ä½¿ç”¨åˆ°çš„æ–‡ä»¶æ˜¯<code>react.min.js</code>å’Œ<code>react-dom.min.js</code> ã€‚</p><h3>å®‰è£… typings - TypeScript definitionsçš„ç®¡ç†å™¨</h3><p>ä¸ºäº†èƒ½å¤Ÿå¼€å¯Typescriptçš„è‡ªåŠ¨å®Œæˆå’Œç±»å‹æ£€æŸ¥æ”¯æŒï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ä¸€äº›ç¬¬ä¸‰æ–¹ç±»åº“çš„ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯é€šè¿‡å®‰è£…<a href="https://github.com/typings/typings" target="_blank" rel="noopener">typings</a> å¯ä»¥é€šè¿‡npmæ¥å…¨å±€å®‰è£…å®ƒ:</p><pre><code>C:\proj&gt; npm install typings -g
</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>typings</code> å‘½ä»¤æ¥å®‰è£…æˆ‘ä»¬éœ€è¦çš„TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶äº†ã€‚</p><h4>Install React Type Definitions</h4><pre><code>C:\proj&gt; typings install react --ambient --save
</code></pre><h4>Install React DOM Type Definitions</h4><pre><code>C:\proj&gt; typings install react-dom --ambient --save
</code></pre><p>The <code>--ambient</code> æ ‡å¿—æ˜¯è®© <strong>typings</strong> åœ¨ç¤¾åŒºç‰ˆæœ¬ä¸­æŸ¥æ‰¾ <code>.d.ts</code> TypeScript å®šä¹‰æ–‡ä»¶ï¼Œå®ƒä»¬éƒ½åœ¨<a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noopener">DefinitelyTyped</a> <code>--save</code> æ ‡å¿—æ˜¯è®©è¿™äº›å®‰è£…çš„ä¿¡æ¯ä¿å­˜åˆ°<code>typings.json</code>é…ç½®æ–‡ä»¶ä¸­</p><p>å®‰è£…å®Œæˆåä½ æ‰“å¼€æ–‡ä»¶ <code>typings/browser.d.ts</code> å¯ä»¥çœ‹åˆ°:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path="main\ambient\react-dom\react-dom.d.ts" /&gt;</span></span><br><span class="line"><span class="comment">/// &lt;reference path="main\ambient\react\react.d.ts" /&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>åœ¨å…¶ä»–æ–‡ä»¶ä¸­ä½¿ç”¨è¿™äº›ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œåªéœ€è¦å¼•ç”¨<code>typings/browser.d.ts</code>æ–‡ä»¶å³å¯ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path='../typings/browser.d.ts'/&gt;</span></span><br></pre></td></tr></table></figure><p></p><h2>å¼€å§‹ ç”¨ TypeScript ç¼–ç äº†</h2><p>å¤ªæ£’äº†! åˆ°è¿™é‡Œæˆ‘ä»¬ç»ˆäºæœ‰äº†ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„Typescriptå¼€å‘ç¯å¢ƒçš„ï¼Œå¯ä»¥å¼€å§‹ç¼–å†™TypeScript å’Œ Reactä»£ç ï¼Œå¹¶çœ‹çœ‹å®ƒä»¬æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ¥ä¸‹æ¥çš„ä»£ç æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„çº¦å®šï¼Œåœ¨<code>./source</code>ç›®å½•æ·»åŠ ä½ çš„ä»£ç ï¼Œå¥½äº†ï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªæœ€ç®€å•çš„React ç¤ºä¾‹å¼€å§‹å§:</p><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/sample01" target="_blank" rel="noopener">Example 1 - HelloWorld</a></h2><p>åœ¨ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬è¦ç¼–å†™ä¸€ä¸ªæœ€ç®€å•èƒ½æ­£å¸¸è¿è¡Œçš„åº”ç”¨ï¼Œæ°”æ­»å°±æ˜¯ <code>Helloworld</code> åœ¨ <code>source</code> ç›®å½•ä¸‹æ–°å»º <code>example01/</code> æ–‡ä»¶å¤¹ï¼Œå¹¶æ·»åŠ ç¬¬ä¸€ä¸ª TypeScript æ–‡ä»¶ :</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/sample01/app.tsx" target="_blank" rel="noopener">app.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path='../../typings/browser.d.ts'/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;div&gt;Hello, World!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">ReactDOM.render(&lt;HelloWorld/</span>&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>));</span><br></pre></td></tr></table></figure><p></p><p>è¿™é‡Œæˆ‘ä»¬æ¥ä¸€èµ·çœ‹ä¸€çœ‹ï¼Œè¿™ä¸ªä»£ç æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼š</p><p>å…ˆæ¥çœ‹çœ‹ç¬¬ä¸€è¡Œä»£ç ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path='../../typings/browser.d.ts'/&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>ä½¿ç”¨äº† <a href="http://blogs.msdn.com/b/webdev/archive/2007/11/06/jscript-intellisense-a-reference-for-the-reference-tag.aspx" target="_blank" rel="noopener">Reference æ ‡ç­¾</a>æ¥å¼•ç”¨æ‰€æœ‰çš„ä¹‹å‰é€šè¿‡<strong>typings</strong>å®‰è£…çš„ <a href="https://github.com/DefinitelyTyped/DefinitelyTyped" target="_blank" rel="noopener">Definitely Typed</a> æ–‡ä»¶</p><p>çœ‹ä¸€ä¸‹ <code>import</code> è¯­å¥:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br></pre></td></tr></table></figure><p></p><p>å¯¼å…¥ä¹‹å‰ä½¿ç”¨ <code>npm</code> å‘½ä»¤å®‰è£…çš„Javascriptæ¨¡å— ï¼ˆæ³¨ï¼šTypescriptä¸­å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹Javascriptåº“ï¼Œä½†æ˜¯å¿…é¡»æä¾›ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œæ²¡æœ‰çš„è¯éœ€è¦å†™ä¸€ä¸ªï¼‰, <code>*</code> å·è¡¨ç¤ºå¯¼å…¥æ•´ä¸ªæ¨¡å—ï¼Œå¦‚æœä½ å¸Œæœ›åªå¯¼å…¥ä¸€ä¸ªæ¨¡å—çš„è¯ ï¼Œä½ å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br></pre></td></tr></table></figure><p></p><p>å”¯ä¸€çš„ä¾‹å¤–æ˜¯åœ¨ <code>.tsx</code>æ–‡ä»¶ä¸­ï¼Œå¿…é¡»å¯¼å…¥ <strong>React</strong>æ¨¡å—ï¼Œå¦åˆ™åœ¨ä½¿ç”¨JSXä»£ç å—æ—¶ä¼šå‘ç”Ÿç¼–è¯‘é”™è¯¯ï¼š</p><pre><code>return &lt;div&gt;Hello, World!&lt;/div&gt;; //compile error: Cannot find name React
</code></pre><p>ä¸‹é¢çš„ä»£ç æ˜¯åˆ›å»ºä¸€ä¸ªç»„ä»¶ï¼ˆcomponentï¼‰ç»§æ‰¿è‡³ Reactçš„<code>Component&lt;TProps,TState&gt;</code>åŸºç±»ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br></pre></td></tr></table></figure><p></p><p>å½“æˆ‘ä»¬çš„ç»„ä»¶ï¼ˆComponentsï¼‰ ä¸åŒ…å«ä»»ä½•ç‰¹å®šçš„å±æ€§ï¼ˆ propertyï¼‰å’ŒçŠ¶æ€ï¼ˆstateï¼‰æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>any</code> ç±»å‹æ¥å¿½ç•¥ä¸€äº›ç‰¹æ®Šçš„ç±»å‹ When Components doesn't have any properties or state they can use <code>any</code> to ignore specifying types.</p><p>æˆ‘ä»¬ä¹‹å‰åœ¨TypeScripté…ç½®ä¸­å·²ç»å¯ç”¨äº†jsxè¯­æ³•æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨**.tsx** ä½¿ç”¨jsxè¯­æ³•äº†ï¼ˆæ³¨ï¼šå’Œé…ç½®æ²¡å•¥å…³ç³»ï¼Œé…ç½®åªæ˜¯ç”¨æ¥ç¼–è¯‘ç”Ÿæˆä»£ç çš„ï¼Œtsxå¤©ç”Ÿå°±æ˜¯æ”¯æŒjsxè¯­æ³•çš„ï¼‰</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> &lt;div&gt;Hello, World!&lt;<span class="regexp">/div&gt;;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>æœ€åä¸€è¡Œæ˜¯ä¸€ä¸ªæ ‡å‡†çš„Reactä»£ç ï¼Œå®ƒæ„æ€æ˜¯åœ¨<code>#content</code> DOM èŠ‚ç‚¹ä¸­è¾“å‡ºæˆ‘ä»¬çš„ <code>HelloWorld</code> ç»„ä»¶ï¼ˆcomponentï¼‰çš„å®ä¾‹ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ReactDOM.render(&lt;HelloWorld/&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>));</span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨ï¼Œæ‰€æœ‰å‰©ä¸‹çš„å°±æ˜¯å»ºç«‹ä¸€ä¸ªHTMLé¡µé¢æ¥å®¹çº³æˆ‘ä»¬çš„åˆšåˆšç¼–å†™çš„ç»„ä»¶å•¦ï¼ˆcomponentï¼‰ï¼š</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/sample01/index.html" target="_blank" rel="noopener">index.html</a></h4><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>TypeScript + React + Redux<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Example 2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/lib/react/react.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/lib/react/react-dom.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/sample02.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><blockquote><p><strong>index.html</strong> æ˜¯ä¸€ä¸ªåœ¨ASP.NETä¸­é¢„å®šä¹‰çš„é»˜è®¤æ–‡æ¡£ï¼Œç”¨æ¥è®©æˆ‘ä»¬å¯ä»¥æµè§ˆä¹‹å‰ç¼–å†™çš„ç»„ä»¶æ•ˆæœï¼Œå®ƒè¢«å®‰æ’åœ¨å„ä¸ªç¤ºä¾‹æ–‡ä»¶å¤¹ä¸­ï¼Œåƒæˆ‘ä¹‹å‰è¯´çš„é‚£æ ·ï¼Œå¹¶ä¸æ˜¯éè¦æ”¾åœ¨è¿™é‡Œï¼Œåªæ˜¯ä¸ºäº†æ›´å¥½çš„ç»„ç»‡urlã€‚ä¸Šè¿°çš„ index.htmlåœ¨ç›®å½•<code>/example01/</code>ä¸­ã€‚</p></blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥ <code>react.min.js</code> å’Œ <code>react-dom.min.js</code> æ–‡ä»¶ï¼Œä¹‹å‰æœ‰è°ˆåˆ°è¿‡ï¼Œwebpack.config.jsé…ç½®ä¸­è®¾ç½®reactæœ¬èº«ä¸è¢«æ‰“åŒ…ï¼Œè€Œæ˜¯å•ç‹¬å¼•ç”¨ã€‚ä¸€äº›é€šç”¨çš„ç¬¬ä¸‰æ–¹ç±»åº“ï¼Œä¸ºäº†æ›´å¥½çš„ä½¿ç”¨CDNå’Œç¼“å­˜ï¼Œå¯ä»¥ä½¿ç”¨å•ç‹¬å¼•ç”¨çš„æ–¹å¼ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œå“ªç§æ–¹å¼è¦çœ‹å®é™…çš„æƒ…å†µã€‚</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/lib/react/react.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/lib/react/react-dom.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>åŒæ—¶æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ª <code>sample02.js</code>çš„æ–‡ä»¶ï¼Œè¿™æœ‰ç‚¹å¥‡æ€ªï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶æˆ‘ä»¬å¹¶æ²¡æœ‰åˆ›å»ºï¼Œå®ƒè¿™æ—¶ç¡®å®ä¹Ÿå¹¶ä¸å­˜åœ¨</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../../wwwroot/js/sample02.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>è¿™å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å¤„ç†çš„é—®é¢˜ï¼Œä¹‹å‰æˆ‘ä»¬è®²åˆ°æˆ‘ä¼šä½¿ç”¨ <code>webpack</code> æ¥ ä»£æ›¿é»˜è®¤ä½¿ç”¨ <code>VS.NET 2015</code> ä½œä¸º <code>Typescript</code> çš„ç¼–è¯‘å™¨ï¼Œ<code>sample02.js</code>æ–‡ä»¶å…¶å®æ˜¯ <code>webpack</code> è‡ªåŠ¨ç”Ÿæˆçš„æ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™å®ƒä¸å­˜åœ¨ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰é…ç½®å¥½å®ƒï¼Œè®©æˆ‘ä»¬é‡æ–°æ‰“å¼€<code>webpack.config.js</code>æ–‡ä»¶ï¼Œçœ‹çœ‹é‡Œé¢çš„å†…å®¹ï¼š</p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">   entry: &#123;</span><br><span class="line">        sample01: "./source/sample01/app.tsx" //å°†ç¤ºä¾‹1çš„app.tsxæ–‡ä»¶ä½œä¸ºå…¥å£æ–‡ä»¶</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: "./wwwroot/js/[name].js",</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// Enable sourcemaps for debugging webpack's output.</span></span><br><span class="line">    devtool: "source-map",</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        <span class="comment">// Add '.ts' and '.tsx' as resolvable extensions.</span></span><br><span class="line">        extensions: ["", ".webpack.js", ".web.js", ".ts", ".tsx", ".js"]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    module: &#123;</span><br><span class="line">        loaders: [</span><br><span class="line">            <span class="comment">// All files with a '.ts' or '.tsx' extension will be handled by 'ts-loader'.</span></span><br><span class="line">            &#123; test: /\.tsx?$/, loader: "ts-loader" &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br><span class="line">        preLoaders: [</span><br><span class="line">            <span class="comment">// All output '.js' files will have any sourcemaps re-processed by 'source-map-loader'.</span></span><br><span class="line">            &#123; test: /\.js$/, loader: "source-map-loader" &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// When importing a module whose path matches one of the following, just</span></span><br><span class="line">    <span class="comment">// assume a corresponding global variable exists and use that instead.</span></span><br><span class="line">    <span class="comment">// This is important because it allows us to avoid bundling all of our</span></span><br><span class="line">    <span class="comment">// dependencies, which allows browsers to cache those libraries between builds.</span></span><br><span class="line">    externals: &#123;</span><br><span class="line">        "react": "React",</span><br><span class="line">        "react-dom": "ReactDOM"</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>å’Œä¹‹å‰çš„å†…å®¹ç›¸æ¯”ï¼Œåªä¿®æ”¹äº† <code>entry</code> é…ç½®èŠ‚ï¼Œå°† <code>./source/sample01/app.tsx</code> ä½œä¸ºä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œå¹¶å‘½åä¸º <code>sample01</code>, è€Œè¾“å‡ºçš„ç›®å½•åˆ™æ˜¯ <code>./wwwroot/js/</code> å¹¶ä¸”ä»¥å…¥å£çš„åå­—ä½œä¸ºæ–‡ä»¶å <code>[name].js</code>,æ‰€ä»¥åœ¨ <code>index.html</code> æˆ‘å¼•å…¥çš„æ–‡ä»¶ <code>../../wwwroot/js/sample02.js</code></p><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    sample01: "./source/sample01/app.tsx" //å°†ç¤ºä¾‹1çš„app.tsxæ–‡ä»¶ä½œä¸ºå…¥å£æ–‡ä»¶</span><br><span class="line">&#125;,</span><br><span class="line">output: &#123;</span><br><span class="line">    filename: "./wwwroot/js/[name].js",</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p></p><p>å›åˆ° <code>index.html</code> æ–‡ä»¶ä¸­</p><p>æœ€åæ·»åŠ ä¸€ä¸ª <code>&lt;div/&gt;</code> ç©ºæ ‡ç­¾å…ƒç´ ï¼Œå¹¶è®¾ç½® <code>id</code> ä¸º <code>content</code> ç”¨æ¥è¾“å‡ºReactç»„ä»¶ã€‚</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨æ‰€æœ‰çš„å·¥ä½œåšå®Œåï¼Œæˆ‘ä»¬æ‰“å¼€æµè§ˆå™¨ç›´æ¥è®¿é—®<code>/example01/</code>æ¥æŸ¥çœ‹æ•ˆæœäº† -- å“ˆå“ˆï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªå¯è¿è¡Œçš„Reactåº”ç”¨ï¼</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-01.png" alt="æ­¤å¤„è¾“å…¥å›¾ç‰‡çš„æè¿°"></p><blockquote><p>Demo:<a href="http://xuanye.github.io/typescript-react/source/sample01/">/typescript-react/example01/</a></p></blockquote><p><strong>æç¤º</strong>ï¼š æˆ‘ä½¿ç”¨äº† <code>VS.NET 2015</code> ä½œä¸ºå¼€å‘å·¥å…·ï¼Œæ‰€ä»¥è‡ªå¸¦httpserver ï¼Œå¦‚æœä½ å¹¶ä¸æ˜¯ç”¨<code>VS.NET 2015</code> ï¼Œé‚£ä¹ˆå¯ä»¥ä»»æ„çš„ <code>http server</code> å·¥å…·æ¥æŸ¥çœ‹ç¤ºä¾‹ã€‚</p><p>å¦‚ä½¿ç”¨node çš„ <code>http-server</code>åŒ… å…¨å±€å®‰è£…ï¼š</p><pre><code>C:\proj&gt; npm install http-server -g
</code></pre><p>ç„¶ååœ¨é¡¹ç›®çš„æ ¹ç›®å½•è¿è¡Œï¼š</p><pre><code>C:\proj&gt; http-server
</code></pre><p>æ‰“å¼€æµè§ˆå™¨ æŸ¥çœ‹ ï¼š<code>http://localhost:8080/source/sample01/index.html</code></p><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example02" target="_blank" rel="noopener">Example 2 - æ¨¡å—åŒ– HelloWorld</a></h2><p>åœ¨ç¬¬äºŒä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†å°è¯•é€šè¿‡ç§»åŠ¨<code>&lt;HelloWorld /&gt;</code>çš„å®ç°åˆ°ç‹¬ç«‹çš„æ–‡ä»¶ä¸­æ¥æ¨¡å—åŒ–æˆ‘ä»¬çš„åº”ç”¨ï¼š</p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example02/helloworld.tsx" target="_blank" rel="noopener">helloworld.tsx</a></h3><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HelloWorld <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;div&gt;Hello world!It<span class="string">'s from Helloword Component.&lt;/div&gt;;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>ä¸ºäº†è®©HelloWorldç»„ä»¶åœ¨å¤–éƒ¨å¯ä»¥è¢«è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>export</code> å…³é”®å­—ã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨ <code>default</code> å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ª<strong>é»˜è®¤å¯¼å‡º</strong>ï¼ˆ<strong>default export</strong>ï¼‰ï¼Œè®©ä½¿ç”¨è€…å¯¼å…¥çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿ï¼Œå¹¶å¯ä»¥é‡å‘½åç§°å®ƒä»¬å–œæ¬¢çš„åå­—ï¼Œç„¶åæˆ‘ä»¬éœ€è¦ç§»é™¤åœ¨<strong>app.tsx</strong>ä¸­çš„HelloWorldå®ç°ï¼Œå¹¶ç”¨import æ–°ç»„ä»¶çš„æ–¹å¼ä»£æ›¿å®ƒï¼š</p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example02/app.tsx" target="_blank" rel="noopener">app.tsx</a></h3><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/ &lt;reference path=<span class="string">'../../typings/browser.d.ts'</span>/&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;HelloWorld&#125; <span class="keyword">from</span> <span class="string">"./helloworld"</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(&lt;HelloWorld/&gt;, <span class="built_in">document</span>.getElementById(<span class="string">"content"</span>));</span><br></pre></td></tr></table></figure><p></p><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨<strong>é»˜è®¤å¯¼å‡º</strong>ï¼ˆ<strong>default export</strong>ï¼‰ï¼Œé‚£ä¹ˆå¯¼å…¥çš„éƒ¨åˆ†å°±æ˜¯è¿™æ ·çš„ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span>  HelloWorld  <span class="keyword">from</span> <span class="string">'./HelloWorld'</span>;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ªç¤ºä¾‹çš„æ”¹åŠ¨éå¸¸å°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºæ˜¯å¦è¿˜èƒ½æ­£å¸¸è¿è¡Œã€‚</p><blockquote><p>æ³¨ï¼šè¿™é‡Œè¦æ³¨æ„æˆ‘ä»¬ä»éœ€åœ¨webpack.config.jsä¸­æ·»åŠ  entry ï¼Œåç»­çš„ç¤ºä¾‹ä¸å†é‡å¤äº†</p></blockquote><p></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">entry: &#123;</span><br><span class="line">    sample01: "./source/sample01/app.tsx",</span><br><span class="line">    sample02: "./source/sample02/app.tsx"</span><br><span class="line">&#125;,</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p></p><p>[<img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-02.png" alt>]</p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example02/">/typescript-redux/example02/</a></p></blockquote><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example03" target="_blank" rel="noopener">Example 3 - åˆ›å»ºä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶</a></h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ˜¯Helloworldç•Œçš„å¤§å¸ˆäº†ï¼Œåº”è¯¥å‡çº§ä¸‹æˆ‘ä»¬çš„æ¸¸æˆè§„åˆ™ï¼Œåˆ›å»ºä¸€äº›æ›´é«˜çº§çš„æœ‰çŠ¶æ€çš„ç»„ä»¶äº†ï¼Œæ¯•ç«Ÿä¸èƒ½100çº§äº†ï¼Œè¿˜åœ¨æ–°æ‰‹æ‘ã€‚</p><p>æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶ä¼Ÿå¤§çš„äº‹æƒ…å°±æ˜¯è®¡æ•°å™¨ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬æŠŠç¤ºä¾‹ä¸­çš„ <code>helloword</code> æ–‡ä»¶ä¿®æ”¹æ–‡ä»¶åä¸º <code>counter</code> å¹¶æŠŠå†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example03/counter.tsx" target="_blank" rel="noopener">counter.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">constructor</span>(<span class="params">props, context</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props, context);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; counter: <span class="number">0</span> &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;Counter: &lt;<span class="regexp">/label&gt;&lt;b&gt;#&#123;this.state.counter&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; this.incr(1) &#125;&gt;INCREMENT&lt;/</span>button&gt;</span><br><span class="line">                &lt;span style=&#123;&#123; padding: <span class="string">"0 5px"</span> &#125;&#125; /&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.incr(<span class="number">-1</span>) &#125;&gt;DECREMENT&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    incr(by:<span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; counter: <span class="keyword">this</span>.state.counter + by &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>å¥½åƒæ²¡ä»€ä¹ˆæƒŠå–œï¼Œæˆ‘ä»¬åœ¨é¡µé¢ä¸­æ·»åŠ äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œé€šè¿‡æŒ‰é’® increment / decrement æ¥æ”¹å˜å®ƒçš„å€¼ï¼Œ å®é™…ä½¿ç”¨çš„æ˜¯Reactå†…ç½®çš„<code>setState()</code>æ–¹æ³•:</p><p><a href="http://xuanye.github.io/typescript-react/source/example03/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-03.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example03/">/typescript-redux/example03/</a></p></blockquote><h3>ä½¿ç”¨ Redux</h3><p>ä½¿ç”¨ <code>setState()</code> æ˜¯åœ¨ç»„ä»¶ä¸­æ”¹å˜çŠ¶æ€çš„è€åŠæ³•äº†ï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„æ˜¯ä½¿ç”¨ <a href="https://github.com/rackt/redux" target="_blank" rel="noopener">Redux</a>ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…ä¸€ä¸‹:</p><pre><code>C:\proj&gt; npm install redux --save
</code></pre><p>åŒæ ·ä¹Ÿè¦å®‰è£…å®ƒçš„å®šä¹‰æ–‡ä»¶ Type Definitions:</p><pre><code>C:\proj&gt; typings install redux --ambient --save
</code></pre><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example04" target="_blank" rel="noopener">Example 4 - ä½¿ç”¨ Redux æ”¹é€ è®¡æ•°å™¨</a></h2><p>å¦‚æœä½ å¯¹Redux è¿˜ä¸å¤ªç†Ÿæ‚‰ï¼Œç°åœ¨æ˜¯å¼€å§‹çš„æ—¶å€™,ä¸‹é¢æ˜¯ä¸€äº›ç›¸å…³çš„é—®é¢˜ï¼ˆä¸è¿‡ä¸‹é¢çš„ç½‘ç«™åœ¨å¤©æœåŸºæœ¬éƒ½æ‰“ä¸å¼€ï¼‰ï¼š</p><ul><li><a href="http://rackt.org/redux/" target="_blank" rel="noopener">Redux docs</a></li><li><a href="https://egghead.io/series/getting-started-with-redux" target="_blank" rel="noopener">30 short videos</a></li><li><a href="https://twitter.com/dan_abramov" target="_blank" rel="noopener">@dan_abramov</a></li></ul><p>è¿™é‡Œæ¨èä¸¤ä¸ªä¸­æ–‡åœ¨çº¿æ–‡æ¡£å§ï¼Œè™½ç„¶ä¹Ÿç»å¸¸æ‰“ä¸å¼€ï¼š</p><ul><li><a href="http://cn.redux.js.org" target="_blank" rel="noopener">Reduxä¸­æ–‡æŒ‡å—</a></li><li><a href="https://github.com/react-guide/redux-tutorial-cn" target="_blank" rel="noopener">Redux tutorial ä¸­æ–‡</a></li></ul><p>Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚</p><p>å¯ä»¥è®©ä½ æ„å»ºä¸€è‡´åŒ–çš„åº”ç”¨ï¼Œè¿è¡Œäºä¸åŒçš„ç¯å¢ƒï¼ˆå®¢æˆ·ç«¯ã€æœåŠ¡å™¨ã€åŸç”Ÿåº”ç”¨ï¼‰ï¼Œå¹¶ä¸”æ˜“äºæµ‹è¯•ã€‚ä¸ä»…äºæ­¤ï¼Œå®ƒè¿˜æä¾› è¶…çˆ½çš„å¼€å‘ä½“éªŒï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªæ—¶é—´æ—…è¡Œè°ƒè¯•å™¨å¯ä»¥ç¼–è¾‘åå®æ—¶é¢„è§ˆã€‚</p><p>Redux é™¤äº†å’Œ React ä¸€èµ·ç”¨å¤–ï¼Œè¿˜æ”¯æŒå…¶å®ƒç•Œé¢åº“ã€‚ å®ƒä½“å°ç²¾æ‚ï¼ˆåªæœ‰2kBï¼‰ä¸”æ²¡æœ‰ä»»ä½•ä¾èµ–ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“Redux æ˜¯ä»€ä¹ˆäº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹æ”¹é€ æˆ‘ä»¬çš„è®¡æ•°å™¨ï¼š</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example04/Counter.tsx" target="_blank" rel="noopener">counter.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'INCR'</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123; counter: state.counter + action.by &#125;;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; counter: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> unsubscribe: <span class="built_in">Function</span>;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.forceUpdate());</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;Counter: &lt;<span class="regexp">/label&gt;&lt;b&gt;#&#123;store.getState().counter&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; store.dispatch(&#123; type:'INCR', by: 1 &#125;) &#125;&gt;INCREMENT&lt;/</span>button&gt;</span><br><span class="line">                &lt;span style=&#123;&#123; padding: <span class="string">"0 5px"</span> &#125;&#125; /&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> store.dispatch(&#123; <span class="keyword">type</span>:<span class="string">'INCR'</span>, by: <span class="number">-1</span> &#125;) &#125;&gt;DECREMENT&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3>åˆ›å»ºä¸€ä¸ª Redux Store</h3><p>å¼•ç”¨<strong>redux</strong>æ¨¡å—çš„ <code>createStore</code>æ–¹æ³•ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªRedux store ï¼Œå¹¶ä¼ é€’é»˜è®¤çš„state:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'INCR'</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123; counter: state.counter + action.by &#125;;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; counter: <span class="number">0</span> &#125;);</span><br></pre></td></tr></table></figure><p></p><p>å› ä¸ºæˆ‘ä»¬çš„è®¡æ•°å™¨åªæœ‰ä¸€ä¸ªAction ï¼Œæˆ‘ä»¬çš„reducerï¼ˆReduxä¸­çš„ä¸“æœ‰åè¯ï¼Œå³å¤„ç†Actionçš„å‡½æ•°ï¼‰çš„å®ç°å°±æ¯”è¾ƒç®€å• - è¿”å›æ›´æ–°çš„è®¡æ•°å™¨å¯¹è±¡</p><p>å¦å¤–ä¸€ä»¶æˆ‘ä»¬éœ€è¦çŸ¥é“çš„å…³äºReduxçš„äº‹æƒ…æ˜¯Reduxæ˜¯ç‹¬ç«‹äºReactçš„ï¼Œå¹¶ä¸åƒ <code>setState()</code> é‚£æ ·å†…ç½®åœ¨å…¶ä¸­çš„ã€‚Reactå¹¶ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™ä½ çš„Redux Storeä¸­çš„Stateå‘ç”Ÿäº†å˜åŒ–--å…¶å®æ˜¯éœ€è¦çŸ¥é“çš„ï¼Œå› ä¸ºä½ çš„ç»„ä»¶è¦çŸ¥é“ä»€ä¹ˆæ—¶å€™éœ€è¦é‡ç»˜ã€‚å› ä¸ºè¿™ä¸ªï¼Œæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªç›‘å¬å™¨æ¥è§‚å¯Ÿ storeçš„stateå˜åŒ–æ¥å¼ºåˆ¶è§¦å‘ç»„ä»¶çš„é‡ç»˜ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> unsubscribe: <span class="built_in">Function</span>;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.forceUpdate());</span><br><span class="line">&#125;</span><br><span class="line">componentWillUnmount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æˆ‘ä»¬è¿˜éœ€è¦å°†ä¿®æ”¹ç»„ä»¶é€šè¿‡<code>store.getState()</code> æ–¹æ³•è¯»å–å®ƒçš„stateä¿¡æ¯ï¼Œå¹¶ä¿®æ”¹ä¹‹å‰çš„å†…ç½®æ–¹å¼<code>setState()</code>æ–¹æ³•ä¸ºè§¦å‘ä¸€ä¸ªActionæ¥ä¿®æ”¹æˆ‘ä»¬åº”ç”¨çš„state ã€‚</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;label&gt;Counter: &lt;<span class="regexp">/label&gt;&lt;b&gt;#&#123;store.getState().counter&#125;&lt;/</span>b&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">            &lt;button onClick=&#123;e =&gt; store.dispatch(&#123; type:'INCR', by: 1 &#125;) &#125;&gt;INCREMENT&lt;/</span>button&gt;</span><br><span class="line">            &lt;span style=&#123;&#123; padding: <span class="string">"0 5px"</span> &#125;&#125; /&gt;</span><br><span class="line">            &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> store.dispatch(&#123; <span class="keyword">type</span>:<span class="string">'INCR'</span>, by: <span class="number">-1</span> &#125;) &#125;&gt;DECREMENT&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨æˆ‘ä»¬çš„è®¡æ•°å™¨å·²ç»&quot;ReduxåŒ–&quot;äº†ï¼Œé‡æ–°è¿è¡Œä¸€ä¸‹ç¤ºä¾‹ï¼Œå¹¶çœ‹çœ‹å’Œä¹‹å‰çš„æ•ˆæœæ˜¯å¦ä¸€è‡´ï¼Ÿ</p><p><a href="http://xuanye.github.io/typescript-react/source/example04/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-04.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example04/">/typescript-redux/example04/</a></p></blockquote><h2>å®‰è£… React Redux</h2><p>åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨<code>Counter</code>æ¨¡å—ä¸­åˆ›å»ºäº† Redux store æ¥å¸®åŠ©æˆ‘ä»¬ä¼˜åŒ–ä»£ç ã€‚å› ä¸ºä½ çš„åº”ç”¨åº”è¯¥åªæœ‰ä¸€ä¸ªStoreï¼Œæ‰€ä»¥è¿™ä¸æ˜¯ä¸€ä¸ªæ­£ç¡®ä½¿ç”¨å®ƒçš„æ–¹å¼ ï¼ˆå…³äºè¿™ä¸ªåŸåˆ™ï¼Œä½ éœ€è¦å‚çœ‹Reduxçš„ç›¸å…³æ–‡æ¡£ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨Reduxçš„Reactå¸®åŠ©åº“æ¥å¸®æˆ‘ä»¬æ”¹å–„è¿™ç§æƒ…å†µã€‚</p><p>äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬ç»“åˆReduxå’ŒReactçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»å®‰è£…çš„ä¸€ä¸ªåŒ…å°±æ˜¯<code>react-redux</code>ï¼Œå®ƒåŒæ ·å¯ä»¥é€šè¿‡ <strong>npm</strong> æ–¹å¼å®‰è£…</p><pre><code>C:\proj&gt; npm install react-redux --save
</code></pre><p>å’Œå¤§å¤šæ•°æµè¡Œçš„ç±»åº“ä¸€æ ·ï¼Œå®ƒä¹Ÿå·²ç»æœ‰äº†ç±»å‹å®šä¹‰æ–‡ä»¶äº†ï¼Œä¸€èµ·æ¥å®‰è£…ä¸€ä¸‹å§ï¼š</p><pre><code>C:\proj&gt; typings install react-redux --ambient --save
</code></pre><h2><a href="https://github.com/ServiceStackApps/typescript-redux/tree/master/src/TypeScriptRedux/src/example05" target="_blank" rel="noopener">Example 5 - ä½¿ç”¨ Provider æ³¨å…¥storeåˆ°çº¸å®¹å™¨çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ä¸­</a></h2><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°† Redux store ç§»åŠ¨åˆ°ä¸Šä¸€å±‚çš„<strong>app.tsx</strong> æ–‡ä»¶ä¸­ï¼Œå°±åƒè¿™æ ·</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example05/app.tsx" target="_blank" rel="noopener">app.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">"./counter"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">'INCR'</span>:</span><br><span class="line">                <span class="keyword">return</span> &#123; counter: state.counter + action.by &#125;;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123; counter: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">    &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">        &lt;Counter /&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">    document.getElementById("content"));</span></span><br></pre></td></tr></table></figure><p></p><p>ä¸ºäº†ä¼ é€’storeåˆ°æˆ‘ä»¬çš„ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†<a href="https://facebook.github.io/react/docs/context.html" target="_blank" rel="noopener">React's child context</a> ç‰¹æ€§ ï¼Œ åœ¨ <strong>react-redux</strong> å°è£…äº† <code>&lt;Provider/&gt;</code>ç»„ä»¶ ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨å°±å¯ä»¥äº†ã€‚</p><p>ä¸ºäº†è®©ReactçŸ¥é“ æˆ‘ä»¬å¸Œæœ›æŠŠstoreæ³¨å…¥åˆ°æˆ‘ä»¬çš„ <code>Counter</code> ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®šä¹‰ä¸ªé™æ€çš„<code>contextTypes</code> å±æ€§ åˆ¶å®šcontextä¸­éœ€è¦çš„å†…å®¹ï¼š</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example05/counter.tsx" target="_blank" rel="noopener">counter.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    context: <span class="built_in">any</span>;</span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        store: React.PropTypes.object</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> unsubscribe: <span class="built_in">Function</span>;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = <span class="keyword">this</span>.context.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.forceUpdate());</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;Counter: &lt;<span class="regexp">/label&gt;&lt;b&gt;#&#123;this.context.store.getState().counter&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; this.context.store.dispatch(&#123; type:'INCR', by: 1 &#125;) &#125;&gt;INCREMENT&lt;/</span>button&gt;</span><br><span class="line">                &lt;span style=&#123;&#123; padding: <span class="string">"0 5px"</span> &#125;&#125; /&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.context.store.dispatch(&#123; <span class="keyword">type</span>:<span class="string">'INCR'</span>, by: <span class="number">-1</span> &#125;) &#125;&gt;DECREMENT&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ”¹åŠ¨å¯¹é¡µé¢æ²¡ä»€ä¹ˆå½±å“ï¼Œæˆ‘ä»¬çš„ç¨‹åºåº”è¯¥è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œï¼š</p><p><a href="http://xuanye.github.io/typescript-react/source/example05/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-05.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example05/">/typescript-redux/example05/</a></p></blockquote><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example06" target="_blank" rel="noopener">Example 6 - ä½¿ç”¨ connect() åˆ›å»ºæ— çŠ¶æ€çš„ç»„ä»¶</a></h2><p>æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä¸€äº›ç¤ºä¾‹ç¨‹åºï¼Œç°åœ¨å“¦æˆ‘ä»¬å›è¿‡å¤´æ¥é‡æ–°çœ‹çœ‹ä¸€ä¸‹ã€‚åœ¨ä¸Šä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>Provider</code> ç»„ä»¶æ¥ä¼ é€’ stateåˆ°æˆ‘ä»¬çš„å­ç»„ä»¶ï¼Œ<strong>react-redux</strong> åŒæ ·ä¹Ÿæä¾›äº†ä¸€äº›å…¶ä»–çš„æ–¹å¼ã€‚</p><p>Reduxçš„ <code>connect()</code> å‡½æ•°è¿”å›ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„ç»„ä»¶ï¼Œå®ƒå¯ä»¥è®©ç»„ä»¶å˜å¾—æ— çŠ¶æ€ï¼ˆstatelessï¼‰, é€šè¿‡å°†stateå’Œcallbackå‡½æ•°æ˜ å°„åˆ°ç»„ä»¶çš„å±æ€§ä¸Šï¼ˆpropertiesï¼‰ä»¥é™ä½ç»„ä»¶å’ŒRedux Storeçš„è€¦åˆåº¦ï¼š</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example06/counter.tsx" target="_blank" rel="noopener">counter.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;Counter: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;#&#123;this.props.counter&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; this.props.incr() &#125;&gt;INCREMENT&lt;/</span>button&gt;</span><br><span class="line">                &lt;span style=&#123;&#123; padding: <span class="string">"0 5px"</span> &#125;&#125; /&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.props.decr() &#125;&gt;DECREMENT&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">    incr: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123; <span class="keyword">type</span>: <span class="string">'INCR'</span>, by: <span class="number">1</span> &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    decr: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123; <span class="keyword">type</span>: <span class="string">'INCR'</span>, by: <span class="number">-1</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Counter);</span><br></pre></td></tr></table></figure><p></p><p>ä¸ºäº†è¾¾åˆ°è¿™ä¸ªæ•ˆæœï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€ä¸ª <strong>mapStateToProps</strong> çš„å‡½æ•° ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ç»„ä»¶æ‰€éœ€è¦çš„æ‰€æœ‰çŠ¶æ€ï¼ˆstateï¼‰ã€‚ æˆ‘ä»¬çš„ç»„ä»¶ä»ç„¶éœ€è¦æ›´æ–°çŠ¶æ€ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä¼ é€’ä¸€ä¸ª <strong>mapDispatchToProps</strong> çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°é€šè¿‡è°ƒç”¨ï¼Œå°†ç»„ç»‡éœ€è¦ä¼ é€’åˆ°Redux actionçš„å‚æ•°ï¼Œå¹¶è§¦å‘å¯¹åº”åœ¨storeä¸­æ³¨å†Œçš„Reduceã€‚</p><p>Reduxçš„ <code>connect()</code> ä¼šå°†ä¸Šè¿°å‡½æ•°ç»„åˆåˆ°ä¸€ä¸ªæ›´é«˜ä¸€çº§çš„ç»„ä»¶ä¸­ï¼Œå¹¶è®¢é˜…Redux storeçš„å˜åŒ–ï¼Œé€šè¿‡æ›´æ–°stateæ¥æ”¹å˜ç»„ä»¶çš„å±æ€§å¹¶é‡ç»˜ï¼ˆå®é™…ä¸Šçš„å­ç»„ä»¶ï¼‰ <code>Counter</code> ç»„ä»¶</p><p>è¿™äº›ä¿®æ”¹å¯¹é¡µé¢æ¥è¯´ä»ç„¶æ˜¯é€æ˜çš„ï¼Œä½ å¯ä»¥æ‰“å¼€å¹¶é‡æ–°è¯•è¯•å®ƒçš„åŠŸèƒ½</p><p><a href="http://xuanye.github.io/typescript-react/source/example06/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-05.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example06/">/typescript-redux/example06/</a></p></blockquote><h2>å®‰è£… es6-shim</h2><p>åŸæ–‡ä¸­çš„è¿™ä¸ªç« èŠ‚æ˜¯ä¸ºäº†åˆå¹¶å¯¹è±¡ï¼Œå®‰è£…es6-shimï¼Œå¹¶ä½¿ç”¨å…¶ä¸­çš„ <code>Object.assign()</code> æ–¹æ³•ï¼Œæˆ‘ä» <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign" target="_blank" rel="noopener">Object.assign()</a>è¿™é‡Œå¤åˆ¶äº†Polyfillå¦‚ä¸‹ï¼Œè€Œæ²¡æœ‰ä½¿ç”¨ es6-shim ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">Object</span>.assign != <span class="string">'function'</span>) &#123;</span><br><span class="line">  (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Object</span>.assign = <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line"><span class="meta">      'use strict'</span>;</span><br><span class="line">      <span class="keyword">if</span> (target === <span class="literal">undefined</span> || target === <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">'Cannot convert undefined or null to object'</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> output = <span class="built_in">Object</span>(target);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">var</span> index = <span class="number">1</span>; index &lt; <span class="built_in">arguments</span>.length; index++) &#123;</span><br><span class="line">        <span class="keyword">var</span> source = <span class="built_in">arguments</span>[index];</span><br><span class="line">        <span class="keyword">if</span> (source !== <span class="literal">undefined</span> &amp;&amp; source !== <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">var</span> nextKey <span class="keyword">in</span> source) &#123;</span><br><span class="line">            <span class="keyword">if</span> (source.hasOwnProperty(nextKey)) &#123;</span><br><span class="line">              output[nextKey] = source[nextKey];</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> output;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07" target="_blank" rel="noopener">Example 7 - Shape Creator</a></h2><p>æˆ‘ä»¬çš„ä¸‹ä¸€ä¸ªä¾‹å­ æˆ‘ä»¬å°†æ‰©å±•Reduxåˆ›å»ºä¸€ä¸ªæ›´å¤§ï¼Œæ›´é«˜çº§çš„çœŸå®çš„åº”ç”¨ç¨‹åºï¼Œé€šè¿‡è¿™ä¸ªä¾‹å­è¿›ä¸€æ­¥æ¢ç´¢å®ƒçš„å¥½å¤„ã€‚å› ä¸ºè¿™ä¸ªä¸–ç•Œä¸éœ€è¦å¦å¤–ä¸€ä¸ª<a href="http://todomvc.com" target="_blank" rel="noopener">TodoMVC</a>åº”ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘è®¡åˆ’åˆ›å»ºå¦å¤–ä¸€ä¸ªå½¢çŠ¶ç”Ÿæˆåº”ç”¨ä»£æ›¿ï¼Œå®ƒæä¾›æ›´å¤šçš„è§†è§’å»è§‚å¯ŸçŠ¶æ€çš„å˜åŒ–ã€‚</p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/counter.tsx" target="_blank" rel="noopener">Counter.tsx</a></h3><p>æˆ‘ä»¬å°†å¼€å§‹åˆ›å»ºé€šè¿‡è®¡æ•°å™¨ï¼ˆCounterï¼‰æ¥æ§åˆ¶æ§ä»¶çš„å®½åº¦å’Œé«˜åº¦ï¼Œä¸ºäº†è¾¾åˆ°è¿™æ•ˆæœï¼Œéœ€è¦é‡æ„ä¸€ä¸‹æˆ‘ä»¬çš„ <code>Counter</code> ç»„ä»¶ï¼Œå®šä¹‰ä¸ª<code>field</code>çš„å±æ€§æ¥ç¡®å®šåº”è¯¥ä¿®æ”¹å“ªä¸ªçŠ¶æ€ï¼ˆwidth/heightï¼‰ï¼Œè®©å…¶å˜å¾—æ›´åŠ å¯å¤ç”¨ã€‚å¦å¤–å†å¢åŠ ä¸€ä¸ª <code>step</code> çš„å±æ€§æ¥æ§åˆ¶å˜åŒ–çš„å°ºåº¦ã€‚</p><p>å› ä¸ºæˆ‘ä»¬è¦å‘é€å¤šä¸ªActionï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€‚ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„Action Typeåå­—ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>{Type}_{Event}</code>æ ¼å¼æ¥é‡å‘½åå®ƒä»¬ï¼Œæ‰€ä»¥è®¡æ•°å™¨çš„Actionå˜æˆäº†<code>COUNTER_CHANGE</code></p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> Counter <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">var</span> field = <span class="keyword">this</span>.props.field, step = <span class="keyword">this</span>.props.step || <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;&#123;field&#125;: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;&#123;this.props.counter&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button style=&#123;&#123;width:30, margin:2&#125;&#125; onClick=&#123;e =&gt; this.props.decr(field, step)&#125;&gt;-&lt;/</span>button&gt;</span><br><span class="line">                &lt;button style=&#123;&#123;width:<span class="number">30</span>, margin:<span class="number">2</span>&#125;&#125; onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.props.incr(field, step)&#125;&gt;+&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> (&#123; counter: state[props.field] || <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">    incr: <span class="function">(<span class="params">field, step</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123; <span class="keyword">type</span>: <span class="string">'COUNTER_CHANGE'</span>, field, by: step &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    decr: <span class="function">(<span class="params">field, step</span>) =&gt;</span> &#123;</span><br><span class="line">        dispatch(&#123; <span class="keyword">type</span>: <span class="string">'COUNTER_CHANGE'</span>, field, by: <span class="number">-1</span> * step &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(Counter);</span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨å®ƒå˜å¾—å¯ä»¥å¤ç”¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªå®ä¾‹æ¥æ§åˆ¶æˆ‘ä»¬å½¢çŠ¶çš„Widthå’ŒHeightäº†ï¼š</p><p></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">field</span>=<span class="string">"width"</span> <span class="attr">step</span>=<span class="string">&#123;10&#125;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">field</span>=<span class="string">"height"</span> <span class="attr">step</span>=<span class="string">&#123;10&#125;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>å®ƒçœ‹ä¸Šå»å°±åƒè¿™æ ·:</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/shapes-dimensions.png" alt></p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/colorpicker.tsx" target="_blank" rel="noopener">colorpicker.tsx</a></h3><p>ä¸‹ä¸€ä¸ªç»„ä»¶æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ§åˆ¶é¢œè‰²çš„ç»„ä»¶ï¼Œ<strong>range</strong> INPUT æ§ä»¶éå¸¸é€‚åˆä½œä¸ºåŸºç¡€é¢œè‰²è°ƒèŠ‚å™¨çš„ç©ºé—´ï¼Œç±»ä¼¼ä¸€ä¸ªæ»‘åŠ¨æ¡ï¼ˆè¿™ä¸ªæ§ä»¶åœ¨IEçš„è€ç‰ˆæœ¬ä¸Šæ²¡æœ‰åŠæ³•è¯†åˆ«ï¼Œè¯·å¤§å®¶ä¸è¦ç”¨IEçœ‹ï¼‰ï¼ŒåŒæ—¶éœ€è¦ä¸€ä¸ªæ˜¾ç¤ºé¢œè‰²çš„åŒºåŸŸï¼Œå”¯ä¸€ä¸å¯»å¸¸çš„äº‹æƒ…æ˜¯éœ€è¦ä¸€ä¸ªè®¡ç®—é¢œè‰²äº®åº¦çš„å‡½æ•°ç”¨æ¥åŒºåˆ†æ˜¯å¦æ˜¾ç¤ºç™½è‰²æˆ–è€…é»‘è‰²çš„å‰å°æ–‡æœ¬ ã€‚</p><p>å¹¶ä¸”<code>&lt;ColorPicker /&gt;</code> æ˜¯ä¸€ä¸ªå•çº¯çš„Reactæ§ä»¶ï¼Œå¯¹Reduxæ²¡æœ‰ä»»ä½•çš„ä¾èµ–ï¼Œæ‰€ä»¥ç¨åæˆ‘ä»¬éœ€è¦æŠŠå®ƒåŒ…è£…è¿›ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„ç»„ä»¶ä¸­:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> NumberPicker <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;input <span class="keyword">type</span>=<span class="string">"range"</span> value=&#123;<span class="keyword">this</span>.props.value.toString() &#125; min=<span class="string">"0"</span> max=<span class="string">"255"</span></span><br><span class="line">                    onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.handleChange(e) &#125; /&gt;</span><br><span class="line">                &lt;label&gt; &#123;<span class="keyword">this</span>.props.name&#125;: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;b&gt;&#123; this.props.value &#125;&lt;/</span>b&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    handleChange(event) &#123;</span></span><br><span class="line"><span class="regexp">        const e = event.target as HTMLInputElement;</span></span><br><span class="line"><span class="regexp">        this.props.onChange(parseInt(e.value));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export class ColorPicker extends React.Component&lt;any, any&gt; &#123;</span></span><br><span class="line"><span class="regexp">    render() &#123;</span></span><br><span class="line"><span class="regexp">        const color = this.props.color;</span></span><br><span class="line"><span class="regexp">        const rgb = hexToRgb(color);</span></span><br><span class="line"><span class="regexp">        const textColor = isDark(color) ? '#fff' : '#000';</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;NumberPicker name="Red" value=&#123;rgb.r&#125; onChange=&#123;n =&gt; this.updateRed(n)&#125; /</span>&gt;</span><br><span class="line">                &lt;NumberPicker name=<span class="string">"Green"</span> value=&#123;rgb.g&#125; onChange=&#123;<span class="function"><span class="params">n</span> =&gt;</span> <span class="keyword">this</span>.updateGreen(n) &#125; /&gt;</span><br><span class="line">                &lt;NumberPicker name=<span class="string">"Blue"</span> value=&#123;rgb.b&#125; onChange=&#123;<span class="function"><span class="params">n</span> =&gt;</span> <span class="keyword">this</span>.updateBlue(n) &#125; /&gt;</span><br><span class="line">                &lt;div style=&#123;&#123;</span><br><span class="line">                    background: color, width: <span class="string">"100%"</span>, height: <span class="number">40</span>, lineHeight: <span class="string">"40px"</span>,</span><br><span class="line">                    textAlign: <span class="string">"center"</span>, color: textColor</span><br><span class="line">                &#125;&#125;&gt;</span><br><span class="line">                    &#123;color&#125;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    updateRed(n: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> rgb = hexToRgb(<span class="keyword">this</span>.props.color);</span><br><span class="line">        <span class="keyword">this</span>.changeColor(rgbToHex(n, rgb.g, rgb.b));</span><br><span class="line">    &#125;</span><br><span class="line">    updateGreen(n: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> rgb = hexToRgb(<span class="keyword">this</span>.props.color);</span><br><span class="line">        <span class="keyword">this</span>.changeColor(rgbToHex(rgb.r, n, rgb.b));</span><br><span class="line">    &#125;</span><br><span class="line">    updateBlue(n: <span class="built_in">number</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> rgb = hexToRgb(<span class="keyword">this</span>.props.color);</span><br><span class="line">        <span class="keyword">this</span>.changeColor(rgbToHex(rgb.r, rgb.g, n));</span><br><span class="line">    &#125;</span><br><span class="line">    changeColor(color: <span class="built_in">string</span>) &#123;</span><br><span class="line">        <span class="keyword">this</span>.props.onChange(color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> componentToHex = <span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> hex = c.toString(<span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> hex.length == <span class="number">1</span> ? <span class="string">"0"</span> + hex : hex;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rgbToHex = <span class="function">(<span class="params">r, g, b</span>) =&gt;</span> <span class="string">"#"</span> + componentToHex(r) + componentToHex(g) + componentToHex(b);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hexToRgb = (hex: <span class="built_in">string</span>): &#123; r: <span class="built_in">number</span>; g: <span class="built_in">number</span>; b: <span class="built_in">number</span>; &#125; =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="regexp">/^#?([a-f\d]&#123;2&#125;)([a-f\d]&#123;2&#125;)([a-f\d]&#123;2&#125;)$/i</span>.exec(hex);</span><br><span class="line">    <span class="keyword">return</span> result ? &#123;</span><br><span class="line">        r: <span class="built_in">parseInt</span>(result[<span class="number">1</span>], <span class="number">16</span>),</span><br><span class="line">        g: <span class="built_in">parseInt</span>(result[<span class="number">2</span>], <span class="number">16</span>),</span><br><span class="line">        b: <span class="built_in">parseInt</span>(result[<span class="number">3</span>], <span class="number">16</span>)</span><br><span class="line">    &#125; : <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> luminance = <span class="function">(<span class="params">color: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> rgb = hexToRgb(color);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0.2126</span> * rgb.r + <span class="number">0.7152</span> * rgb.g + <span class="number">0.0722</span> * rgb.b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isDark = <span class="function">(<span class="params">color: <span class="built_in">string</span></span>) =&gt;</span> luminance(color) &lt; <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p></p><p>åœ¨ç•Œé¢ä¸Šçœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/shapes-colorpicker.png" alt></p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/shapemaker.tsx" target="_blank" rel="noopener">shapemaker.tsx</a></h3><p>è¿™å°±æ˜¯æˆ‘ä»¬çš„Shape ç”Ÿæˆå™¨ï¼Œå¼•å…¥äº†æ›´å¤šçš„çŠ¶æ€ï¼Œæˆ‘ä»¬å°†å…³æ³¨ <strong>top</strong> å’Œ<strong>left</strong> çš„ä½ç½®æ¥ç¡®å®šä»–åœ¨é¢„è§ˆåŒºåŸŸæ˜¾ç¤ºçš„ä½ç½®ï¼ŒåŒæ—¶æ§åˆ¶å®ƒçš„é¢œè‰²å’Œå¤§å°ï¼ŒåŒæ—¶ä¹Ÿéå¸¸é‡è¦çš„æ˜¯æˆ‘ä»¬åŠ äº†ä¸€ä¸ª <strong>Add Shape</strong> çš„æŒ‰é’®ï¼ŒæŠŠShapeæ·»åŠ åˆ°æˆ‘ä»¬çš„é¢„è§ˆåŒºåŸŸä¸­ï¼Œè¯¦ç»†çš„ä»£ç å¦‚ä¸‹ï¼š :</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isDark &#125; <span class="keyword">from</span> <span class="string">"./colorpicker"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ShapeMaker <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">props?, context?</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props, context);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; top: props.top, left: props.left &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">var</span> width = <span class="keyword">this</span>.props.width, height = <span class="keyword">this</span>.props.height, background = <span class="keyword">this</span>.props.color;</span><br><span class="line">        <span class="keyword">const</span> color = isDark(background) ? <span class="string">'#fff'</span> : <span class="string">'#000'</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;size: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;&#123;height&#125;x&#123;width&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div style=&#123;&#123; height, width, background, color, lineHeight: height + "px", margin: "auto" &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    (&#123;this.state.top&#125;, &#123;this.state.left&#125;)</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;p&gt;</span><br><span class="line">                        &lt;label&gt;position: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;input style=&#123;&#123; width: 30 &#125;&#125; defaultValue=&#123;this.props.top&#125; onChange=&#123;e =&gt; this.handleTop(e) &#125; /</span>&gt;</span><br><span class="line">                        &lt;span&gt;, &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;input style=&#123;&#123; width: 30 &#125;&#125; defaultValue=&#123;this.props.left&#125; onChange=&#123;e =&gt; this.handleLeft(e) &#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;button onClick=&#123;e =&gt; this.props.addShape(background, height, width, this.state.top, this.state.left) &#125;&gt;</span></span><br><span class="line"><span class="regexp">                        Add Shape</span></span><br><span class="line"><span class="regexp">                    &lt;/</span>button&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    handleTop(e) &#123;</span><br><span class="line">        <span class="keyword">var</span> top = <span class="built_in">parseInt</span>(e.target.value);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(top))</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; top &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    handleLeft(e) &#123;</span><br><span class="line">        <span class="keyword">var</span> left = <span class="built_in">parseInt</span>(e.target.value);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(left))</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; left &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">    (state) =&gt; (&#123;</span><br><span class="line">        width: state.width, height: state.height, color: state.color,</span><br><span class="line">        top: state.nextShapeId * <span class="number">10</span>, left: state.nextShapeId * <span class="number">10</span></span><br><span class="line">    &#125;),</span><br><span class="line">    (dispatch) =&gt; (&#123;</span><br><span class="line">        addShape: <span class="function">(<span class="params">color, height, width, top, left</span>) =&gt;</span> &#123;</span><br><span class="line">            dispatch(&#123; <span class="keyword">type</span>: <span class="string">'SHAPE_ADD'</span>, height, width, color, top, left &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">)(ShapeMaker);</span><br></pre></td></tr></table></figure><p></p><p>åœ¨ç•Œé¢ä¸Šçœ‹èµ·æ¥åƒè¿™æ ·:</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/shapes-preview.png" alt></p><h3>åŸºäºæ¶ˆæ¯çš„Actions</h3><p>æœ‰è¶£çš„æ˜¯ï¼Œå°½ç®¡è¿™ä¸ªç»„ä»¶çš„æ”¹åŠ¨éƒ¨åˆ†è²Œä¼¼å¾ˆå¤šï¼Œä¸è¿‡å®ƒä»…ä»…è§¦å‘ä¸€ä¸ªå•ç‹¬çš„<code>SHAPE_ADD</code> Actionã€‚ æˆ‘ä»¬å¼€å§‹çœ‹åˆ°ä¸€äº›ä½¿ç”¨Reduxæ–¹å¼çš„å¥½å¤„ï¼Œåƒå¼ºåˆ¶åˆ†ç¦»æˆ‘ä»¬åŠŸèƒ½èƒŒåçš„ç²—ç²’åº¦API ï¼Œå»é™¤å’ŒDOMçš„å…³ç³»ã€‚ è¿™æ ·åªè¦èƒ½æ“ä½œStoreå°±èƒ½æ“ä½œåº”ç”¨ç¨‹åºçš„çš„å…·ä½“åŠŸèƒ½ï¼Œè¿™éƒ½è¦æ„Ÿè°¢<a href="https://github.com/ServiceStack/ServiceStack/wiki/Advantages-of-message-based-web-services#advantages-of-message-based-designs" target="_blank" rel="noopener">åŸºäºæ¶ˆæ¯çš„è®¾è®¡</a>ã€‚ å› ä¸ºå®ƒä»¬åªæ˜¯åŸºæœ¬çš„javascriptå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥éå¸¸è½»æ¾çš„åˆ›å»ºå¹¶åºåˆ—åŒ–100ä¸ª <code>SHAPE_ADD</code> actionsï¼Œå¹¶ä¸”æŠŠå®ƒä»¬å­˜å‚¨åˆ°localStorageç­‰ä»¥ä¾¿æˆ‘ä»¬åç»­é‡ç½®ï¼Œç”šè‡³é€šçŸ¥åˆ°åˆ«äººï¼Œå†åœ¨å…¶æœ¬åœ°é‡ç°è¿‡ç¨‹ã€‚</p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/shapeviewer.tsx" target="_blank" rel="noopener">ShapeViewer.tsx</a></h3><p>ç°åœ¨æˆ‘å·²ç»æœ‰äº†åˆ›å»ºä¸€ä¸ªShapeçš„æ‰€æœ‰éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç»„ä»¶å»æ˜¾ç¤ºä»–ä»¬ï¼Œ<code>ShapeViewer</code> é€šè¿‡è¾“å‡ºä¸€ä¸ª <code>DIV</code>æ˜¾ç¤ºæ·»åŠ Shapeçš„å¤§å°ï¼Œé¢œè‰²å’ŒæœªçŸ¥ã€‚</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; isDark &#125; <span class="keyword">from</span> <span class="string">"./colorpicker"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ShapeMaker <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">props?, context?</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props, context);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; top: props.top, left: props.left &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">var</span> width = <span class="keyword">this</span>.props.width, height = <span class="keyword">this</span>.props.height, background = <span class="keyword">this</span>.props.color;</span><br><span class="line">        <span class="keyword">const</span> color = isDark(background) ? <span class="string">'#fff'</span> : <span class="string">'#000'</span>;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;label&gt;size: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;&#123;height&#125;x&#123;width&#125;&lt;/</span>b&gt;</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div style=&#123;&#123; height, width, background, color, lineHeight: height + "px", margin: "auto" &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    (&#123;this.state.top&#125;, &#123;this.state.left&#125;)</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div&gt;</span><br><span class="line">                    &lt;p&gt;</span><br><span class="line">                        &lt;label&gt;position: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;input style=&#123;&#123; width: 30 &#125;&#125; defaultValue=&#123;this.props.top&#125; onChange=&#123;e =&gt; this.handleTop(e) &#125; /</span>&gt;</span><br><span class="line">                        &lt;span&gt;, &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                        &lt;input style=&#123;&#123; width: 30 &#125;&#125; defaultValue=&#123;this.props.left&#125; onChange=&#123;e =&gt; this.handleLeft(e) &#125; /</span>&gt;</span><br><span class="line">                    &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">                    &lt;button onClick=&#123;e =&gt; this.props.addShape(background, height, width, this.state.top, this.state.left) &#125;&gt;</span></span><br><span class="line"><span class="regexp">                        Add Shape</span></span><br><span class="line"><span class="regexp">                    &lt;/</span>button&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    handleTop(e) &#123;</span><br><span class="line">        <span class="keyword">var</span> top = <span class="built_in">parseInt</span>(e.target.value);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(top))</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; top &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    handleLeft(e) &#123;</span><br><span class="line">        <span class="keyword">var</span> left = <span class="built_in">parseInt</span>(e.target.value);</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">isNaN</span>(left))</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; left &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">    (state) =&gt; (&#123;</span><br><span class="line">        width: state.width, height: state.height, color: state.color,</span><br><span class="line">        top: state.nextShapeId * <span class="number">10</span>, left: state.nextShapeId * <span class="number">10</span></span><br><span class="line">    &#125;),</span><br><span class="line">    (dispatch) =&gt; (&#123;</span><br><span class="line">        addShape: <span class="function">(<span class="params">color, height, width, top, left</span>) =&gt;</span> &#123;</span><br><span class="line">            dispatch(&#123; <span class="keyword">type</span>: <span class="string">'SHAPE_ADD'</span>, height, width, color, top, left &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">)(ShapeMaker);</span><br></pre></td></tr></table></figure><p></p><p>å½“æ·»åŠ ä¸€ä¸ªShapeï¼ŒShapeViewerå°±ä¼šä¸€ä¸ªç©ºDIVå®¹å™¨ä¸­ç»˜åˆ¶å®ƒã€‚</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/shapes-viewer.png" alt></p><h3>æ‹–æ‹½ shapes æ¥äº§ç”ŸActions</h3><p>ä¸ºäº†æ›´å¥½çš„æŸ¥çœ‹æ‰€æœ‰çš„Shapeï¼ŒShapeViewer åŒ…æ‹¬äº†æ”¯æŒæ‹–æ‹½æ¥æ›´æ–°shapeçš„ä½ç½®çš„åŠŸèƒ½ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿäº§ç”Ÿå¤§é‡Actionçš„ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å¿«é€Ÿçš„å¯è§†åŒ–å¹¶æ’­æ”¾ä¸€ç³»åˆ—stateçš„å˜åŒ–</p><blockquote><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œä½¿ç”¨äº†mousemoveäº‹ä»¶è€Œä¸æ˜¯drag drop çš„apiäº‘äº‘</p></blockquote><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/actionplayer.tsx" target="_blank" rel="noopener">ActionPlayer.tsx</a></h3><p>ç°åœ¨æˆ‘ä»¬å·²ç»å®ç°äº†æˆ‘ä»¬Appçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¯ä»¥å¼€å§‹Reduxçš„ç‰¹åˆ«åŠŸèƒ½</p><h4>replayActions</h4><p>å¦‚æœä½ å·²ç»æ­£ç¡®çš„å®Œæˆæˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ç†è®ºä¸Šå¯ä»¥é€šè¿‡é‡ç½®Reduxçš„Storeåˆ°å®ƒçš„é»˜è®¤çŠ¶æ€ï¼Œç„¶åå†æ¬¡è§¦å‘ä¹‹å‰çš„æ¯ä¸€ä¸ªActionæ¥é‡ç°æˆ‘ä»¬æ•´ä¸ªåº”ç”¨çš„ä¼šè¯ã€‚è¿™å°±æ˜¯ <code>replayActions</code> è¦å®ç°çš„åŠŸèƒ½ã€‚æ¯ä¸ªActionæˆ‘ä»¬æä¾›10æ¯«ç§’*ç¬¬å‡ ä¸ªçš„é—´éš”æ¥æ’­æ”¾ã€‚</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> ActionPlayer <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> unsubscribe: <span class="built_in">Function</span>;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = <span class="keyword">this</span>.props.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.forceUpdate());</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.replayActions() &#125;&gt;replay&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;&#123;this.props.actions.length&#125;&lt;/</span>b&gt; actions</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; this.undoAction() &#125;&gt;undo&lt;/</span>button&gt; &lt;span&gt;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;e =&gt; this.resetState() &#125;&gt;clear&lt;/</span>button&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    resetState() &#123;</span></span><br><span class="line"><span class="regexp">        this.props.store.dispatch(&#123; type: "LOAD", state: this.props.defaultState &#125;);</span></span><br><span class="line"><span class="regexp">        this.props.actions.length = 0;</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    replayActions() &#123;</span></span><br><span class="line"><span class="regexp">        const snapshot = this.props.actions.slice(0);</span></span><br><span class="line"><span class="regexp">        this.resetState();</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        snapshot.forEach((action, i) =&gt;</span></span><br><span class="line"><span class="regexp">            setTimeout(() =&gt; this.props.store.dispatch(action), 10 * i));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    undoAction() &#123;</span></span><br><span class="line"><span class="regexp">        const snapshot = this.props.actions.slice(0, this.props.actions.length - 1);</span></span><br><span class="line"><span class="regexp">        this.resetState();</span></span><br><span class="line"><span class="regexp">        snapshot.forEach(action =&gt; this.props.store.dispatch(action));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>ActionPlayer ä¹Ÿæ˜¾ç¤ºæœ‰å¤šå°‘ä¸ªActionè¢«è§¦å‘äº†ï¼š</p><p><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/shapes-actions.png" alt></p><h4>resetState</h4><p>æ¸…ç©ºæˆ‘ä»¬çš„åº”ç”¨å›åˆ°æœ€åŸå§‹çš„çŠ¶æ€ä¸èƒ½å†ç®€å•äº†ï¼Œå°±åªæœ‰é‡æ–°åŠ è½½<code>defaultState</code>å¹¶æ¸…é™¤ä¿å­˜çš„actionsã€‚</p><h4>undoAction</h4><p>å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ•è·äº†æ‰€æœ‰çš„Actionï¼Œæ’¤é”€çš„åŠ¨ä½œï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡å°†ä¹‹å‰çš„æ‰€æœ‰Actioné‡æ–°å†æ‰§è¡Œä¸€éï¼Œä½†ä¸åŒ…æ‹¬æœ€åä¸€ä¸ªçš„æ–¹å¼æ¥å®ç°ã€‚è¿™çœ‹ä¸Šå»æ•ˆç‡å¾ˆä½ï¼Œä¸è¿‡Javascriptçš„VM æ€§èƒ½è¿˜ä¸é”™ï¼Œæ‰€ä»¥çœ‹ä¸Šå»ä¹Ÿè¿˜å¥½--å°±åƒæˆ‘ä»¬çœŸçš„å®ç°äº†æ’¤é”€ä¸€æ ·ï¼šï¼‰</p><h3><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example07/app.tsx" target="_blank" rel="noopener">app.tsx</a></h3><p>åœ¨å®ç°äº†æ‰€æœ‰çš„æ¨¡å—ä¹‹åï¼Œå‰©ä¸‹çš„ä¸€ä»¶äº‹æƒ…å°±æ˜¯æˆ‘ä»¬çˆ¶å®¹å™¨äº†ï¼Œç”¨äºæŒ‚è½½æ‰€æœ‰çš„ç»„ä»¶å’ŒRedux Reducerå‡½æ•°ï¼Œå®ç°æ‰€æœ‰actionçš„çŠ¶æ€è½¬æ¢</p><h3>Application Reducers</h3><p>é€šè¿‡switchçŠ¶æ€æ¥å¤„ç†æ¯ä¸ªactionçš„typeå±æ€§æ˜¯å®ç°reducerå‡½æ•°çš„ç»å…¸æ–¹å¼ã€‚ä¸èƒ½ç”¨å¯¹è±¡å±•å¼€æ–¹æ³•ï¼Œä½¿ç”¨<code>Object.assign()</code> ä¹Ÿè®¸æ˜¯æœ€å¥½çš„æ–¹å¼äº†ï¼Œä½†æ˜¯å®ƒæ˜¯ES6çš„ç‰¹æ€§ï¼Œå¹¶éæ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒã€‚ä¸ºæ­¤æˆ‘ä»¬ä¹‹å‰æœ‰ä»‹ç»å®‰è£…å·¥å…·åŒ…æˆ–è€…ä½¿ç”¨polyfillæ¥å®ç°ï¼Œåœ¨æœ¬æ–‡çš„ç¤ºä¾‹ä¸­ä½¿ç”¨äº†polyfillã€‚ æˆ‘ä»¬åœ¨reducerä¸­å¤„ç†stateçš„å˜åŒ–ï¼Œä½¿ç”¨ Object.assign() æ–°å»ºäº†ä¸€ä¸ªå‰¯æœ¬ã€‚ä½†ä¸èƒ½è¿™æ ·ä½¿ç”¨ Object.assign(state, { visibilityFilter: action.filter })ï¼Œå› ä¸ºå®ƒä¼šæ”¹å˜ç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ä½ å¿…é¡»æŠŠç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºç©ºå¯¹è±¡<code>{}</code>ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„Reduxå‡½æ•°å»åšè¿™ä¸ªäº‹æƒ…ï¼Œæˆ‘ä»¬é€šè¿‡åœ¨actionæ¶ˆæ¯ä¸­ä¼ é€’ä¸€ä¸ªç®€å•çš„å‚æ•°ï¼Œå°±èƒ½è½»æ˜“åœ°è®©æˆ‘ä»¬çš„reducerå‡½æ•°è¿”å›æœŸæœ›çš„stateã€‚</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> ReactDOM <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider, connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">"./counter"</span>;</span><br><span class="line"><span class="keyword">import</span> ActionPlayer <span class="keyword">from</span> <span class="string">"./actionplayer"</span>;</span><br><span class="line"><span class="keyword">import</span> ShapeMaker <span class="keyword">from</span> <span class="string">"./shapemaker"</span>;</span><br><span class="line"><span class="keyword">import</span> ShapeViewer <span class="keyword">from</span> <span class="string">"./shapeviewer"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ColorPicker &#125; <span class="keyword">from</span> <span class="string">"./colorpicker"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./objectassign"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> actions = [];</span><br><span class="line"><span class="keyword">var</span> defaultState = &#123; nextShapeId: <span class="number">0</span>, width: <span class="number">100</span>, height: <span class="number">100</span>, color: <span class="string">"#000000"</span>, shapes: [] &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        actions.push(action);</span><br><span class="line">        <span class="keyword">let</span> shape;</span><br><span class="line">        <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"COUNTER_CHANGE"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; [action.field]: state[action.field] + action.by &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"COLOR_CHANGE"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; color: action.color &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"SHAPE_ADD"</span>:</span><br><span class="line">                <span class="keyword">const</span> id = state.nextShapeId;</span><br><span class="line">                shape = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123; id: id &#125;, action);</span><br><span class="line">                <span class="keyword">delete</span> shape[<span class="string">"type"</span>];</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; nextShapeId: id + <span class="number">1</span>, shapes: [...state.shapes, shape] &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"SHAPE_CHANGE"</span>:</span><br><span class="line">                shape = <span class="built_in">Object</span>.assign(&#123;&#125;, state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id === action.id)[<span class="number">0</span>],</span><br><span class="line">                    &#123; top: action.top, left: action.left &#125;);</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state,</span><br><span class="line">                    &#123; shapes: [...state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id !== action.id), shape] &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"LOAD"</span>:</span><br><span class="line">                <span class="keyword">return</span> action.state;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    defaultState);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ColorWrapperBase <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;ColorPicker color=&#123;<span class="keyword">this</span>.props.color&#125; onChange=&#123;<span class="keyword">this</span>.props.setColor&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ColorWrapper = connect(</span><br><span class="line">    (state) =&gt; (&#123; color: state.color &#125;),</span><br><span class="line">    (dispatch) =&gt; <span class="function">(<span class="params">&#123; setColor: (<span class="params">color</span>) =&gt; dispatch(<span class="params">&#123; <span class="keyword">type</span>: 'COLOR_CHANGE', color &#125;</span>) &#125;</span>)</span></span><br><span class="line"><span class="function">)(<span class="params">ColorWrapperBase</span>);</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="params">ReactDOM</span>.<span class="params">render</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;Provider store=&#123;store&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">        &lt;table&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">            &lt;tbody&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                &lt;tr&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;td style=&#123;&#123; width: 220 &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;Counter field="width" step=&#123;10&#125; /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;Counter field="height" step=&#123;10&#125; /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;ColorWrapper /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;/td&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;td style=&#123;&#123; verticalAlign: "top", textAlign: "center", width: 500 &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;h2&gt;Preview&lt;/h2&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;ShapeMaker /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;/td&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;td style=&#123;&#123; verticalAlign: 'bottom' &#125;&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;ActionPlayer store=&#123;store&#125; actions=&#123;actions&#125; defaultState=&#123;defaultState&#125; /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;/td&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                &lt;/tr&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                &lt;tr&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;td colSpan=&#123;3&#125;&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;h2 style=&#123;&#123; margin: 5, textAlign: 'center' &#125;&#125;&gt;Shapes&lt;/h2&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                        &lt;ShapeViewer /&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                    &lt;/td&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">                &lt;/tr&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">            &lt;/tbody&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">        &lt;/table&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">    &lt;/Provider&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="built_in">document</span>.getElementById(<span class="params">"content"</span>)</span>);</span></span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå¯å·¥ä½œçš„Shapeç”Ÿæˆå™¨äº†ï¼Œè¿™æ˜¯å®ƒçš„å…¨è²Œï¼š</p><p><a href="http://xuanye.github.io/typescript-react/source/example07/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-07.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example07/">/typescript-redux/example07/</a></p></blockquote><p>æœ‰ä¸€ç‚¹éœ€è¦æŒ‡å‡ºæˆ‘ä»¬çš„é¡¶çº§Appåªä¼šç»˜åˆ¶ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒä¸åŒ…å«åœ¨ä»»ä½•ä¸€ä¸ªçˆ¶ç»„ä»¶ï¼Œä¹Ÿæ²¡æœ‰è°ƒç”¨<code>setState()</code>æ¥æ”¹å˜stateå¹¶è§¦å‘é‡ç»˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åŒ…è£…ä¸€ä¸‹æˆ‘ä»¬çš„ColorPickerè¿›ä¸€ä¸ª<code>Redux-aware</code> ColorWrapper ï¼Œå¹¶ä¸”æ˜ å°„æˆ‘ä»¬çš„Redux stateåˆ°å®ƒçš„ç»„ä»¶å±æ€§ä¸­ï¼ŒåŒæ ·æŠŠ<code>onChange</code> è½¬ä¼šæˆè§¦å‘é€‚å½“çš„Redux action</p><h2>é‡æ„ Reducers</h2><p>åŸæ–‡ä¸­é‡æ„Reducersæ˜¯ä½¿ç”¨äº†Typescriptçš„ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œå¦‚è£…é¥°å™¨ç­‰ï¼Œä½†æ˜¯æˆ‘æœ¬èº«æ˜¯æ‹’ç»è¿™ä¹ˆåšçš„ï¼Œæ¯•ç«Ÿè£…é¥°å™¨è¿˜æ˜¯å®éªŒæ€§çš„ç‰¹æ€§ï¼Œå°†æ¥ä¼šå‘ç”Ÿå˜åŒ–ï¼Œ è¿™é‡Œçš„é‡æ„åªæ˜¯é‡æ–°ç»„ç»‡ä¸€ä¸‹ä»£ç ï¼Œå¹¶å°†åŸæ¥çš„ä¸€å †<code>switch</code>æ‹†åˆ†åˆ°ä¸åŒçš„reducerå‡½æ•°ä¸­ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        actions.push(action);</span><br><span class="line">        <span class="keyword">let</span> shape;</span><br><span class="line">        <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"COUNTER_CHANGE"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; [action.field]: state[action.field] + action.by &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"COLOR_CHANGE"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; color: action.color &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"SHAPE_ADD"</span>:</span><br><span class="line">                <span class="keyword">const</span> id = state.nextShapeId;</span><br><span class="line">                shape = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123; id: id &#125;, action);</span><br><span class="line">                <span class="keyword">delete</span> shape[<span class="string">"type"</span>];</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; nextShapeId: id + <span class="number">1</span>, shapes: [...state.shapes, shape] &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"SHAPE_CHANGE"</span>:</span><br><span class="line">                shape = <span class="built_in">Object</span>.assign(&#123;&#125;, state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id === action.id)[<span class="number">0</span>],</span><br><span class="line">                    &#123; top: action.top, left: action.left &#125;);</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state,</span><br><span class="line">                    &#123; shapes: [...state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id !== action.id), shape] &#125;);</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"LOAD"</span>:</span><br><span class="line">                <span class="keyword">return</span> action.state;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> state;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    defaultState);</span><br></pre></td></tr></table></figure><p></p><p>è¿™é‡Œæ²¡æœ‰ä½¿ç”¨Reduxå†…ç½®çš„ <a href="http://rackt.org/redux/docs/api/combineReducers.html" target="_blank" rel="noopener">combineReducers</a>æ¥å¸®åŠ©æˆ‘ä»¬æ¨¡å—åŒ–Reduxer, è¿˜æ˜¯ä½¿ç”¨ä¸€ç§å­—å…¸çš„æ–¹å¼æ¥ç»„ç»‡æˆ‘ä»¬çš„å‡½æ•°ï¼Œè¿™æ ·åšæˆ‘ç›¸ä¿¡æ›´åŠ å¯é˜…è¯»æ€§å’Œå¯æ‰©å±•æ€§æ›´é«˜ã€‚ï¼ˆäº‹å®ä¸Šæœ¬ä¾‹ä¸­ä½¿ç”¨combineReducers ä¼šå¸¦æ¥ä¸€äº›é¢å¤–çš„é—®é¢˜ï¼Œå› ä¸ºcombineReducersä¸­çš„Reduceråˆ†ç®¡stateä¸­çš„ä¸åŒåˆ†æ”¯è€Œäº’ä¸å½±å“ï¼Œè€Œæ­¤ä¾‹ä¸­æœ‰äº›æ¨¡å—éœ€è¦äº¤äº’æ–¹å¼å¯èƒ½å¯¼è‡´ä»£ç ä¸€å®šçš„å†—ä½™ï¼‰</p><p><strong>app.tsx</strong>:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> reducers <span class="keyword">from</span> <span class="string">'./reducers'</span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> reducer = reducers[action.type];</span><br><span class="line">        <span class="keyword">var</span> nextState = reducer != <span class="literal">null</span></span><br><span class="line">            ? reducer(state, action)</span><br><span class="line">            : state;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action.type !== <span class="string">'LOAD'</span>)</span><br><span class="line">            history.add(action, nextState);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nextState;</span><br><span class="line">    &#125;,</span><br><span class="line">    defaultState);</span><br></pre></td></tr></table></figure><p></p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example08/reducers.ts" target="_blank" rel="noopener">reducers.ts</a></h4><p><strong>reducers</strong> æ¨¡å—å°±æ˜¯è¿”å›ä¸€ä¸ªaction.typeä¸ºkeyçš„å­—å…¸å¯¹è±¡ï¼Œå†…å®¹åˆ™æ˜¯å®ƒä»¬å¯¹åº”çš„å¤„ç†å‡½æ•° :</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">"./objectassign"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; addShape, changeShape &#125; <span class="keyword">from</span> <span class="string">'./reducers/shapeReducers'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeCounter = <span class="function">(<span class="params">state, action</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; [action.field]: state[action.field] + action.by &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> changeColor = <span class="function">(<span class="params">state, action</span>) =&gt;</span></span><br><span class="line">    <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; color: action.color &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    COUNTER_CHANGE: changeCounter,</span><br><span class="line">    COLOR_CHANGE: changeColor,</span><br><span class="line">    SHAPE_ADD: addShape,</span><br><span class="line">    SHAPE_CHANGE: changeShape,</span><br><span class="line">    LOAD: <span class="function">(<span class="params">state, action</span>) =&gt;</span> action.state</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>ä½¿ç”¨å‘½åå‡½æ•°è®©ä»£ç æ›´å…·å¯è¯»æ€§å¹¶ä¸”è®©ä½ ç‹¬ç«‹åœ°å¼€å‘å’Œæµ‹è¯•æ¯ä¸ªreducerçš„å®ç°ã€‚ åŒæ—¶ä¹Ÿè®²å‡ ä¸ªç›¸å…³çš„reducerå°è£…è¿›å•ç‹¬çš„æ¨¡å—ä¸­ï¼Œå°±åƒè¿™æ ·:</p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/reducers/shapeReducers.ts" target="_blank" rel="noopener">shapeReducers.ts</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">"../objectassign"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> addShape = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> id = state.nextShapeId;</span><br><span class="line">    <span class="keyword">var</span> shape = <span class="built_in">Object</span>.assign(&#123;&#125;, &#123; id: id &#125;, action);</span><br><span class="line">    <span class="keyword">delete</span> shape[<span class="string">'type'</span>];</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; nextShapeId: id + <span class="number">1</span>, shapes: [...state.shapes, shape] &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> changeShape = <span class="function">(<span class="params">state, action</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> shape = <span class="built_in">Object</span>.assign(&#123;&#125;, state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id === action.id)[<span class="number">0</span>],</span><br><span class="line">        &#123; top: action.top, left: action.left &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Object</span>.assign(&#123;&#125;, state, &#123; shapes: [...state.shapes.filter(<span class="function"><span class="params">x</span> =&gt;</span> x.id !== action.id), shape] &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><h2>é‡æ„ Redux çš„ç»„ä»¶</h2><p>è¿™é‡Œè¿˜æœ‰ä¸€äº›äº‹æƒ…éœ€è¦æˆ‘ä»¬å»æ”¹è¿›Redux-connectedçš„ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶ä½¿ç”¨äº†<code>connect()</code>æ¥åˆ›å»ºæˆ‘ä»¬æ›´é«˜çº§åˆ«çš„ï¼ˆå…¶å®æ˜¯å­ç±»ï¼‰Redux-connected ç»„ä»¶ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> ColorWrapperBase <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> &lt;ColorPicker color=&#123;<span class="keyword">this</span>.props.color&#125; onChange=&#123;<span class="keyword">this</span>.props.setColor&#125; /&gt;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> ColorWrapper = connect(</span><br><span class="line">    (state) =&gt; (&#123; color: state.color &#125;),</span><br><span class="line">    (dispatch) =&gt; <span class="function">(<span class="params">&#123; setColor: (<span class="params">color</span>) =&gt; dispatch(<span class="params">&#123; <span class="keyword">type</span>: "COLOR_CHANGE", color &#125;</span>) &#125;</span>)</span></span><br><span class="line"><span class="function">)(<span class="params">ColorWrapperBase</span>);</span></span><br></pre></td></tr></table></figure><p></p><p>æ³¨ï¼šåŸæ–‡ä¸­ä½œè€…è¯´ä¸å–œæ¬¢é€šè¿‡è¿™ç§æ–¹å¼ï¼ˆç¦»å¼€ç»„ä»¶ç±»å£°æ˜ï¼Œå»æ”¹å˜ç»„ä»¶çš„è¡Œä¸ºï¼‰æ¥æ”¹å˜åŸæ¥ç»„ä»¶çš„å®ç°ï¼Œç„¶åå†æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œå™è¿°å¦‚æœé€šè¿‡Typescriptçš„è£…é¥°å™¨åŠŸèƒ½æ¥æ”¹é€ ï¼Œä½†æ˜¯æˆ‘æš‚æ—¶å¹¶ä¸åŒæ„è¿™ç§è§‚ç‚¹ï¼Œåœ¨Typescriptä¸­è£…é¥°å™¨æœ¬èº«æ˜¯æ¯”è¾ƒæ™¦æ¶©çš„è¯­æ³•ç³–ï¼Œè€Œä¸”è¿˜åªæ˜¯å®éªŒæ€§çš„åŠŸèƒ½ç‰¹æ€§ï¼Œåœ¨æˆ‘ä»¬è¿˜æ²¡æœ‰éå¸¸ç†Ÿç»ƒæŒæ¡çš„æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯åº”è¯¥è°¨æ…å¤„ç†ï¼Œè€Œä¸”æˆ‘è¿˜è§‰å¾—ä½¿ç”¨<code>connect()</code>çš„æ–¹å¼ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆä¸å¦¥ã€‚å¦‚æœä½ å¯¹è£…é¥°å™¨çš„éƒ¨åˆ†éå¸¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥å»åŸæ–‡çœ‹çœ‹æ€ä¹ˆå®ç°çš„ã€‚</p><h3>å¸¦æœ‰è¯­æ³•ç»‘å®šçš„æ–¹æ³•</h3><p>åœ¨React Appsä¸­ <a href="https://facebook.github.io/react/docs/pure-render-mixin.html" target="_blank" rel="noopener">PureRenderMixin</a>é€šè¿‡æ£€æŸ¥å’Œç›‘å¬ç»„ä»¶çš„propsæˆ–stateçš„å˜æ›´æ¥é˜»æ­¢ä¸€äº›ä¸å¿…è¦çš„é‡ç»˜ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆåœ°æ”¹å–„åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼ŒRedux <code>connect()</code>çš„æ–¹æ³•è‡ªåŠ¨å°±èƒ½å¤Ÿåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ç»„ä»¶ï¼Œé€šè¿‡æ˜ å°„å¯¹è±¡å…³è”æ¯”è¾ƒå’Œåˆ¤æ–­çŠ¶æ€æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚</p><p>é€šè¿‡<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">fat arrow syntaxï¼ˆç®­å¤´å‡½æ•°è¯­æ³•ï¼‰ï¼‰</a>ä½ å¯ä»¥è½»æ¾çš„ç»‘å®šjavascriptä¸­çš„thiså¯¹è±¡åˆ°å‡½æ•°ä¸­ï¼Œè€Œä¸”ä¸éœ€è¦è€ƒè™‘æ€ä¹ˆç»‘å®š:</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> NumberPicker <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;input <span class="keyword">type</span>=<span class="string">"range"</span> value=&#123;<span class="keyword">this</span>.props.value.toString()&#125; min=<span class="string">"0"</span> max=<span class="string">"255"</span></span><br><span class="line">                    onChange=&#123;<span class="function"><span class="params">e</span> =&gt;</span> <span class="keyword">this</span>.handleChange(e)&#125; /&gt; <span class="comment">//new function created</span></span><br><span class="line">                &lt;label&gt; &#123;<span class="keyword">this</span>.props.name&#125;: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;b&gt;&#123; this.props.value &#125;&lt;/</span>b&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    handleChange(event) &#123;</span></span><br><span class="line"><span class="regexp">        const e = event.target as HTMLInputElement;</span></span><br><span class="line"><span class="regexp">        this.props.onChange(parseInt(e.value));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>è¿™æ ·å†™çš„é—®é¢˜æ˜¯ç±»ä¼¼åœ¨å¾ªç¯ä¸­å£°æ˜å‡½æ•°ä¸€æ ·ï¼Œä¸€æ—¦å±æ€§æ— æ•ˆåï¼Œç®­å¤´å‡½æ•°çš„å£°æ˜å°±ä¼šè¢«é‡æ–°æ‰§è¡Œä¸€æ¬¡ï¼Œè¿™æ ·å°±ä¼šæœ‰äº›æ€§èƒ½æ–¹é¢çš„é—®é¢˜ï¼Œä¸€ä¸ªç®€å•åœ°æ–¹å¼æ¥æ”¹å–„è¿™ä¸ªé—®é¢˜ï¼Œåªéœ€è¦è¿™æ ·å®šä¹‰ä½ çš„ç®­å¤´å‡½æ•°ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> NumberPicker <span class="keyword">extends</span> React.Component&lt;INumberProps, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;p&gt;</span><br><span class="line">                &lt;input <span class="keyword">type</span>=<span class="string">"range"</span> value=&#123;<span class="keyword">this</span>.props.value.toString()&#125; min=<span class="string">"0"</span> max=<span class="string">"255"</span></span><br><span class="line">                    onChange=&#123;<span class="keyword">this</span>.handleChange&#125; /&gt; <span class="comment">//uses same function</span></span><br><span class="line">                &lt;label&gt; &#123;<span class="keyword">this</span>.props.name&#125;: &lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">                &lt;b&gt;&#123;this.props.value&#125;&lt;/</span>b&gt;</span><br><span class="line">            &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    handleChange = (event) =&gt; &#123; /</span><span class="regexp">/fat arrow syntax</span></span><br><span class="line"><span class="regexp">        const e = event.target as HTMLInputElement;</span></span><br><span class="line"><span class="regexp">        this.props.onChange(parseInt(e.value));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><h2><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example08" target="_blank" rel="noopener">Example 8 - é€šè¿‡çŠ¶æ€å¿«ç…§å®ç°æ—¶é—´æ—…è¡Œ</a></h2><p>åœ¨è¿™ä¸ªå®ä¾‹ä¸­æˆ‘ä»¬è®²é€šè¿‡ä¸€ä¸ªåº”ç”¨Stateå¿«ç…§æ›´åŠ å®Œæ•´å®ç°æ›¿æ¢<code>ActionPlayer</code>ã€‚é€šè¿‡ä½¿ç”¨stateæˆ‘ä»¬å¯ä»¥å®ç°æ›´åŠ ä¸°å¯Œçš„å†å²åŠŸèƒ½ï¼ŒåŒ…æ‹¬å›é€€ï¼Œå‰è¿›ï¼Œå’ŒæŒ‡å®šæŸä¸ªæ—¶é—´ç‚¹çš„å¯¼èˆªï¼Œå°±åƒæˆ‘ä»¬æ§åˆ¶è¿›åº¦æ¡ä¸€æ ·è¿›è¡Œä¸€æ¬¡ã€å®ç°æ—…è¡Œã€ä½“éªŒæ¨¡æ‹Ÿåé€€å’Œå‰è¿›</p><p>ä¸ºäº†è®©å†å²çŠ¶æ€ç®¡ç†æ›´åŠ å¯æœç”¨ä¸€ç‚¹ï¼Œå®ƒè¢«å°è£…æˆä¸€ä¸ªç›¸ä¼¼çš„APIï¼ŒåŒ…æ‹¬åŸºæœ¬çš„æ“ä½œåŒ…æ‹¬å¯¼èˆªã€é‡è®¾ï¼Œæ·»åŠ ç°åœ¨çš„çŠ¶æ€ç­‰ç­‰ï¼š</p><h4><a href="https://github.com/ServiceStackApps/typescript-redux/blob/master/src/TypeScriptRedux/src/example08/app.tsx" target="_blank" rel="noopener">app.tsx</a></h4><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> history = &#123;</span><br><span class="line">    states: [],</span><br><span class="line">    stateIndex: <span class="number">0</span>,</span><br><span class="line">    reset() &#123;</span><br><span class="line">        <span class="keyword">this</span>.states = [];</span><br><span class="line">        <span class="keyword">this</span>.stateIndex = <span class="number">-1</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    prev() &#123; <span class="keyword">return</span> <span class="keyword">this</span>.states[--<span class="keyword">this</span>.stateIndex]; &#125;,</span><br><span class="line">    next() &#123; <span class="keyword">return</span> <span class="keyword">this</span>.states[++<span class="keyword">this</span>.stateIndex]; &#125;,</span><br><span class="line">    goTo(index) &#123; <span class="keyword">return</span> <span class="keyword">this</span>.states[<span class="keyword">this</span>.stateIndex=index]; &#125;,</span><br><span class="line">    canPrev() &#123; <span class="keyword">return</span> <span class="keyword">this</span>.stateIndex &lt;= <span class="number">0</span>; &#125;,</span><br><span class="line">    canNext() &#123; <span class="keyword">return</span> <span class="keyword">this</span>.stateIndex &gt;= <span class="keyword">this</span>.states.length - <span class="number">1</span>; &#125;,</span><br><span class="line">    pushState(nextState) &#123;</span><br><span class="line">        <span class="keyword">this</span>.states.push(nextState);</span><br><span class="line">        <span class="keyword">this</span>.stateIndex = <span class="keyword">this</span>.states.length - <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> store = createStore(</span><br><span class="line">    (state, action) =&gt; &#123;</span><br><span class="line">        <span class="keyword">var</span> reducer = reducers[action.type];</span><br><span class="line">        <span class="keyword">var</span> nextState = reducer != <span class="literal">null</span></span><br><span class="line">            ? reducer(state, action)</span><br><span class="line">            : state;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (action.type !== <span class="string">'LOAD'</span>)</span><br><span class="line">         &#123;</span><br><span class="line">             history.pushState(nextState);</span><br><span class="line">             <span class="built_in">console</span>.log(history);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> nextState;</span><br><span class="line">    &#125;,</span><br><span class="line">    defaultState);</span><br></pre></td></tr></table></figure><p></p><h4><a href="https://github.com/xuanye/typescript-redux-sample/tree/master/src/TypescriptRedux/TypescriptRedux.WebHost/source/example08/History.tsx" target="_blank" rel="noopener">History.tsx</a></h4><p>é€šè¿‡ä¿å­˜å’Œé‡ç½®æ•´ä¸ªçŠ¶æ€å¿«ç…§æ¥å®ç°æˆ‘ä»¬çš„å†å²æ§åˆ¶å™¨ï¼Œè¿™éå¸¸çš„ç›´æ¥äº†å½“ï¼ŒåŸºæœ¬ä¸Šé€šè¿‡è§¦å‘ <strong>LOAD</strong> action æ¥é”€æ¯ä¹‹å‰ä¿å­˜çš„æ‰€æœ‰stateï¼Œï¼ˆæ³¨:è¿™é‡Œæ²¡æœ‰åƒåŸæ–‡ä¸­ä½¿ç”¨è£…é¥°å™¨ï¼Œè€Œæ˜¯ä¼ ç»Ÿçš„æ–¹å¼ï¼Œè¿™ç»„ä»¶æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æœ¬èº«çš„æ•°æ®å¹¶ä¸æ˜¯stateçš„éƒ¨åˆ†ï¼Œä½†æ˜¯åˆéœ€è¦å†stateå˜åŒ–çš„æ—¶å€™ï¼ŒåŒæ­¥åˆ·æ–°ï¼Œæ‰€ä»¥éœ€è¦è®¢é˜…storeçš„å˜åŒ–æ¥å¼ºåˆ¶åˆ·æ–°)ï¼š</p><p></p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// History æœ¬èº«çš„æ•°æ®ä¸ç”± State ç®¡ç†ï¼Œä½†æ˜¯åˆè¦åœ¨Stateå˜åŒ–çš„æ—¶å€™é‡ç»˜</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> History <span class="keyword">extends</span> React.Component&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; &#123;</span><br><span class="line">    context: <span class="built_in">any</span>;</span><br><span class="line">    <span class="keyword">static</span> contextTypes = &#123;</span><br><span class="line">        store: React.PropTypes.object</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> unsubscribe: <span class="built_in">Function</span>;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe = <span class="keyword">this</span>.context.store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.forceUpdate());</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillUnmount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.unsubscribe();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.replayStates&#125;&gt;replay&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;span&gt; &lt;/</span>span&gt;</span><br><span class="line">                &lt;button onClick=&#123;<span class="keyword">this</span>.resetState&#125;&gt;clear&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">                &lt;p&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;b&gt;&#123;this.props.history.states.length&#125;&lt;/</span>b&gt; states</span><br><span class="line">                &lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.prevState&#125; disabled=&#123;this.props.history.canPrev()&#125;&gt;prev&lt;/</span>button&gt;</span><br><span class="line">                &lt;span&gt; &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                &lt;button onClick=&#123;this.nextState&#125; disabled=&#123;this.props.history.canNext()&#125;&gt;next&lt;/</span>button&gt;</span><br><span class="line">                &lt;p&gt;</span><br><span class="line">                    &lt;b&gt;&#123;<span class="keyword">this</span>.props.history.stateIndex + <span class="number">1</span>&#125;&lt;<span class="regexp">/b&gt; position</span></span><br><span class="line"><span class="regexp">                &lt;/</span>p&gt;</span><br><span class="line">                &lt;input <span class="keyword">type</span>=<span class="string">"range"</span> min=<span class="string">"0"</span> max=&#123;<span class="keyword">this</span>.props.history.states.length - <span class="number">1</span>&#125;</span><br><span class="line">                    disabled=&#123;<span class="keyword">this</span>.props.history.states.length === <span class="number">0</span>&#125;</span><br><span class="line">                    value=&#123;<span class="keyword">this</span>.props.history.stateIndex&#125; onChange=&#123;<span class="keyword">this</span>.goToState&#125; /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    resetState = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        this.context.store.dispatch(&#123; type: 'LOAD', state: this.props.defaultState &#125;);</span></span><br><span class="line"><span class="regexp">        this.props.history.reset();</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    replayStates = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        this.props.history.states.forEach((state, i) =&gt;</span></span><br><span class="line"><span class="regexp">            setTimeout(() =&gt; this.context.store.dispatch(&#123; type: 'LOAD', state &#125;), 10 * i));</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    prevState = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        this.context.store.dispatch(&#123; type: 'LOAD', state: this.props.history.prev() &#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    nextState = () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        this.context.store.dispatch(&#123; type: 'LOAD', state: this.props.history.next() &#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">    goToState = (event) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">        const e = event.target as HTMLInputElement;</span></span><br><span class="line"><span class="regexp">        this.context.store.dispatch(&#123; type: 'LOAD', state: this.props.history.goTo(parseInt(e.value)) &#125;);</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p></p><p>ç°åœ¨æˆ‘ä»¬çš„å®ä¾‹å·²ç»æ”¯æŒä¸°å¯Œçš„å†å²åŠŸèƒ½äº†:)</p><p><a href="http://xuanye.github.io/typescript-react/source/example08/"><img src="https://raw.githubusercontent.com/xuanye/typescript-redux-sample/master/img/preview-08.png" alt></a></p><blockquote><p>Demo: <a href="http://xuanye.github.io/typescript-react/source/example08/">/typescript-redux/example08/</a></p></blockquote><h3><a href="http://rackt.org/redux/docs/recipes/ImplementingUndoHistory.html" target="_blank" rel="noopener">æ”¹è¿›æ’¤é”€åŠŸèƒ½</a></h3><p>å¦‚æœæ­£åœ¨ç»™ä½ çš„Reduxåº”ç”¨ç¨‹åºæ·»åŠ æ’¤é”€/é‡åšåŠŸèƒ½ï¼Œä½ è‚¯å®šæœŸæœ›èƒ½å¤Ÿå›é€€ç‹¬ç«‹ç»„ä»¶çš„å˜åŒ–çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåº”ç”¨çš„stateï¼Œéå¸¸å¹¸è¿ è¿™ç¯‡æ–‡ç« ï¼š<a href="http://rackt.org/redux/docs/recipes/ImplementingUndoHistory.html" target="_blank" rel="noopener">redux docs have you covered</a> åˆ©ç”¨ Elmçš„<a href="http://package.elm-lang.org/packages/TheSeamau5/elm-undo-redo/2.0.0" target="_blank" rel="noopener">undo-redo package</a>ç¼–å†™äº†ä¸€ä¸ªæ’¤é”€çš„å®ä¾‹ã€‚</p><p>æ³¨ï¼šåŸæ–‡ä¸­ï¼Œä½œè€…è¿˜æä¾›äº†ä¸€ä¸ªå¤šä¸ªå®¢æˆ·ç«¯äº¤äº’çš„ç¤ºä¾‹ç¨‹åºï¼Œå› ä¸ºæ¶‰åŠåˆ°æœåŠ¡ç«¯çš„ç¼–ç ï¼Œä¸»è¦æ˜¯StackServiceæœ¬èº«ï¼ˆ.NETçš„ä¸€ä¸ªwebapiæ¡†æ¶ï¼‰çš„å®ç°ï¼Œæ‰€ä»¥çœç•¥äº†ï¼Œåç»­æœ‰ç©ºæˆ‘å†ç¼–å†™ä¸€ä¸ªNodejså®ç°çš„éƒ¨åˆ†å§ï¼Œå¦‚æœæœºä¼šçš„è¯ã€‚ã€‚æˆ‘ç›¸ä¿¡ä½ æ‡‚çš„ ï¼Œæˆ–è€…å¯ä»¥å…ˆçœ‹ä¸‹åŸæ–‡å§ã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/node-js-error-first-callback/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/node-js-error-first-callback/" itemprop="url">Understanding Error-First Callbacks</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-25T10:38:44+08:00">2016-02-25</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç¿»è¯‘/" itemprop="url" rel="index"><span itemprop="name">ç¿»è¯‘</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>å¦‚æœè¯´Googleçš„V8å¼•æ“æ˜¯Node.jsçš„å¿ƒè„ï¼Œé‚£ä¹ˆå›è°ƒï¼ˆcallbacksï¼‰åˆ™æ˜¯Nodeçš„è„‰ç»œï¼Œå›è°ƒèƒ½å¤Ÿæ¿€æ´»è·¨æ¨¡å—å’Œåº”ç”¨ç¨‹åºä¹‹é—´å¹³è¡¡çš„ã€éå µå¡çš„å¼‚æ­¥æ§åˆ¶æµç¨‹ã€‚ä¸è¿‡åœ¨å¤§è§„æ¨¡ä½¿ç”¨å›è°ƒï¼ˆcallbacksï¼‰æ—¶ ä½ éœ€è¦ä¸€ä¸ªé€šç”¨å¹¶å¯é çš„è§„åˆ™ã€‚<code>error-first</code> å›è°ƒï¼Œä¹Ÿç§°ä¸º <code>errorback</code> æˆ– <code>errback</code> æˆ– <code>node-style callback</code>ï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¹¶ä¸”è¿™å·²ç»æˆä¸ºNode.jsæ ‡å‡†çš„æ–¹å¼ã€‚æœ¬æ–‡å°†å®šä¹‰è¿™ç§æ¨¡å¼ï¼Œå®ƒçš„æœ€ä½³å®è·µå’Œç©¶ç«Ÿå®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p><h2>ä¸ºä»€ä¹ˆè¦æ ‡å‡†åŒ–</h2><p>Nodeå¤§é‡ä½¿ç”¨å›è°ƒè®©æˆ‘ä»¬ä»¿ä½›å›åˆ°äº†æ¯”Javascriptæ›´æ—©çš„å˜æˆé£æ ¼æ—¶ä»£ã€‚Nodejsä½¿ç”¨çš„å›è°ƒç¼–ç¨‹æ˜¯ä¸€ç§è€å­¦é™¢æ´¾é£æ ¼çš„æ–¹å¼ï¼š<a href="http://en.wikipedia.org/wiki/Continuation-passing_style" target="_blank" rel="noopener">å»¶ç»­ä¼ ç»Ÿé£æ ¼ï¼ˆContinuation-Passing Style (CPS)ï¼‰</a> ã€‚è¿™ç§æ–¹å¼, ä¸€ä¸ª&quot;æŒç»­å‡½æ•°&quot;(ç§°ä¸º å›è°ƒ)æ˜¯è¢«ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œç„¶åå†è¢«å…¶ä»–ä»£ç è°ƒç”¨è¿è¡Œï¼Œè¿™å°±å…è®¸ä¸åŒå‡½æ•°è·¨æ•´ä¸ªåº”ç”¨æ»åæˆ–æå‰åœ°è¿›è¡Œå¼‚æ­¥å¤„ç†æ§åˆ¶ã€‚</p><p>Node.jsä¾èµ–å¼‚æ­¥ä»£ç ä¿å­˜å¿«é€Ÿæ€§èƒ½ï¼Œè¿™æ ·ä¹Ÿå°±ä¾èµ–å›è°ƒæ¨¡å¼ï¼Œå›è°ƒä½¿ç”¨å¾—å¤ªå¤šä¼šé™·å…¥åµŒå¥—å›è°ƒï¼Œå›è°ƒé‡ŒåµŒå¥—å›è°ƒï¼Œå˜å¾—éå¸¸å¤æ‚ï¼Œç¨‹åºä»£ç éš¾äºé˜…è¯»ï¼Œæ•´ä¸ªåº”ç”¨çš„æµç¨‹è¿·å¤±åœ¨åµŒå¥—å›è°ƒä¸­ï¼Œerror-firstæ¨¡å¼å¯¼å…¥è§£å†³è¿™ä¸ªéš¾é¢˜ã€‚</p><h2>å®šä¹‰ä¸€ä¸ªerror-firstçš„å›è°ƒ</h2><p>ç¡®å®æœ‰ä¸¤ä¸ªè§„åˆ™ç”¨æ¥å®šä¹‰ä¸€ä¸ªerror-firstçš„å›è°ƒï¼š</p><ol><li><strong>ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯errorå¯¹è±¡</strong>ã€‚å¦‚æœå‘ç”Ÿäº†é”™è¯¯ï¼Œç¬¬ä¸€ä¸ªé”™è¯¯é€šè¿‡ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›</li><li><strong>ç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥ä¼ é€’æˆåŠŸå“åº”çš„æ•°æ®</strong>ã€‚ å¦‚æœæ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆerrorå‚æ•°ä¼šè¢«è®¾ç½®ä¸ºnullæ¥ä¼ é€’ï¼Œè€ŒæˆåŠŸçš„å“åº”æ•°æ®é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°è¿”å›ã€‚</li></ol><p>æ˜¯çš„ï¼Œå®ƒå°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œå¯¹å§? æ˜æ˜¾çš„ï¼Œè¿™é‡Œä¹Ÿæœ‰ä¸€äº›é‡è¦çš„æœ€ä½³å®è·µï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªçœŸå®çš„å†ä¾‹å­ï¼Œå…³äº<code>fs.readFile()</code> :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'/foo.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// <span class="doctag">TODO:</span> Error Handling Still Needed!</span></span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p><code>fs.readFile()</code> éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯éœ€è¦è¯»å–çš„æ–‡ä»¶è·¯å¾„ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯è¯»å–å®Œæˆä¹‹åçš„å›è°ƒå‡½æ•° ï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œæ–‡ä»¶å†…å®¹é€šè¿‡dataå‚æ•°è¿”å›ï¼Œå¦‚æœå‘ç”Ÿäº†é”™è¯¯ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨ï¼Œæˆ–è€…æ²¡æœ‰æƒé™ä»€ä¹ˆçš„ï¼‰ ç¬¬ä¸€ä¸ª err å‚æ•°å°±ä¼šä¼ é€’ä¸€ä¸ªerror å¯¹è±¡ï¼ŒåŒ…æ‹¬å®é™…çš„é”™è¯¯ä¿¡æ¯ã€‚</p><p>è¿™å–å†³äºä½ æ€ä¹ˆå¤„ç†é”™è¯¯ï¼Œä½ å¯ä»¥ç›´æ¥æŠ›å‡ºï¼Œè®©ç¨‹åºå¥”æºƒï¼Œæˆ–è€…æ‹¦æˆªä½è®©ä¸‹ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(<span class="string">'/foo.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// If an error occurred, handle it (throw, propagate, etc)</span></span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Unknown Error'</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Otherwise, log the file contents</span></span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><h2>åˆ†ç±»ä½ çš„é”™è¯¯</h2><p>å½“ä¸€ä¸ªå‡½æ•°ä¼ é€’é”™è¯¯ç»™å›è°ƒå‡½æ•°ï¼Œå®ƒå°±ä¸ç®¡è¿™äº›é”™è¯¯æ˜¯å¦‚ä½•å¤„ç†ï¼ŒreadFileå‡½æ•°ä¸çŸ¥é“è¯»å–æ–‡ä»¶ä¼šå‡ºç°æ€æ ·çš„é”™è¯¯ï¼Œä½†æ˜¯å®ƒå¯ä»¥é¢„æœŸï¼Œå¦åˆ™å°±ä¼šæœ‰ç¾éš¾åæœï¼Œä½†æ˜¯å–ä»£è‡ªå·±å¤„ç†é”™è¯¯ï¼ŒreadFile()ä¼šä¼ æ’­é”™è¯¯å›åˆ°ä½ çš„åŸå§‹æäº¤å¤„ç†è€…ã€‚</p><p>å½“ä½ éµå¾ªè¿™ç§ä¸€è‡´çš„æ¨¡å¼æ—¶ï¼Œé”™è¯¯èƒ½å¤Ÿå¦‚ä½ æ‰€æ„¿è¢«ä¸€å±‚å±‚ä¼ æ’­ï¼Œæ¯ä¸ªå›è°ƒèƒ½é€‰æ‹©å¿½ç•¥æˆ–å¤„ç†ï¼Œæˆ–åŸºäºé”™è¯¯ä¿¡æ¯å†ä¼ æ’­ã€‚</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(err) &#123;</span><br><span class="line">  <span class="comment">// Handle "Not Found" by responding with a custom error page</span></span><br><span class="line">  <span class="keyword">if</span>(err.fileNotFound) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.sendErrorMessage(<span class="string">'File Does not Exist'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Ignore "No Permission" errors, this controller knows that we don't care</span></span><br><span class="line">  <span class="comment">// Propagate all other errors (Express will catch them)</span></span><br><span class="line">  <span class="keyword">if</span>(!err.noPermission) &#123;</span><br><span class="line">    <span class="keyword">return</span> next(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>&lt;!-- more --&gt;</p><h2>æ§åˆ¶ä½ çš„æµç¨‹</h2><p>å½“æœ‰è¿™ç§åšå›ºçš„å›è°ƒåè®®åœ¨å¿ƒä¸­ï¼Œä½ å°±å†ä¹Ÿä¸ä¼šå±€é™äºä¸€æ¬¡åªèƒ½ä½¿ç”¨ä¸€ä¸ªå›è°ƒï¼Œå›è°ƒèƒ½å¤Ÿåœ¨é˜Ÿåˆ—æˆ–å¹¶è¡Œè¢«è°ƒç”¨æˆ–ä¸²è¡ŒåŒ–æ–¹å¼ï¼Œå¦‚æœä½ è¦è¯»å–10ç§ä¸åŒçš„æ–‡ä»¶ï¼Œæˆ–è¿›è¡Œ100ä¸ªä¸åŒçš„APIè°ƒç”¨ï¼Œå†ä¹Ÿæ²¡æœ‰ç†ç”±è¯´ä¸å¯ä»¥ä¸€æ¬¡æ€§è¿›è¡Œäº†ã€‚</p><p>asyncåº“æ˜¯ä¸€ç§é«˜çº§å›è°ƒåº”ç”¨åŒ…ï¼Œå› ä¸ºæœ‰error-firstå›è°ƒæ¨¡å¼ï¼Œå®ƒå°±å¾ˆå®¹æ˜“è¢«ä½¿ç”¨ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Example taken from caolan/async README</span></span><br><span class="line"><span class="keyword">async</span>.parallel(&#123;</span><br><span class="line">    one: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            callback(<span class="literal">null</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">200</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    two: <span class="function"><span class="keyword">function</span>(<span class="params">callback</span>)</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            callback(<span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">        &#125;, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">err, results</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// results is equal to: &#123;one: 1, two: 2&#125;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/node-js-best-practices/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/node-js-best-practices/" itemprop="url">Nodejsæœ€ä½³å®è·µ</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-24T14:10:19+08:00">2016-02-24</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç¿»è¯‘/" itemprop="url" rel="index"><span itemprop="name">ç¿»è¯‘</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>æˆ‘ä»¬æ€»æ˜¯è¢«é—®åŠå…³äº<code>Node.js</code>çš„æœ€ä½³å®è·µå’ŒæŠ€å·§ -- æ‰€ä»¥è¿™ç¯‡æ–‡ç« å°±æ˜¯è¦å°†è¿™äº›è®²æ¸…æ¥šï¼Œæ€»ç»“æˆ‘ä»¬åœ¨<a href="http://risingstack.com/" title="åšå®¢çš„åŸæ–‡åœ°å€" target="_blank" rel="noopener">RisingStack</a>æ€ä¹ˆæ ·ç¼–å†™Node.jsåº”ç”¨ç¨‹åºã€‚</p><p>è¿™äº›æœ€ä½³å®è·µæœ‰äº›äº‹å±äºä»£ç é£æ ¼ï¼Œæœ‰äº›åˆ™æ˜¯æ€ä¹ˆå¤„ç†å¼€å‘æµç¨‹</p><h2>0x01 ä»£ç é£æ ¼ Coding style</h2><h3>å›è°ƒçº¦å®š Callback convention</h3><p>æ‰€æœ‰æ¨¡å—åº”è¯¥æš´éœ²ä¸€ä¸ªé”™è¯¯çš„å›è°ƒå‡½æ•°æ¥å£ï¼Œå°±åƒä¸‹é¢è¿™æ®µä»£ç ï¼š</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">dragonName, callback</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œåšä¸€äº›äº‹æƒ…</span></span><br><span class="line">  <span class="keyword">var</span> dragon = createDragon(dragonName);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æç¤º, è¿™é‡Œçš„ç¬¬ä¸€ä¸ªå‚æ•°å…¶å®æ˜¯ä¸€ä¸ªé”™è¯¯ä¿¡æ¯çš„å‚æ•°</span></span><br><span class="line">  <span class="comment">// è¿™é‡Œçš„å€¼åˆšå¥½æ˜¯null</span></span><br><span class="line">  <span class="comment">// ä½†æ˜¯å¦‚æœæ˜¯æœ‰é”™è¯¯äº§ç”Ÿï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥å‘å›è°ƒå‡½æ•°ä¼ é€’ä¸€ä¸ªErrorçš„å¯¹è±¡</span></span><br><span class="line">  <span class="keyword">return</span> callback(<span class="literal">null</span>, dragon);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3>æ€»æ˜¯åœ¨å›è°ƒå‡½æ•°ä¸­æ£€æŸ¥é”™è¯¯</h3><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ä¸ºä»€ä¹ˆå¿…é¡»è¿™ä¹ˆåšï¼Œå…ˆç»™å¤§å®¶çœ‹ä¸€ä¸ªåä¾‹ï¼Œç„¶åå†çœ‹çœ‹æ€ä¹ˆä¿®å¤å®ƒ</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this example is **BROKEN**, we will fix it soon :)</span></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</span><br><span class="line">  fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    callback(<span class="built_in">JSON</span>.parse(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">readJSON(<span class="string">'./package.json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, pkg</span>) </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p></p><p>è¿™ä¸ª<code>readJSON</code>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªé—®é¢˜ å°±æ˜¯åœ¨æ‰§è¡Œçš„è¿‡ç¨‹å‘ç”Ÿå¼‚å¸¸ï¼Œè€Œä»£ç å¹¶æ²¡æœ‰æ£€æŸ¥å®ƒ(æ³¨ï¼šè¿™æ ·ä½ å°±ä¸èƒ½è·å¾—ä½ æœŸæœ›çš„ç¨‹åºè¿è¡Œç»“æœ)ã€‚ ä½ åº”è¯¥å§‹ç»ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨å¼‚å¸¸</p><p>æ¥çœ‹çœ‹æ”¹è¿›åçš„ç‰ˆæœ¬:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this example is **STILL BROKEN**, we are fixing it!</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</span><br><span class="line">  fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// here we check, if an error happened</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="comment">// å•Šå‘€, æŠŠerrä¼ é€’åˆ°å›è°ƒå‡½æ•°ä¸­</span></span><br><span class="line">      <span class="comment">// è®°ä½: æŠŠé”™è¯¯æ”¾åœ¨ç¬¬ä¸€ä¸ªå‚æ•°é‚£é‡Œ</span></span><br><span class="line">      callback(err);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// no error, pass a null and the JSON</span></span><br><span class="line">    callback(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3>å›è°ƒå‡½æ•°ä¸­çš„ <code>Return</code></h3><p>ä¸Šé¢ä»£ç ä¸­å¦å¤–ä¸€ä¸ªé—®é¢˜å°±æ˜¯å½“ä¸€ä¸ªé”™è¯¯å‘ç”Ÿäº†ï¼Œä»£ç å¹¶ä¸ä¼šå†ifæ¡ä»¶è¯­å¥å¤„ç»ˆæ­¢ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œï¼Œè¿™ä¼šå¸¦æ¥å¾ˆå¤šæ„æƒ³ä¸åˆ°çš„äº‹æƒ…ï¼Œä½œä¸ºä¸€ä¸ªç»éªŒæ³•åˆ™ï¼Œå§‹ç»ˆåœ¨å›è°ƒå‡½æ•°å¤„ä½¿ç”¨returnã€‚</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this example is **STILL BROKEN**, we are fixing it!</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</span><br><span class="line">  fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(err);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> callback(<span class="literal">null</span>, <span class="built_in">JSON</span>.parse(data));</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3>åªåœ¨åŒæ­¥ä»£ç ä¸­ä½¿ç”¨ <code>try-catch</code> è¯­å¥</h3><p>å·®ä¸å¤šäº†ï¼Œå¦å¤–ä¸€ä»¶äº‹ä»¶æˆ‘ä»¬ä¸æ‰“ä¸è¦å…³æ³¨ä¸‹<code>JSON.parse</code>æ–¹æ³•ï¼Œ å¦‚æœè¯•å›¾è½¬æ¢ä¸€ä¸ªä¸ç¬¦åˆçš„JSONæ ¼å¼ï¼Œ<code>JSON.parse</code> å¯èƒ½è§¦å‘ä¸€ä¸ªå¼‚å¸¸ã€‚</p><p>å› ä¸º<code>JSON.parse</code>æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨<code>try-catch</code>è¯­å¥å°†å®ƒåŒ…è£…èµ·æ¥ã€‚åŒå¿—ä»¬ï¼Œè¿™é‡Œè¦æ³¨æ„å•Šï¼åªæœ‰åŒæ­¥æ‰§è¡Œçš„ä»£ç å—é‡Œæ‰èƒ½è¿™ä¹ˆåšï¼Œå¦‚æœåœ¨å›è°ƒå‡½æ•°ä¸­è¿™å°±ä¸ç®¡ç”¨äº†ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this example **WORKS**! :)</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readJSON</span>(<span class="params">filePath, callback</span>) </span>&#123;</span><br><span class="line">  fs.readFile(filePath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> parsedJson;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Handle error</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> callback(err);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parse JSON</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      parsedJson = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (exception) &#123;</span><br><span class="line">      <span class="keyword">return</span> callback(exception);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Everything is ok</span></span><br><span class="line">    <span class="keyword">return</span> callback(<span class="literal">null</span>, parsedJson);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><h3>å°½é‡é¿å…ä½¿ç”¨ <code>this</code> å’Œ <code>new</code></h3><p>åœ¨Nodeä¸­ç»‘å®šä¸€ä¸ªç‰¹æ®Šçš„ä¸Šä¸‹æ–‡å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œå› ä¸ºNodeè®¾è®¡åˆ°ä¼ é€’å¤§é‡çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”é‡åº¦ä½¿ç”¨é«˜ç­‰çº§çš„å‡½æ•°æ¥ç®¡ç†æ§åˆ¶æµï¼Œä½¿ç”¨å‡½æ•°å¼çš„ç¼–ç æ–¹å¼å¯ä»¥çœæ‰ä½ çš„å¾ˆå¤šéº»çƒ¦ã€‚å½“ç„¶ä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œå¦‚ç”¨å±æ€§å¯ä»¥æ›´é«˜æ•ˆçš„æ—¶å€™ï¼Œå¦‚æœå¯èƒ½çš„è¯è¿˜æ˜¯å°½é‡é¿å…ä½¿ç”¨å®ƒä»¬ã€‚</p><p>&lt;!-- more --&gt;</p><h3>åˆ›å»ºå°è€Œç¾çš„æ¨¡å—</h3><p>è®²é—®é¢˜åˆ†è§£æˆä¸€ä¸ªä¸ªå°é—®é¢˜ï¼Œå¹¶æ¨¡å—åŒ–å¤„ç†å®ƒä»¬ï¼ˆDo it the unix-wayï¼‰ï¼š</p><p>å¼€å‘è€…åº”è¯¥åˆ›å»ºé€šè¿‡å®šä¹‰çš„æ¥å£ä¸²è”å„ä¸ªæ¨¡å—çš„ç¨‹åºï¼Œè¿™æ ·é—®é¢˜å°±æ˜¯æœ¬åœ°çš„ï¼Œå¹¶ä¸”åœ¨å°†æ¥çš„ç‰ˆæœ¬ä¸­å¯ä»¥æ›¿æ¢å®ƒä»¬æ¥æ”¯æŒæ–°çš„åŠŸèƒ½ç‰¹æ€§</p><blockquote><p>Developers should build a program out of simple parts connected by well defined interfaces, so problems are local, and parts of the program can be replaced in future versions to support new features.</p></blockquote><p>ä¸è¦å¤ªå¦ç±»ï¼ˆæ³¨ï¼šDeathstarså°±æ˜¯å›½å¤–çš„ä¸€ä¸ªéä¸»æµä¹é˜Ÿï¼‰ -- ä¿æŒç®€å•ï¼Œä¸€ä¸ªæ¨¡å—å°±åšä¸€ä»¶äº‹æƒ…ï¼Œå¹¶å§è¿™ä»¶äº‹åšå¥½ Do not build Deathstars - keep it simple, a module should do one thing, but that thing well.</p><h3>ä½¿ç”¨å¥½çš„å¼‚æ­¥æ¨¡å¼</h3><p>ä½¿ç”¨ <a href="https://github.com/caolan/async%20%E2%80%9Casync%E2%80%9D" target="_blank" rel="noopener">async</a>. ï¼ˆæ³¨ï¼šè¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æˆ‘å°±æ¯”è¾ƒå–œæ¬¢<a href="https://github.com/JacksonTian/eventproxy" target="_blank" rel="noopener">EventProxy</a>ï¼‰</p><h2>0x02 é”™è¯¯æ‹¦æˆª</h2><p>é”™è¯¯å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼šæ“ä½œé”™è¯¯å’Œä»£ç é”™è¯¯ Errors can be divided into two main parts: operational errors and programmer errors.</p><h3>æ“ä½œé”™è¯¯</h3><p>æ“ä½œé”™è¯¯åœ¨ç¼–ç éå¸¸å¥½çš„ç¨‹åºä¸­ä¹ŸåŒæ ·ä¼šå‘ç”Ÿï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯bugsï¼Œåªæ˜¯æ“ä½œç³»ç»Ÿæˆ–è€…è¿œç«¯æœåŠ¡çš„é—®é¢˜ï¼Œå°±åƒï¼š</p><ul><li>è¯·æ±‚è¶…æ—¶</li><li>å†…å­˜æº¢å‡º</li><li>æ— æ³•é“¾æ¥åˆ°è¿œç«¯æœåŠ¡</li><li>...</li></ul><h3>æ‹¦æˆªæ“ä½œé”™è¯¯</h3><p>æ ¹æ®ä¸åŒçš„æ“ä½œé”™è¯¯çš„ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–¹å¼ï¼š</p><ul><li>è¯•ç€è§£å†³é”™è¯¯ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªå…ˆ</li><li>åœ¨å¤„ç†ç½‘ç»œé€šè®¯æ—¶ï¼Œä½ åº”è¯¥é‡è¯•ä¸€ä¸‹</li><li>å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œå¹¶è®°å½•ä¸€ä¸‹ç”¨æˆ·çš„è¾“å…¥ T</li><li>é‡å¯è¿›ç¨‹å§ï¼Œä¹Ÿè®¸å°±å¥½äº†</li></ul><p>åŒæ ·ï¼Œåœ¨ä¸Šé¢é‚£äº›åŸåˆ™ä¹‹å¤–è¿˜æœ‰ï¼š <strong>è®°å½•æ‰€æœ‰çš„æ—¥å¿—</strong>.</p><h3>ä»£ç é”™è¯¯</h3><p>ä»£ç é”™è¯¯å°±æ˜¯bugsäº†ï¼Œè¿™æ˜¯å¯ä»¥é¿å…çš„ï¼Œå°±åƒï¼š</p><ul><li>è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œä½†æ˜¯æ²¡æœ‰ä½¿ç”¨å›è°ƒ</li><li>è¯»å–ä¸€ä¸ªç©ºå¯¹è±¡çš„å±æ€§</li></ul><h3>æ‹¦æˆªä»£ç é”™è¯¯</h3><p>å› ä¸ºè¿™äº›é”™è¯¯æ˜¯bugsï¼Œä½ ä¸çŸ¥é“ä½ çš„ç¨‹åºä»€ä¹ˆæ—¶å€™å´©æºƒã€‚å®é™…ä¸Šä½ åº”è¯¥ä½¿ç”¨å®ˆæŠ¤è¿›ç¨‹ï¼Œå½“ä½ çš„ç¨‹åºå´©æºƒæ—¶æ¥é‡å¯ä½ çš„ç¨‹åºï¼Œå°±åƒ <a href="http://supervisord.org/" target="_blank" rel="noopener">supervisord</a> æˆ–è€… <a href="http://mmonit.com/monit/" target="_blank" rel="noopener">monit</a> ï¼ˆæ³¨ï¼šæ›´æ¨è<a href="https://github.com/Unitech/pm2" target="_blank" rel="noopener">pm2</a> ï¼‰</p><h2>0x03 å·¥ä½œæµ</h2><h3>ä½¿ç”¨ <code>npm init</code> åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„é¡¹ç›®</h3><p>è¿™ä¸ªåˆå§‹åŒ–å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºç¨‹åºçš„<code>package.json</code>æ–‡ä»¶ï¼Œå¹¶è®¾ç½®ä¸€äº›é»˜è®¤å€¼ï¼Œä½ å¯ä»¥åœ¨æ™šç‚¹ä¿®æ”¹å®ƒã€‚</p><p>å½“ä½ å¼€å§‹ä¸€ä¸ªæ–°é¡¹ç›®æ—¶ åº”è¯¥è¿™æ ·å¼€å§‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir my-awesome-new-project</span><br><span class="line">cd my-awesome-new-project</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><p></p><h3>æä¾› <code>start</code> å’Œ <code>test</code> çš„å‘½ä»¤</h3><p>åœ¨ä½ çš„ <code>package.json</code> æ–‡ä»¶ä¸­ä½ å¯ä»¥åœ¨<code>scripts</code>èŠ‚ç‚¹ä¸‹è®¾ç½®å¯¹åº”å‘½ä»¤.é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>npm init</code>è®²è‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªå‘½ä»¤ï¼Œ<code>start</code> å’Œ <code>test</code>.ä»–ä»¬å¯ä»¥é€šè¿‡<code>npm start</code> å’Œ <code>npm test</code> æ¥è¿è¡Œã€‚ åŒæ ·ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè‡ªå®šä¹‰è‡ªå·±çš„å‘½ä»¤å¹¶é€šè¿‡ <code>npm run-script &lt;SCRIPT_NAME&gt;</code> æ¥æ‰§è¡Œè¿™äº›å‘½ä»¤</p><p>æç¤ºï¼šNPMä¼šè®¾ç½®ä¸€ä¸ªå˜é‡ <code>$PATH</code>ï¼ˆå½“å‰ç›®å½•ï¼‰ è®¾ç½®æˆ <code>node_modules/.bin</code>ç›®å½•æ¥æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™é¿å…å…¨å±€å®‰è£… <code>NPM</code> æ¨¡å—ã€‚ Note, that NPM will set up $PATH to look in node_modules/.bin for executables. This helps avoid global installs of NPM modules.</p><h3>Environment variables</h3><p>ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚æœ€é€šè¿‡çš„æ–¹å¼æ˜¯é€šè¿‡è®¾ç½® <code>NODE_ENV</code> å˜é‡æ¥å®ç°ã€‚ æ ¹æ®ä½ çš„ç¯å¢ƒå˜é‡ï¼Œä½ å¯ä»¥è¯»å–ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæ¨èæ¨¡å—<a href="https://github.com/indexzero/nconf" target="_blank" rel="noopener">nconf</a> å½“ç„¶ï¼Œä½ å¯ä»¥åœ¨Node.jsåº”ç”¨ç¨‹åºä¸­é€šè¿‡ <code>process.env</code> ä½¿ç”¨å…¶ä»–ç¯å¢ƒå˜é‡, <code>process.env</code>è¿™ä¸ªå¯¹è±¡åŒ…å«æ‰€æœ‰çš„ç”¨æˆ·å˜é‡ Of course, you can use other environment variables in your Node.js applications with process.env, which is an object that contains the user environment.</p><h3>ä¸è¦é‡å¤é€ è½®å­</h3><p>æ€»æ˜¯å…ˆæŸ¥æ‰¾ä¸‹æ˜¯å¦å·²ç»å­˜åœ¨è§£å†³æ–¹æ¡ˆã€‚<code>NPM</code>æ‹¥æœ‰å¤§é‡çš„åŒ…ï¼Œå¾ˆæœ‰å¯èƒ½ä½ èƒ½åœ¨é‡Œé¢æ‰¾åˆ°ä½ éœ€è¦çš„æ¨¡å—ã€‚</p><h3>ä½¿ç”¨ç»Ÿä¸€ä»£ç é£æ ¼</h3><p>ä½¿ç”¨ç»Ÿä¸€çš„ä»£ç é£æ ¼ï¼Œæ— è®ºä½ çš„ä»£ç é‡å¤šä¹ˆçš„åºå¤§ï¼Œéƒ½æ˜¯ç›¸å¯¹å®¹æ˜“é˜…è¯»çš„ã€‚ç»Ÿä¸€çš„ä»£ç é£æ ¼ä¸€èˆ¬åŒ…å«ï¼Œ ç¼©è¿›è§„åˆ™ ï¼Œ å˜é‡å‘½åè§„åˆ™ ç­‰ç­‰ã€‚</p><p>è¿™é‡Œæœ‰ä¸€ä»½å‚è€ƒï¼Œ<a href="https://github.com/RisingStack/node-style-guide" target="_blank" rel="noopener">RisingStackâ€˜s Node.js Style Guide</a>ã€‚</p><h2>0x04 æ¥ä¸‹æ¥</h2><p>æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¸®åŠ©ä½ æ›´å¥½çš„ä½¿ç”¨Node.jsï¼Œå¹¶è§£å†³ä¸€äº›ä»¤ä½ å¤´ç–¼çš„é—®é¢˜ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ç¯‡å…³äºæ“ä½œæç¤ºå’Œæœ€ä½³å®è·µçš„æ–‡ç« ï¼Œ</p><p>ä½ å¯ä»¥ä»è¿™é‡Œè·å¾—ä¸€äº›å…³äºéƒ¨ç½²çš„æç¤ºï¼š <a href="http://blog.risingstack.com/continuous-deployment-of-node-js-applications/" target="_blank" rel="noopener">Continuous Deployment of Node.js Applications.</a></p><p>æ‰©å±•é˜…è¯»: <a href="http://blog.risingstack.com/node-js-best-practices-part-2/" target="_blank" rel="noopener">Node.js Best Practices - Part 2</a> - JSHint and JSCS Rules, JS over JSON, dependency injection and more.</p><p>via ï¼š <a href="https://blog.risingstack.com/node-js-best-practices/" target="_blank" rel="noopener">https://blog.risingstack.com/node-js-best-practices/</a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/fundamental_nodejs_design_patterns/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/fundamental_nodejs_design_patterns/" itemprop="url">Node.js åŸºç¡€è®¾è®¡æ¨¡å¼</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-02-13T14:23:00+08:00">2016-02-13</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/ç¿»è¯‘/" itemprop="url" rel="index"><span itemprop="name">ç¿»è¯‘</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Â å½“è®¨è®ºè®¾è®¡æ¨¡å¼çš„æ—¶å€™ä½ å¯èƒ½ä¼šæƒ³åˆ° <strong>å•ä¾‹</strong>ï¼ˆsingletonsï¼‰, <strong>è§‚å¯Ÿè€…</strong>ï¼ˆobserversï¼‰ æˆ–è€… <strong>å·¥å‚</strong>ï¼ˆfactoriesï¼‰ <strong>factories</strong>ï¼ˆå·¥å‚ï¼‰ï¼Œè¿™ç¯‡æ–‡ç« ä¸æ˜¯ä¸“é—¨å»è®¨è®ºä»–ä»¬ï¼ŒåŒæ—¶ä¹Ÿä¼šè®¨è®ºä¸€äº›å…¶ä»–å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œæ¯”å¦‚<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆdependency injectionï¼‰å’Œ<strong>ä¸­é—´ä»¶</strong>ï¼ˆmiddlewaresï¼‰</p><h2>ä»€ä¹ˆæ˜¯è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><p>è®¾è®¡æ¨¡å¼æ˜¯ä¸€ç§å¯¹äºå¸¸è§é—®é¢˜çš„é€šç”¨å¯å¤ç”¨çš„è§£å†³æ–¹æ¡ˆã€‚</p><h2>å•ä¾‹ Singletons</h2><p>å•ä¾‹æ¨¡å¼é™åˆ¶ä¸€ä¸ªç±»çš„å®ä¾‹æ•°é‡åªèƒ½æ˜¯ä¸€ä¸ªï¼Œå› ä¸ºä½¿ç”¨<code>require</code>æ–¹å¼ï¼Œåœ¨Node.jsä¸­åˆ›å»ºå•ä¾‹æ˜¯ç›¸å½“ç®€å•çš„ã€‚</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//area.js</span></span><br><span class="line"><span class="keyword">var</span> PI = <span class="built_in">Math</span>.PI;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">circle</span> (<span class="params">radius</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> radius * radius * PI;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.circle = circle;</span><br></pre></td></tr></table></figure><p></p><p>ä¸ç®¡æˆ‘ä»¬åœ¨ç¨‹åºä¸­è°ƒç”¨å®ƒå¤šå°‘æ¬¡ï¼Œå®ƒå§‹ç»ˆåªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> areaCalc = <span class="built_in">require</span>(<span class="string">'./area'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(areaCalc.circle(<span class="number">5</span>));</span><br></pre></td></tr></table></figure><p></p><p>å› ä¸º <code>requrie</code> çš„è¡Œä¸ºï¼Œå•ä¾‹å¯èƒ½æ˜¯åœ¨ <code>NPM</code> æ‰€æœ‰æ¨¡å—ä¸­æœ€é€šç”¨çš„ Node.js è®¾è®¡æ¨¡å¼äº†</p><h2>è§‚å¯Ÿè€… Observers</h2><p>ä¸€ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ªä¾èµ–è€…/è§‚å¯Ÿè€…çš„åˆ—è¡¨ï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–çš„æ—¶å€™è‡ªåŠ¨é€šçŸ¥å®ƒä»¬ã€‚å»å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå°±è¦ä½¿ç”¨<code>EventEmitter</code>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MyFancyObservable.js</span></span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">var</span> EventEmitter = <span class="built_in">require</span>(<span class="string">'events'</span>).EventEmitter;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyFancyObservable</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  EventEmitter.call(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">util.inherits(MyFancyObservable, EventEmitter);</span><br></pre></td></tr></table></figure><p></p><p>è¿™å°±æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸€ä¸ªè§‚å¯Ÿè€…å¯¹è±¡ï¼Œä¸ºäº†è®©å®ƒæœ‰ç‚¹ç”¨ï¼Œè®©æˆ‘ç»™å®ƒåŠ å‡ ä¸ªæ–¹æ³•ã€‚</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MyFancyObservable.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.emit(<span class="string">'hello'</span>, name);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬çš„å¯¹è±¡å¯ä»¥è§¦å‘äº‹ä»¶äº† -- è®©æˆ‘ä»¬è¯•è¯•çœ‹ï¼</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MyFancyObservable = <span class="built_in">require</span>(<span class="string">'MyFancyObservable'</span>);</span><br><span class="line"><span class="keyword">var</span> observable = <span class="keyword">new</span> MyFancyObservable();</span><br><span class="line"></span><br><span class="line">observable.on(<span class="string">'hello'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observable.hello(<span class="string">'john'</span>);</span><br></pre></td></tr></table></figure><p></p><h2>å·¥å‚ Factories</h2><p>å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹çš„æ¨¡å¼ï¼Œç”¨äºè„±ç¦»æ„é€ å‡½æ•°è€Œæ˜¯æä¾›ä¸€ç§é€šç”¨æ¥å£æ¥åˆ›å»ºå¯¹è±¡ã€‚è¿™ç§æ¨¡å¼åœ¨åˆ›å»ºå¤æ‚è¿‡ç¨‹æ—¶éå¸¸æœ‰ç”¨</p><p></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyClass</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.options = options;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// modify the options here if you want</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> MyClass(options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports.create = create;</span><br></pre></td></tr></table></figure><p></p><p>å·¥å‚ä¹Ÿè®©æµ‹è¯•å˜å¾—å®¹æ˜“å¤šäº†ï¼Œä½ å¯ä»¥é€šè¿‡å®ƒæ¥æ³¨å…¥æ¨¡å—çš„ä¾èµ–ã€‚</p><h2>ä¾èµ–æ³¨å…¥ Dependency Injection</h2><p>ä¾èµ–æ³¨å…¥æ˜¯ä¸€ç§å½“ä¸€ä¸ªæˆ–å¤šä¸ªä¾èµ–ï¼ˆæœåŠ¡ï¼‰è¢«æ³¨å…¥æˆ–è€…å¼•ç”¨ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªä¾èµ–å¯¹è±¡ä¸­çš„è½¯ä»¶è®¾è®¡æ¨¡å¼ã€‚</p><p>In this example, we are going to create a UserModel which gets a database dependency. åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªè·å–æ•°æ®åº“ä¾èµ–çš„<code>UserModel</code>å¯¹è±¡</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">userModel</span> (<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> db;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!options.db) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Options.db is required'</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  db = options.db;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    create: <span class="function"><span class="keyword">function</span> (<span class="params">done</span>) </span>&#123;</span><br><span class="line">      db.query(<span class="string">'INSERT ...'</span>, done);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = userModel;</span><br><span class="line">Now we can create an instance <span class="keyword">from</span> it using:</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> db = <span class="built_in">require</span>(<span class="string">'./db'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">'User'</span>)(&#123;</span><br><span class="line">  db: db</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>å®ƒæœ‰ä»€ä¹ˆç”¨ï¼Ÿå®ƒè®©è¿™æ¬¡å˜å¾—éå¸¸ç®€å• -- å½“ä½ åœ¨ç¼–å†™ä½ çš„å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“çš„åŒ…è£…ä¸€ä¸ªæ•°æ®åº“å®ä¾‹åˆ°ä½ çš„æ¨¡å‹ä¸­ã€‚</p><h2>ä¸­é—´ä»¶æˆ–ç®¡é“ Middlewares / pipelines</h2><p>ä¸­é—´ä»¶æ˜¯ä¸€ç§å¼ºå¤§åˆç®€ä¾¿çš„æ¨¡å¼:ä¸€ä¸ªå•å…ƒ/å‡½æ•°è¾“å‡ºçš„ç»“æœæ˜¯ä¸‹ä¸€ä¸ªçš„è¾“å…¥.å¦‚æœä½ ç”¨è¿‡<code>Express</code>æˆ–è€…<code>Koa</code>,é‚£ä¹ˆä½ åº”è¯¥å·²ç»å¯¹è¿™ä¸ªæ¨¡å¼æ¯”è¾ƒç†Ÿæ‚‰äº†</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹<code>Koa</code>æ˜¯æ€ä¹ˆå®ç°å®ƒçš„:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use = <span class="function"><span class="keyword">function</span>(<span class="params">fn</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">this</span>.middleware.push(fn);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p></p><p>éå¸¸åŸºç¡€ï¼Œå½“ä½ æ·»åŠ ä¸€ä¸ªä¸­é—´ä»¶çš„æ—¶å€™å®ƒä»…ä»…æŠŠå®ƒæ·»åŠ åˆ°ä¸€ä¸ªä¸­é—´ä»¶æ•°ç»„ä¸­ï¼Œåˆ°ç›®å‰ä¸ºæ­¢éƒ½è¿˜å¥½ï¼Œé‚£ä¹ˆå½“è¯·æ±‚è¿™å°æœåŠ¡å™¨æ—¶åˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢?</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = middleware.length;</span><br><span class="line"><span class="keyword">while</span> (i--) &#123;</span><br><span class="line">  next = middleware[i].call(<span class="keyword">this</span>, next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>æ²¡æœ‰å½©è›‹-- ä½ çš„ä¸­é—´ä»·è¢«ä¸€ä¸ªæ¥ç€ä¸€ä¸ªçš„è°ƒç”¨.</p><h2>æµ Streams</h2><p>ä½ å¯ä»¥æŠŠæµï¼ˆStreamsï¼‰æƒ³è±¡æˆç‰¹æ®Šçš„ç®¡é“ï¼ˆpipelinesï¼‰ï¼Œå®ƒä»¬éå¸¸é€‚åˆå¤„ç†å¤§æ•°æ®ï¼Œç‰¹åˆ«å½“å®ƒä»¬æ˜¯å­—èŠ‚å½¢å¼ï¼Œè€Œéå¯¹è±¡æ—¶</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">process.stdin.on(<span class="string">'readable'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buf = process.stdin.read(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">console</span>.dir(buf);</span><br><span class="line">    process.stdin.read(<span class="number">0</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ (echo abc; sleep 1; echo def; sleep 1; echo ghi) | node consume2.js</span><br><span class="line">&lt;Buffer 61 62 63&gt;</span><br><span class="line">&lt;Buffer 0a 64 65&gt;</span><br><span class="line">&lt;Buffer 66 0a 67&gt;</span><br><span class="line">&lt;Buffer 68 69 0a&gt;</span><br></pre></td></tr></table></figure><p></p><p>To get a better understanding of streams check out substack's Stream Handbook.</p><p>å»¶ä¼¸é˜…è¯»</p><p><a href="https://blog.risingstack.com/node-js-best-practices" target="_blank" rel="noopener">Node.js æœ€ä½³å®è·µ</a>ï¼šå›è°ƒæƒ¯ä¾‹ã€å¼‚æ­¥ä»£ç æ¨¡å¼ã€é”™è¯¯å¤„ç†ä»¥åŠå·¥ä½œæµæŠ€å·§ã€‚ <a href="https://blog.risingstack.com/node-js-best-practices-part-2" target="_blank" rel="noopener">Node.js æœ€ä½³å®è·µ - Part 2</a>ï¼šä»£ç æäº¤é¢„æ£€ã€JavaScript ä»£ç é£æ ¼æ£€æµ‹å™¨åŠé…ç½®ã€‚</p><p>via åŸæ–‡ï¼š https://blog.risingstack.com/fundamental-node-js-design-patterns/?utm_source=nodeweekly&amp;utm_medium=email</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/use-dustjs-engine-in-expressjs4-0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/use-dustjs-engine-in-expressjs4-0/" itemprop="url">åœ¨Expressjs4.0ä¸­ä½¿ç”¨dustjsæ¨¡æ¿å¼•æ“</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-10-19T21:03:35+08:00">2014-10-19</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/åšå®¢/" itemprop="url" rel="index"><span itemprop="name">åšå®¢</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2>å¼•è¨€</h2><p>Â Â Â Â <a href="http://linkedin.github.io/dustjs/" target="_blank" rel="noopener">dustjs</a>æ˜¯ä¸€æ¬¾jsæ¨¡æ¿,æœ€æ—©ç”±ä¸ªäººå¼€å‘ç»´æŠ¤ï¼Œåæ¥ç”±linkinæ¥æ‰‹ï¼Œå‘å±•çš„æ›´åŠ è¿…é€Ÿï¼Œè¯´å®è¯jsæ¨¡æ¿è¿™å—æœ‰å¾ˆå¤šé€‰æ‹©ï¼Œéƒ½éå¸¸ä¼˜ç§€ï¼Œå’Œpaypalçš„é€‰æ‹©ä¸€æ ·ï¼Œæœ€ç»ˆæˆ‘ä½¿ç”¨dustjsä½œä¸ºæˆ‘çš„é¦–é€‰æ¨¡æ¿è¯­è¨€ã€‚dustjsä¸­æ–‡çš„æ–‡æ¡£éå¸¸å°‘ï¼Œæ‰€ä»¥åœ¨å›½å†…çš„ä½¿ç”¨ä¸æ˜¯å¾ˆå¤šï¼Œè¿™é‡Œå‡ ç¯‡åšæ–‡æœ‰å¯¹dustjsè¯­æ³•åŸºæœ¬çš„ä»‹ç»<a href="http://blog.sprabbit.com/blog/2013/08/16/introduction-dustjs-1/" target="_blank" rel="noopener">Dust.jsè¯­æ³•ç®€ä»‹ï¼ˆä¸€ï¼‰</a>,<a href="http://blog.sprabbit.com/blog/2013/08/17/introduction-dustjs-2/" target="_blank" rel="noopener">Dust.jsè¯­æ³•ç®€ä»‹ï¼ˆäºŒï¼‰</a>,<a href="http://blog.sprabbit.com/blog/2013/08/19/introduction-dustjs-3/" target="_blank" rel="noopener">Dust.jsè¯­æ³•ç®€ä»‹ï¼ˆä¸‰ï¼‰</a></p><p>Â Â Â Â express4.0 é»˜è®¤çš„æ¨¡æ¿å¼•æ“æ˜¯jadeï¼Œjade åˆšåˆšå¼€å§‹ç”¨çš„æ—¶å€™æ„Ÿè§‰åƒpythonï¼Œæœ‰ä¸¥æ ¼çš„è¯­æ³•æ ¼å¼ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜å…»æˆè‰¯å¥½çš„ç¼–ç ä¹ æƒ¯ï¼Œä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸‹å°±ä¼šå‘ç°è¿™ç§å¼ºåˆ¶ï¼Œåœ¨æ¨¡æ¿ç«¯ç¼–å†™é€»è¾‘è¯­è¨€çš„æ—¶å€™ï¼Œç‰¹åˆ«åœ¨åµŒå¥—åˆ¤æ–­çš„æ—¶å€™ä¼šæœ‰ä¸€äº›æ— æ³•é€¾è¶Šçš„é—®é¢˜ï¼ŒåŒæ—¶å®ƒçš„æ€§èƒ½é—®é¢˜ä¹Ÿä¸€ç›´åˆ«äººè¯Ÿç—…ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ejsæˆ–è€…å…¶ä»–æ¨¡æ¿ï¼Œè¿™ä¸æ˜¯æˆ‘è¦é˜è¿°çš„é‡ç‚¹ã€‚</p><h2>å®ç°</h2><p>å¦‚æœæ˜¯ç°æˆçš„expressé¡¹ç›®æˆ–è€…ä½¿ç”¨express-genarateç”ŸæˆåŸºæœ¬ç»“æ„ä¹‹åï¼Œåœ¨<code>package.json</code> æ–‡ä»¶çš„ <code>dependencies</code> æ·»åŠ ä¸‰ä¸ªä¾èµ–ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;dustjs-helpers&quot;: &quot;~1.3.0&quot;,</span><br><span class="line">&quot;dustjs-linkedin&quot;: &quot;~2.4.2&quot;,</span><br><span class="line">&quot;adaro&quot;: &quot;^0.1.5&quot;</span><br></pre></td></tr></table></figure><p></p><p>å…¶ä¸­ <code>dustjs-linkedin</code>æ˜¯dustjsæ¨¡æ¿æœ¬èº«ï¼Œ<code>dustjs-helpers</code>æ˜¯ä¸€äº›æ¨¡æ¿çš„æ‰©å±•æ–¹æ³•ï¼Œåœ¨<a href="https://github.com/linkedin/dustjs/wiki/Dust-Tutorial" target="_blank" rel="noopener">dustjså®˜æ–¹çš„æ–‡æ¡£</a>ä¸­æœ‰è¯´æ˜ï¼Œéå¸¸æœ‰ç”¨ï¼Œä½ å¯ä»¥æ·»åŠ è‡ªå·±çš„helperæ–¹æ³•ã€‚è€Œ<a href="https://github.com/krakenjs/adaro" target="_blank" rel="noopener">adaro</a>æ˜¯paypalå…¬å¸æä¾›çš„dustjsæ¸²æŸ“ç±»åº“ï¼Œå¯ä»¥ä½¿ç”¨å®ƒæ–¹ä¾¿çš„åœ¨å¤šä¸ªæ¨¡æ¿å¼•æ“ä¸­åˆ‡æ¢ï¼Œpaypalçš„åŸºäºexpressçš„webæ¡†æ¶krakenjsä½¿ç”¨çš„å°±æ˜¯adaroä½œä¸ºæ¨¡æ¿ç®¡ç†çš„å·¥å…·ã€‚</p><p>ç„¶ååœ¨appçš„å…¥å£ä»£ç å¤„æ·»åŠ æ¨¡æ¿çš„ä½¿ç”¨æƒ…å†µ</p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var dustjs = require(&apos;adaro&apos;);</span><br><span class="line">var app = express();</span><br><span class="line">// æ³¨å†Œ</span><br><span class="line">app.engine(&quot;dust&quot;,dustjs.dust(&#123; cache: false &#125;));</span><br><span class="line">// view engine setup</span><br><span class="line">app.set(&apos;views&apos;, path.join(__dirname, &apos;views&apos;));</span><br><span class="line">app.set(&apos;view engine&apos;, &apos;dust&apos;);</span><br></pre></td></tr></table></figure><p></p><p>ç„¶ååœ¨viewsç›®å½•ä¸‹ä½¿ç”¨ æ·»åŠ .dust åç¼€çš„è§†å›¾æ–‡ä»¶ã€‚ å¦‚æœä½ ç¼–å†™äº†è‡ªå·±çš„helper é‚£ä¹ˆéœ€è¦æ‰‹åŠ¨åœ¨å…¥å£æ–‡ä»¶å¤„ requireä¸€ä¸‹ã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/use_mongoose_on_bae_with_short_connection/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/use_mongoose_on_bae_with_short_connection/" itemprop="url">åœ¨BAEä¸­ä½¿ç”¨mongooseæ“ä½œmongodb</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-10-11T11:10:00+08:00">2014-10-11</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Nodejs/" itemprop="url" rel="index"><span itemprop="name">Nodejs</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><p>Â Â å‡ ä¹ç½‘ä¸Šæ‰€æœ‰çš„ä½¿ç”¨mongooseçš„ä¾‹å­éƒ½æ˜¯é•¿è¿æ¥çš„æ–¹å¼ï¼Œå› ä¸ºnodejsæœ¬èº«æœºåˆ¶çš„å…³ç³»ï¼Œä½¿ç”¨é•¿è¿æ¥ä¸€å®šç¨‹åº¦ä¸Šä¼šæé«˜æ€§èƒ½ï¼Œä½†æ˜¯baeçš„å…è´¹mongodbä¸æ”¯æŒé•¿é“¾æ¥ï¼Œä¹‹å‰ä¹Ÿæœ‰å¾ˆå¤šäººåšäº†å°è¯•ï¼Œæ¯”å¦‚<a href="http://www.drmfly.net/2014/01/11/bae3-use-mongoose-connect-mongodb.html" title="æ–­å¼€åæ•æ‰é”™è¯¯ï¼Œç„¶åè‡ªåŠ¨é‡è¿çš„æ–¹å¼" target="_blank" rel="noopener">æ–­å¼€åæ•æ‰é”™è¯¯ï¼Œç„¶åè‡ªåŠ¨é‡è¿çš„æ–¹å¼</a>,ç°åœ¨æ¥çœ‹éƒ½ä¸å¤ªæˆåŠŸï¼Œäºæ˜¯è¿˜æ˜¯ä¸­è§„ä¸­çŸ©çš„ä½¿ç”¨çŸ­é“¾æ¥çš„æ–¹å¼æ¥åšå§ï¼Œè¿™é‡Œå®ç°äº†ä¸€ä¸ªè¿æ¥æ‰“å¼€å’Œå…³é—­çš„æ‰˜ç®¡ã€‚</p><p><strong>mongoosekeeper.js</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">"util"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MongooseKeeper</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.db = mongoose.createConnection();</span><br><span class="line">    <span class="keyword">this</span>.open_count = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">MongooseKeeper.prototype.config = <span class="function"><span class="keyword">function</span>(<span class="params">conf</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// body...</span></span><br><span class="line">    <span class="keyword">var</span> options = &#123;</span><br><span class="line">        db: &#123; <span class="attr">native_parser</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">        server: &#123;</span><br><span class="line">            poolSize:<span class="number">4</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> constr = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">if</span>(process.env.MONGO_DB_STR)&#123;</span><br><span class="line">        constr = process.env.MONGO_DB_STR ;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//'mongodb://user:pass@localhost:port/database'</span></span><br><span class="line">        constr = util.format(<span class="string">'mongodb://%s:%s@%s:%d/%s'</span>, conf.userid,conf.password,conf.host,conf.port,conf.database);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.dbUri = constr;</span><br><span class="line">    <span class="keyword">this</span>.options = options;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line">MongooseKeeper.prototype.open =<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.open_count++;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.open_count ==<span class="number">1</span> &amp;&amp; <span class="keyword">this</span>.db.readyState == <span class="number">0</span>)</span><br><span class="line">    &#123;        </span><br><span class="line">        <span class="keyword">this</span>.db.open(<span class="keyword">this</span>.dbUri,<span class="keyword">this</span>.options,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// body...</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"db opened"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">MongooseKeeper.prototype.close =<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.open_count--;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">this</span>.open_count == <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.db.close(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"db closed"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">MongooseKeeper.prototype.use = <span class="function"><span class="keyword">function</span>(<span class="params">action,callback</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//OPEN</span></span><br><span class="line">    <span class="keyword">var</span> self = <span class="keyword">this</span>;</span><br><span class="line">    self.open();</span><br><span class="line">    action.call(<span class="literal">null</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//CLOSE</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"æ­£åœ¨è®¿é—®çš„æ•°æ®åº“è¯·æ±‚é‡"</span>+self.open_count);</span><br><span class="line">        self.close();</span><br><span class="line">        callback.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>);</span><br><span class="line">        <span class="comment">//DONE</span></span><br><span class="line">        self =<span class="literal">null</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">exports = <span class="built_in">module</span>.exports = <span class="keyword">new</span> MongooseKeeper();</span><br></pre></td></tr></table></figure><p></p><p>é¦–å…ˆåœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™ï¼Œæ¯”å¦‚åœ¨app.jsä¸­ï¼Œé…ç½®æ•°æ®è¿æ¥çš„ç­‰ä¿¡æ¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å¼•ç”¨mongoosekeeper</span><br><span class="line">var mongoosekeeper =  require(&apos;./lib/mongoosekeeper&apos;);</span><br></pre></td></tr></table></figure><p></p><p></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// è°ƒç”¨æ›´æ–°é…ç½®ï¼Œè¿™é‡Œçš„é…ç½®å¯ä»¥å»è¯»æŸä¸ªjson</span><br><span class="line">mongoosekeeper.config(&#123;</span><br><span class="line">    &quot;host&quot;: &quot;192.168.57.186&quot;,</span><br><span class="line">    &quot;database&quot;: &quot;dbname&quot;,</span><br><span class="line">    &quot;userid&quot;:&quot;userid&quot;,</span><br><span class="line">    &quot;password&quot;:&quot;123456&quot;,</span><br><span class="line">    &quot;port&quot;:27017</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p></p><p>å®šä¹‰Model</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var mongoose = require(&apos;mongoose&apos;);</span><br><span class="line">var Schema = mongoose.Schema;</span><br><span class="line">var mongokeeper  = require(&apos;../lib/mongoosekeeper&apos;);</span><br><span class="line"></span><br><span class="line">var articleModel = function () &#123;</span><br><span class="line"></span><br><span class="line">    var articleSchema = new Schema(&#123;</span><br><span class="line">        content     : String, //  å‘å¸ƒå†…å®¹</span><br><span class="line">        type        : Number, //</span><br><span class="line">        pictures    : [&#123;url:String,width:Number,height:Number&#125;], // é…å›¾</span><br><span class="line">        thumbnails  : [&#123;url:String,width:Number,height:Number&#125;], // ç¼©ç•¥å›¾</span><br><span class="line">        tags        : [String], // æ ‡ç­¾</span><br><span class="line">        author      : String, //  å‘å¸ƒäººè´¦å·</span><br><span class="line">        author_name : String, //  å‘å¸ƒäººåç§°</span><br><span class="line">        create_date : &#123; type: Date, default: Date.now &#125;, //åˆ›å»ºæ—¶é—´</span><br><span class="line">        meta        : &#123;</span><br><span class="line">                        votes  : Number, //é¡¶</span><br><span class="line">                        favs   : Number  //æ”¶è—</span><br><span class="line">                    &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    //å› ä¸ºä½¿ç”¨äº†createConnection è¿™é‡Œè¦ä½¿ç”¨mongokeeper.db.model</span><br><span class="line">    //è€Œä¸æ˜¯mongoose.model</span><br><span class="line">    return mongokeeper.db.model(&apos;article&apos;, articleSchema);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">module.exports = new articleModel();</span><br></pre></td></tr></table></figure><p></p><p>åœ¨è°ƒç”¨modelçš„æ—¶å€™ï¼Œä½¿ç”¨ <code>mongoosekeeper.use</code> æ–¹æ³•åŒ…è£…å®é™…çš„è°ƒç”¨å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">var express        = require(&apos;express&apos;),</span><br><span class="line">    router         = express.Router(),</span><br><span class="line"> 	mongoosekeeper =  require(&apos;../lib/mongoosekeeper&apos;),</span><br><span class="line"> 	articleModel   =  require(&apos;../models/articleModel&apos;);</span><br><span class="line"></span><br><span class="line">/* GET home page. */</span><br><span class="line">router.get(&apos;/&apos;, function(req, res) &#123;</span><br><span class="line"></span><br><span class="line">	mongoosekeeper.use(queryArticle,function(err,list)&#123;</span><br><span class="line">		if(err)&#123;</span><br><span class="line">			throw err;</span><br><span class="line">		&#125;</span><br><span class="line">		else&#123;</span><br><span class="line">			res.render(&apos;index&apos;,&#123;data:list&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">			</span><br><span class="line">	&#125;);	</span><br><span class="line">    </span><br><span class="line">&#125;);</span><br><span class="line">//proxy å‚æ•°å³ä¸ºmongoosekeeper.useçš„ç¬¬äºŒä¸ªå‚æ•°</span><br><span class="line">function queryArticle(proxy)&#123;</span><br><span class="line">	var search = &#123;&#125; ; //è·å–æ‰€æœ‰æ–‡ç« </span><br><span class="line">    var query = articleModel.find(search).limit(25); </span><br><span class="line">    query.sort(&apos;-create_date&apos;);</span><br><span class="line">    query.exec(proxy);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">module.exports = router;</span><br></pre></td></tr></table></figure><p></p><p><a href="http://git.oschina.net/xuanye-wan/sampleapp/tree/master/express_mongoose" title="git@osc" target="_blank" rel="noopener">å®Œæ•´ä»£ç </a></p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article><article class="post post-type-normal" itemscope itemtype="http://schema.org/Article"><div class="post-block"><link itemprop="mainEntityOfPage" href="https://xuanye.github.io/how_to_deploy_pages_on_gitcafe/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Xuanye"><meta itemprop="description" content><meta itemprop="image" content="/uploads/avatar.png"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="å‡æ­£ç»å“¥å“¥"></span><header class="post-header"><h2 class="post-title" itemprop="name headline"><a class="post-title-link" href="/how_to_deploy_pages_on_gitcafe/" itemprop="url">å¦‚ä½•å°†hexoéƒ¨ç½²åˆ°gitcafeä¸Š</a></h2><div class="post-meta"><span class="post-time"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-10T22:18:30+08:00">2013-12-10</time> </span><span class="post-category"><span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/åšå®¢/" itemprop="url" rel="index"><span itemprop="name">åšå®¢</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><h2>å…³äºhexo</h2><p><a href="http://zespia.tw/hexo/zh-CN/" title="hexo" target="_blank" rel="noopener">hexo</a> æ˜¯åŸºäº<a href="http://nodejs.org/" target="_blank" rel="noopener">nodejs</a>çš„ä¸€ä¸ªåšå®¢æ’°å†™ç¨‹åºï¼Œä½¿ç”¨markdownæ ¼å¼æ’°å†™åšå®¢ï¼Œå¹¶é€šè¿‡hexoç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œå¯ä»¥å‘å¸ƒåˆ°ä»»ä½•æ”¯æŒé™æ€æ–‡ä»¶çš„ç©ºé—´ï¼ˆæ¯”å¦‚githubç­‰ï¼‰ï¼Œä½†æ˜¯æœ¬æ–‡ä¸æ˜¯ä»‹ç»å¦‚ä½•ä½¿ç”¨hexoæˆ–è€…nodejsçš„ï¼Œå¦‚æœä½ ä¸¤è€…ä¸€æ— æ‰€çŸ¥ï¼Œæˆ‘å»ºè®®ä½ è°·æ­Œä¸€ä¸‹ç›¸å…³å†…å®¹ï¼Œå†è¡Œé˜…è¯»æœ¬æ–‡ã€‚<a href="http://zipperary.com/categories/hexo/" target="_blank" rel="noopener">è¿™é‡Œ</a> æœ‰ä¸€äº›æ¯”è¾ƒå¥½çš„ä»‹ç»hexoå¦‚ä½•ä½¿ç”¨çš„æ–‡ç« .</p><h2>å…³äºgitcafe</h2><p>æœ¬æ–‡å°†å±•ç¤ºå¦‚ä½•å°†hexo éƒ¨ç½²åˆ°<a href="https://gitcafe.com/" target="_blank" rel="noopener">gitcafe</a>ä¸Šï¼Œgitcafe æ˜¯å›½å†…çš„æºä»£ç æ‰˜ç®¡æœåŠ¡å•†,ç±»ä¼¼å›½å¤–çš„<a href="https://www.github.com/" target="_blank" rel="noopener">github</a>ã€‚ä¸è¿‡æœåŠ¡å™¨å› ä¸ºåœ¨å›½å†…ï¼Œæ‰€ä»¥è®¿é—®é€Ÿåº¦è¿˜æ˜¯æ¯”è¾ƒç†æƒ³ï¼Œå°±æ˜¯ä¸çŸ¥é“æ˜¯å¦èƒ½å¤Ÿåšå¤§åšå¼ºï¼Œæ¯•ç«Ÿgithubæ‘†åœ¨çœ¼å‰ã€‚</p><h2>è¿›è¡Œéƒ¨ç½²</h2><p>é¦–å…ˆè®¿é—® https://gitcafe.com/ ,æ³¨å†Œä¸€ä¸ªæ–°çš„è´¦å·ï¼Œè¿‡ç¨‹éå¸¸ç®€å•ï¼Œå°±ä¸æè¿°äº†ï¼Œåªæ˜¯åˆ«å¿˜äº†å»é‚®ç®±ç¡®è®¤å“¦ï¼Œç„¶åè¿›å…¥åˆ°ä¸ªäººä¸»é¡µæ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®åç§°å¿…é¡»å’Œç”¨æˆ·åä¸€è‡´ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="http://ww1.sinaimg.cn/large/697065c1gw1ebfnyfkwwmj20a604bmx8.jpg" alt="æ–°å»ºä¸€ä¸ªå’Œç”¨æˆ·åä¸€æ ·çš„é¡¹ç›®"></p><p>æ¥ç€éœ€è¦é…ç½®ä¸‹ssh,ç‚¹å‡»è´¦å·è®¾ç½® <img src="http://ww4.sinaimg.cn/large/697065c1gw1ebfo0m2jfej207e08iaa9.jpg" alt="è´¦å·è®¾ç½®">ï¼Œæ¥åˆ°sshç®¡ç†ä¸­æ·»åŠ å…¬é’¥ï¼Œå¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ä½¿ç”¨sshï¼Œè¯·å‚è€ƒ<a href="https://gitcafe.com/GitCafe/Help/wiki/%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E5%92%8C%E8%AE%BE%E7%BD%AE-Git#wiki" title="æ·»åŠ SSH" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>å¦‚æœä½ æ˜¯windows gitçš„ç»¿è‰²ç‰ˆçš„è¯ ï¼ŒæŠŠgitç›®å½•ä¸‹çš„binç›®å½•å’Œcmdç›®å½•æ·»åŠ åˆ°<code>path</code>å˜é‡ä¸­ï¼ŒåŒæ—¶è®¾ç½®ä¸‹ <code>HOME</code> å˜é‡ï¼Œå¯ä»¥æ˜¯å½“å‰ç”¨æˆ· <code>C:\Users\xuanye</code> ç›®å½•</p><p>ç„¶åä¿®æ”¹hexoçš„é…ç½®æ–‡ä»¶<code>_config.yaml</code> ,å°†<code>deploy</code> é…ç½®èŠ‚ä¿®æ”¹å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: github</span><br><span class="line">  repository: git@gitcafe.com:xuanye/xuanye.git</span><br><span class="line">  branch: gitcafe-pages</span><br></pre></td></tr></table></figure><p></p><p><strong>æ³¨æ„ï¼šxuanyeä¿®æ”¹ä¸ºä½ è‡ªå·±çš„è´¦å·ï¼Œbranchå¿…é¡»ä½¿ç”¨gitcafe-pages åˆ†æ”¯</strong></p><p>ç„¶åè°ƒç”¨ <code>hexo g</code> é‡æ–°ç”Ÿæˆï¼Œå¹¶è°ƒç”¨ <code>hexo deploy</code> éƒ¨ç½²å³å¯ ï¼ˆåœ¨é‡æ–°éƒ¨ç½²å‰ å…ˆåˆ é™¤ <code>.deploy</code> ç›®å½•ï¼‰</p><p>éƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ http://[username].gitcafe.com/ è¿›è¡Œè®¿é—®äº†ã€‚</p><p>ç°åœ¨gitcafeè¿˜æ”¯æŒç»‘å®šè‡ªå®šä¹‰åŸŸåï¼Œåœ¨ <code>é¡¹ç›®é¦–é¡µ&gt;é¡¹ç›®ç®¡ç†&gt;è‡ªå®šä¹‰åŸŸå</code> æ·»åŠ ä½ çš„åŸŸå,ç„¶ååˆ°ä½ çš„DNSæœåŠ¡å•†é‚£é‡Œæ·»åŠ ä¸€æ¡Aè®°å½• å°†åŸŸåæŒ‡å‘GitCafeæœåŠ¡å™¨çš„IP <code>117.79.146.98</code> <img src="http://ww1.sinaimg.cn/large/697065c1gw1ebfpyjrqvsj20ia04h74f.jpg" alt="æ·»åŠ åŸŸå"> ï¼Œç­‰æ®µæ—¶é—´ç”Ÿæ•ˆåã€‚</p></div><footer class="post-footer"><div class="post-eof"></div></footer></div></article></section><nav class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a></nav></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id="sidebar" class="sidebar"><div class="sidebar-inner"><section class="site-overview-wrap sidebar-panel sidebar-panel-active"><div class="site-overview"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="Xuanye"><p class="site-author-name" itemprop="name">Xuanye</p><p class="site-description motion-element" itemprop="description"></p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">17</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/index.html"><span class="site-state-item-count">4</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/index.html"><span class="site-state-item-count">28</span> <span class="site-state-item-name">tags</span></a></div></nav><div class="feed-link motion-element"><a href="/atom.xml" rel="alternate"><i class="fa fa-rss"></i> RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/xuanye" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="https://twitter.com/xuanyewong" target="_blank" title="Twitter" rel="external nofollow"><i class="fa fa-fw fa-twitter"></i>Twitter</a></span></div></div></section></div></aside></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; 2014 &mdash; <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-heart"></i> </span><span class="author" itemprop="copyrightHolder">Xuanye</span></div><div class="powered-by">Powered by <a class="theme-link" target="_blank" rel="external nofollow" href="https://hexo.io">Hexo</a></div><span class="post-meta-divider">|</span><div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" rel="external nofollow" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a></div></div></footer><div class="back-to-top"><i class="fa fa-arrow-up"></i></div></div><script type="text/javascript">if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }</script><script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script><script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script type="text/javascript" src="/lib/three/three.min.js"></script><script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script><script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script><script type="text/javascript" src="/js/src/utils.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/motion.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/affix.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.3"></script><script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.3"></script><!-- LOCAL: You can save these files to your site and update links --><link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css"><script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script><!-- END LOCAL --><script type="text/javascript">// Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('10');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });</script></body></html>